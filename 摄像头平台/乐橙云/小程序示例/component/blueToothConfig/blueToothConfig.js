module.exports=function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=2)}([function(e,t,r){"use strict";var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n=/^(?:[A-Za-z\d+\/]{4})*?(?:[A-Za-z\d+\/]{2}(?:==)?|[A-Za-z\d+\/]{3}=?)?$/;t.weBtoa=function(e){for(var t=void 0,r=void 0,n=void 0,o=void 0,c="",a=0,s=(e=String(e)).length%3;a<e.length;){if((r=e.charCodeAt(a++))>255||(n=e.charCodeAt(a++))>255||(o=e.charCodeAt(a++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");c+=i.charAt((t=r<<16|n<<8|o)>>18&63)+i.charAt(t>>12&63)+i.charAt(t>>6&63)+i.charAt(63&t)}return s?c.slice(0,s-3)+"===".substring(s):c},t.weAtob=function(e){if(e=String(e).replace(/[\t\n\f\r ]+/g,""),!n.test(e))throw new TypeError("Failed to execute 'atob' on 'Window': The string to be decoded is not correctly encoded.");e+="==".slice(2-(3&e.length));for(var t=void 0,r="",o=void 0,c=void 0,a=0;a<e.length;)t=i.indexOf(e.charAt(a++))<<18|i.indexOf(e.charAt(a++))<<12|(o=i.indexOf(e.charAt(a++)))<<6|(c=i.indexOf(e.charAt(a++))),r+=64===o?String.fromCharCode(t>>16&255):64===c?String.fromCharCode(t>>16&255,t>>8&255):String.fromCharCode(t>>16&255,t>>8&255,255&t);return r}},function(e,t){e.exports=require("crypto-js")},function(e,t,r){"use strict";var i=r(3),n=r(5);var o=0,c=[];function a(e){return Array.prototype.map.call(new Uint8Array(e),(function(e){return("00"+e.toString(16)).slice(-2)})).join("")}Component({properties:{SN:{type:String,value:""},PID:{type:String,value:""},wifiName:{type:String,value:""},wifiPassword:{type:String,value:""},SC:{type:String,value:""}},data:{},lifetimes:{ready:function(){var e=this;wx.showLoading({title:"连接中"}),wx.openBluetoothAdapter({success:function(t){console.log("openBluetoothAdapter success",t),e.startBluetoothDevicesDiscovery()},fail:function(t){console.log("openBluetoothAdapter fail",t),clearTimeout(e.timer),e.redirectFlag=!0,setTimeout((function(){e.triggerEvent("onFail")}),3e3)}}),this.timer=setTimeout((function(){e.device||(wx.stopBluetoothDevicesDiscovery(),wx.closeBluetoothAdapter(),c=[],o=0,e.redirectFlag=!0,e.triggerEvent("onFail"))}),1e4)},detached:function(){console.log("Component---detached"),wx.disableAlertBeforeUnload(),wx.hideLoading(),clearTimeout(this.timer),wx.stopBluetoothDevicesDiscovery(),this.device&&wx.closeBLEConnection({deviceId:this.device.deviceId}),wx.closeBluetoothAdapter(),c=[],o=0}},methods:{startBluetoothDevicesDiscovery:function(){var e=this;this._discoveryStarted||(this._discoveryStarted=!0,wx.startBluetoothDevicesDiscovery({success:function(t){console.log("startBluetoothDevicesDiscovery success",t),e.onBluetoothDeviceFound()},fail:function(e){console.log("fail startBluetoothDevicesDiscovery",e),1509008===e.errno&&wx.showToast({title:"请打开微信地址权限",duration:"3000"})}}))},onBluetoothDeviceFound:function(){var e=this;wx.onBluetoothDeviceFound((function(t){t.devices.forEach((function(t){t.name&&t.localName&&(console.log(t),(t.name&&t.name.includes("DAP"+e.data.SN.slice(-4))||t.localName&&t.localName.includes("DAP"+e.data.SN.slice(-4)))&&e.foundDevice(t))}))}))},foundDevice:function(e){var t=this;this.device=e;var r=e.name,i=e.deviceId;wx.stopBluetoothDevicesDiscovery(),wx.createBLEConnection({deviceId:i,success:function(e){t.setData({name:r,deviceId:i}),t.getBLEDeviceServices(i)}})},getBLEDeviceServices:function(e){var t=this;wx.getBLEDeviceServices({deviceId:e,success:function(r){for(var i=0;i<r.services.length;i++)if(r.services[i].isPrimary)return void t.getBLEDeviceCharacteristics(e,r.services[i].uuid)}})},getBLEDeviceCharacteristics:function(e,t){var r,i,s=this;wx.getBLEDeviceCharacteristics({deviceId:e,serviceId:t,success:function(r){for(var i=0;i<r.characteristics.length;i++){var n=r.characteristics[i];n.properties.read&&wx.readBLECharacteristicValue({deviceId:e,serviceId:t,characteristicId:n.uuid}),n.properties.write&&(s.setData({canWrite:!0}),s._deviceId=e,s._serviceId=t,s._characteristicId=n.uuid),(n.properties.notify||n.properties.indicate)&&wx.notifyBLECharacteristicValueChange({deviceId:e,serviceId:t,characteristicId:n.uuid,state:!0})}},fail:function(e){console.error("getBLEDeviceCharacteristics",e)}}),wx.onBLECharacteristicValueChange((r=regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("ab2hex(characteristic.value)",a(t.value)),o&&c.push(t.value),"d004"!==a(t.value).slice(0,4)){e.next=16;break}e.t0=o,e.next=1===e.t0?7:2===e.t0?9:3===e.t0?12:16;break;case 7:return(0,n.reviceprotocol03)(c).then((function(e){s.pulicKey=e,console.log(s.pulicKey,"this.pulicKey"),c=[],s.writeBLECharacteristicValue03(s.data)})),e.abrupt("break",16);case 9:return(0,n.reviceprotocol05)(c,s.pulicKey,s.data.PID),c=[],e.abrupt("break",16);case 12:return(0,n.reviceprotocol05)(c,s.pulicKey,s.data.PID),c=[],setTimeout((function(){wx.stopBluetoothDevicesDiscovery(),wx.closeBluetoothAdapter(),c=[],o=0,s.redirectFlag=!0,s.triggerEvent("onSuccess")}),2e3),e.abrupt("break",16);case 16:case"end":return e.stop()}}),e,s)})),i=function(){var e=r.apply(this,arguments);return new Promise((function(t,r){return function i(n,o){try{var c=e[n](o),a=c.value}catch(e){return void r(e)}if(!c.done)return Promise.resolve(a).then((function(e){i("next",e)}),(function(e){i("throw",e)}));t(a)}("next")}))},function(e){return i.apply(this,arguments)})),setTimeout((function(){s.writeBLECharacteristicValue()}),2e3)},writeBLECharacteristicValue:function(){var e=this;(0,i.protocol03)().forEach((function(t,r){setTimeout((function(){wx.writeBLECharacteristicValue({deviceId:e._deviceId,serviceId:e._serviceId,characteristicId:e._characteristicId,value:t,success:function(e){console.log(e,"success,writeBLECharacteristicValue")},fail:function(e){console.log(e,"fail,writeBLECharacteristicValue")}})}),200*r)})),o=1},writeBLECharacteristicValue02:function(){var e=this,t=(0,i.protocol05)(this.pulicKey,this.data.PID);console.log("this._characteristicId",this._characteristicId),t.forEach((function(t,r){setTimeout((function(){console.log("writeBLECharacteristicValue02",a(t)),wx.writeBLECharacteristicValue({deviceId:e._deviceId,serviceId:e._serviceId,characteristicId:e._characteristicId,value:t,writeType:"write",success:function(e){console.log(e,"res")}})}),200*r)})),o=2},writeBLECharacteristicValue03:function(e){var t=this,r=this.data,n=r.wifiName,c=r.wifiPassword,s=r.PID;(0,i.protocol04)(n,c,this.pulicKey,s).forEach((function(e,r){setTimeout((function(){console.log("writeBLECharacteristicValue03",a(e)),wx.writeBLECharacteristicValue({deviceId:t._deviceId,serviceId:t._serviceId,characteristicId:t._characteristicId,value:e,writeType:"write",success:function(e){console.log(e,"res,writeBLECharacteristicValue03")}})}),200*r)})),o=3}}})},function(e,t,r){"use strict";var i=r(1),n=r(0),o=(n.weBtoa,n.weAtob,r(4).privateKey);function c(e){var t=new ArrayBuffer(3),r=new Uint8Array(t);r[0]=208,r[1]=1,r[2]=17;var i=new ArrayBuffer(3),n=new Uint8Array(i);n[0]=208,n[1]=2,n[2]=17;var o=new ArrayBuffer(3),c=new Uint8Array(o);c[0]=208,c[1]=4,c[2]=e.length%17;var a=new ArrayBuffer(20),s=new Uint8Array(a);s.set(r,0),s.set(e.slice(0,17),3);for(var u=[a],l=Math.floor(e.length/17),f=1;f<l;f++){var d=new ArrayBuffer(20),h=new Uint8Array(d);h.set(n,0),h.set(e.slice(17*f,17*(f+1)),3),u.push(d)}var v=new ArrayBuffer(3+e.length%17),p=new Uint8Array(v);return p.set(c,0),p.set(e.slice(17*l,e.length),3),u.push(v),u}e.exports={protocol03:function(){var e=new ArrayBuffer(6+o.length),t=new Uint8Array(e);return t[0]=0,t[1]=1,t[2]=1,t[3]=0,t[4]=3,t[5]=o.length,t.set(o,6),c(t)},protocol04:function(e,t,r,n){var o=new ArrayBuffer(6+e.length+3+t.length);console.log(o,"data");var a=new Uint8Array(o);a[0]=0,a[1]=17,a[2]=2,a[3]=0,a[4]=1,a[5]=e.length;for(var s=new ArrayBuffer(e.length),u=new Uint8Array(s),l=0;l<e.length;l++)u[l]=e.charCodeAt(l);a.set(u,6);var f=new ArrayBuffer(t.length+3);console.log(f,"data");var d=new Uint8Array(f);d[0]=0,d[1]=2,d[2]=t.length;for(var h=0;h<t.length;h++)d[h+3]=t.charCodeAt(h);console.log(f,"data"),a.set(d,e.length+6),console.log(f,"data");for(var v=i.enc.Base64.parse(r.base64),p=i.SHA256(v),g=i.lib.WordArray.create(a),w=i.AES.encrypt(g,p,{iv:i.enc.Utf8.parse(n)}).toString(),y=new ArrayBuffer(w.length),A=new Uint8Array(y),B=0;B<w.length;B++)A[B]=w.charCodeAt(B);return console.log("splitData"),c(A)},protocol05:function(e,t){var r=new ArrayBuffer(3),n=new Uint8Array(r);n[0]=0,n[1]=16,n[2]=0,console.log("dataBuffer",n.toString());var o=i.enc.Base64.parse(e.base64),a=i.SHA256(o);console.log("hashkeyBase4",a);for(var s=i.lib.WordArray.create(n),u=i.AES.encrypt(s,a,{iv:i.enc.Utf8.parse(t)}).toString(),l=new ArrayBuffer(u.length),f=new Uint8Array(l),d=0;d<u.length;d++)f[d]=u.charCodeAt(d);var h=c(f);return console.log(h,"packages"),h}}},function(e,t,r){"use strict";for(var i=(0,r(0).weAtob)("+cw1bTSakIYiWTx5WOhHRxv/2QTiz6ElnTsaWKGSwpf2LEM/llVpPQ4hlg5eGBW16VMRhh2fzWSYWdy+89HVaw=="),n=new ArrayBuffer(i.length),o=new Uint8Array(n),c=0;c<i.length;c++)o[c]=i.charCodeAt(c);e.exports={privateKey:o,ab2hex:function(e){return Array.prototype.map.call(new Uint8Array(e),(function(e){return("00"+e.toString(16)).slice(-2)})).join("")}}},function(e,t,r){"use strict";var i=r(1),n=r(0),o=n.weBtoa,c=n.weAtob;function a(e,t,r){var n=i.enc.Base64.parse(t.base64),o=i.SHA256(n),c=i.enc.Base64.parse(e),a=i.lib.CipherParams.create({ciphertext:c,formatter:i.format.OpenSSL}),s=i.AES.decrypt(a,o,{iv:i.enc.Utf8.parse(r)});return console.log(s,s.toString(),function(e){var t=e.sigBytes,r=e.words,i=new Uint8Array(t),n=0,o=0;for(;n!=t;){var c=r[o++];if(i[n++]=(4278190080&c)>>>24,n==t)break;if(i[n++]=(16711680&c)>>>16,n==t)break;if(i[n++]=(65280&c)>>>8,n==t)break;i[n++]=255&c}return i}(s)),s.toString()}function s(e){var t=e.reduce((function(e,t){return e+new Uint8Array(t).length}),0);t-=3*e.length,console.log("length",t);var r=new ArrayBuffer(t),i=new Uint8Array(r);return e.forEach((function(e,t){var r=new Uint8Array(e);i.set(r.slice(3),17*t)})),i}e.exports={compassData:s,reviceprotocol03:function(e){var t=s(e),r=new ArrayBuffer(64),i=new Uint8Array(r);i.set(t.slice(10),0),console.log(c(o(i)));var n=c(o(i));return new Promise((function(e,t){wx.request({url:"https://open.imou.com/webOpenApi/genPublicKey",method:"POST",data:{publicKey:n},success:function(t){e(t.data)},fail:function(e){t(e)}})}))},reviceprotocol05:function(e,t,r){for(var i=s(e),n="",o=0;o<i.length;o++)n+=String.fromCharCode(i[o]);console.log("base64data",n);var c,u=a(n,t,r);return console.log(u,"data",(c=i,Array.prototype.map.call(new Uint8Array(c),(function(e){return("00"+e.toString(16)).slice(-2)})).join(""))),u}}}]);