"use strict";(self["webpackChunkplayer_demo"]=self["webpackChunkplayer_demo"]||[]).push([[725],{1626:function(s,t,i){i.r(t),i.d(t,{default:function(){return v}});var a=function(){var e=this,s=e._self._c;return s("el-container",{staticClass:"player-container",style:{width:"100vw",height:"100vh"}},[s("el-main",{staticClass:"main-container"},[s("el-col",{key:"col",staticClass:"player-box active-player",style:{height:"100%"},attrs:{span:24}},[s("video-player",{ref:"player",attrs:{id:"player",rtspURL:e.rtspURL,audioURL:e.audioURL,downloadURL:e.downloadURL,isLive:e.isLive},on:{downloadProgressUpdate:e.downloadProgressUpdate,playProgressUpdate:e.playProgressUpdate,downloadComplete:e.downloadComplete,downloadError:e.downloadError,playError:e.playError}})],1)],1),s("el-footer",{attrs:{height:"40px"}},[s("el-row",{staticClass:"w-100"},[s("el-col",{staticClass:"h40 flex",attrs:{span:22}},[s("div",{class:e.isPause||!e.isPlay?"play-icon":"pause-icon",attrs:{title:e.isPause||!e.isPlay?"播放":"暂停"},on:{click:e.togglePlay}}),s("div",{staticClass:"screenshot-icon",attrs:{title:"截图"},on:{click:e.screenshot}}),s("div",{staticClass:"recording-icon",class:{active:e.recording},attrs:{title:"录像"},on:{click:e.record}}),s("div",{directives:[{name:"show",rawName:"v-show",value:e.isLive,expression:"isLive"}],staticClass:"talk-icon",class:{active:e.talking},attrs:{title:"对讲"},on:{click:e.talk}}),s("div",{staticClass:"sound-icon",class:{active:e.isMuting},attrs:{title:e.isMuting?"静音":"声音"},on:{click:e.toggleMute}}),s("div",{directives:[{name:"show",rawName:"v-show",value:!e.isLive,expression:"!isLive"},{name:"loading",rawName:"v-loading",value:e.isDownloading,expression:"isDownloading"}],staticClass:"download-icon",attrs:{title:"录像下载"},on:{click:e.download}}),s("div",{directives:[{name:"show",rawName:"v-show",value:!e.isLive,expression:"!isLive"}],staticClass:"fast-icon",attrs:{title:"倍速"},on:{click:e.fast}}),s("div",{staticClass:"config-set"},[s("span",{staticClass:"fn-13 mg-l-5"},[e._v("业务类型：")]),s("el-select",{staticStyle:{width:"80px"},attrs:{size:"mini"},model:{value:e.isLive,callback:function(s){e.isLive=s},expression:"isLive"}},[s("el-option",{key:"false",attrs:{value:!1,label:"录像"}}),s("el-option",{key:"true",attrs:{value:!0,label:"直播"}})],1),s("span",{staticClass:"fn-13 mg-l-5"},[e._v("协议类型：")]),s("el-select",{staticStyle:{width:"90px"},attrs:{size:"mini"},model:{value:e.protoType,callback:function(s){e.protoType=s},expression:"protoType"}},[s("el-option",{key:"rtsp",attrs:{value:"rtsp",label:"rtsp"}}),s("el-option",{key:"rtsv",attrs:{value:"rtsv",label:"私有协议"}})],1),s("span",{staticClass:"fn-13 mg-l-5"},[e._v("码流类型：")]),s("el-select",{staticStyle:{width:"80px"},attrs:{size:"mini"},model:{value:e.streamType,callback:function(s){e.streamType=s},expression:"streamType"}},[s("el-option",{key:"0",attrs:{value:"0",label:"高清"}}),s("el-option",{key:"1",attrs:{value:"1",label:"标清"}})],1),s("span",{directives:[{name:"show",rawName:"v-show",value:!e.isLive,expression:"!isLive"}],staticClass:"fn-13 mg-l-5"},[e._v("录像类型：")]),s("el-select",{directives:[{name:"show",rawName:"v-show",value:!e.isLive,expression:"!isLive"}],staticStyle:{width:"100px"},attrs:{size:"mini"},model:{value:e.recordType,callback:function(s){e.recordType=s},expression:"recordType"}},[s("el-option",{key:"localRecord",attrs:{value:"localRecord",label:"本地录像"}}),s("el-option",{key:"cloudRecord",attrs:{value:"cloudRecord",label:"云录像"}})],1),s("span",{directives:[{name:"show",rawName:"v-show",value:!e.isLive,expression:"!isLive"}]},[s("el-select",{staticStyle:{width:"100px"},attrs:{size:"mini",placeholder:"播放倍速"},model:{value:e.speed,callback:function(s){e.speed=s},expression:"speed"}},[s("el-option",{key:"0.25",attrs:{value:.25,label:"1/4"}}),s("el-option",{key:"0.5",attrs:{value:.5,label:"1/2"}}),s("el-option",{key:"1",attrs:{value:1,label:"1"}}),s("el-option",{key:"2",attrs:{value:2,label:"2"}}),s("el-option",{key:"4",attrs:{value:4,label:"4"}}),s("el-option",{key:"6",attrs:{value:6,label:"6"}}),s("el-option",{key:"8",attrs:{value:8,label:"8"}})],1),s("el-date-picker",{staticStyle:{width:"315px"},attrs:{size:"mini",type:"datetimerange","range-separator":"至","start-placeholder":"录像开始日期","end-placeholder":"录像结束日期",clearable:!1},model:{value:e.recordTimeRange,callback:function(s){e.recordTimeRange=s},expression:"recordTimeRange"}})],1),s("span",{directives:[{name:"show",rawName:"v-show",value:e.isLive,expression:"isLive"}],staticClass:"fn-13 mg-l-5"},[e._v("设备类型：")]),s("el-select",{directives:[{name:"show",rawName:"v-show",value:e.isLive,expression:"isLive"}],staticStyle:{width:"110px"},attrs:{size:"mini"},model:{value:e.deviceType,callback:function(s){e.deviceType=s},expression:"deviceType"}},[s("el-option",{key:"channel",attrs:{value:"channel",label:"多通道设备"}}),s("el-option",{key:"device",attrs:{value:"device",label:"单通道设备"}})],1),s("span",{staticClass:"fn-13 mg-l-5"},[e._v("设备序列号：")]),s("el-input",{staticStyle:{width:"150px"},attrs:{placeholder:"请输入设备序列号",size:"mini"},model:{value:e.deviceId,callback:function(s){e.deviceId=s},expression:"deviceId"}}),s("span",{staticClass:"fn-13 mg-l-5"},[e._v("通道号：")]),s("el-input",{staticStyle:{width:"80px"},attrs:{placeholder:"请输入通道号",size:"mini"},model:{value:e.channelId,callback:function(s){e.channelId=s},expression:"channelId"}})],1)]),s("el-col",{staticClass:"text-right h40",attrs:{span:2}},[s("span",{staticClass:"video-icon closeall-normal-icon",attrs:{title:"关闭所有"},on:{click:e.closeVideo}})])],1)],1)],1)},r=[],l=i(8281),o=i(1493),n=i(4454),c=i(1304),d={name:"videoDemo",data(){return{recording:!1,talking:!1,isMuting:!0,rtspURL:"",audioURL:null,downloadURL:"",isLive:!0,url:"",isPause:!1,isPlay:!1,isDownloading:!1,speed:"",recordTimeRange:[],recordType:"localRecord",encrypt:"0",protoType:"rtsp",deviceType:"device",deviceId:"",channelId:"0",streamType:"0"}},components:{VideoPlayer:l.Z},methods:{screenshot(){this.isPlay&&!this.isPause?(console.log("-----screenshot-----"),this.$refs["player"]&&this.$refs["player"].screenshot()):this.$message.warning("截图前请先播放视频")},playError(e){console.error(e)},recordError(){console.error(e),this.recording=!1},closeVideo(){console.log("-----closeVideo-----"),this.isPlay=!1,this.isPause=!1,this.talking=!1,this.isMuting=!0,this.isDownloading=!1,this.recording=!1,this.rtspURL="",this.$refs["player"]&&this.$refs["player"].close()},async record(){this.isPlay&&!this.isPause?(this.recording||await this.init(),this.recording=!this.recording,this.$refs["player"]&&this.$refs["player"].record()):this.$message.warning("录像前请先直播")},talk(){if(this.talking)this.talking=!this.talking,this.$refs["player"]&&this.$refs["player"].talk();else{if(!this.isPlay||this.isPause)return void this.$message.warning("对讲前请先直播");if(!this.deviceId)return void this.$message.warning("设备序列号不能为空");if(!this.channelId)return void this.$message.warning("通道号不能为空");const e={deviceId:this.deviceId,channelId:this.channelId,businessType:"talk",streamType:this.streamType,encryptMode:this.encrypt,protoType:this.protoType,deviceType:this.deviceType};fetch(`${n.Z.base_url}/gateway/videobussiness/api/createDeviceStreamUrl`,{method:"POST",body:JSON.stringify(e),mode:"cors",headers:{"Access-Control-Allow-Origin":"*","Content-Type":"application/json",Authorization:"Bearer "+this.token}}).then((e=>e.json())).then((e=>{const s=e.data&&e.data.url;s?(this.audioURL=s,this.$nextTick((()=>{this.talking=!this.talking,this.$refs["player"]&&this.$refs["player"].talk()}))):this.$message.warning(e.errMsg)}))}},toggleMute(){if(this.talking)return void this.$message.warning("对讲时不能操作声音");this.isMuting=!this.isMuting;const e=this.isMuting?0:1;this.$refs["player"]&&this.$refs["player"].setAudioVolume(e)},play(){this.$refs["player"]&&this.$refs["player"].play()},pause(){this.$refs["player"]&&this.$refs["player"].pause()},start(){this.$refs["player"]&&this.$refs["player"].start()},async togglePlay(){if(this.isPlay)this.isPause?(this.isPause=!1,this.start()):(this.isPause=!0,this.pause());else{if(!this.deviceId)return void this.$message.warning("设备序列号不能为空");if(!this.channelId)return void this.$message.warning("通道号不能为空");if(!this.isLive&&(null===this.recordTimeRange||this.recordTimeRange.length<2))return void this.$message.warning("录像时间不能为空");await this.init(),this.isPlay=!0,this.play()}},fast(){if(!this.isPlay||this.isPause)return void this.$message.warning("倍速前请先播放录像");const e=this.speed?this.speed:1;this.$refs["player"]&&this.$refs["player"].playFF(e)},playProgressUpdate(e){},async download(){this.isDownloading?console.log("录像正在下载中......"):(await this.downloadInit(),this.isDownloading=!0,this.$refs["player"]&&this.$refs["player"].download())},downloadProgressUpdate(e){console.log("------当前录像下载到的时间片段--------:",e.size,e.time)},downloadComplete(){console.log("---------下载完成----------"),this.isDownloading=!1},downloadError(e){console.log(`下载出错，errorCode：${e&&e.errorCode},description：${e&&e.description}`),this.$refs["player"]&&this.$refs["player"].download(),this.isDownloading=!1},downloadInit(){let e={deviceId:this.deviceId,channelId:this.channelId,streamType:this.streamType,protoType:this.protoType,encryptMode:this.encrypt};e.businessType=this.recordType,e.beginTime=this.toAllStringByTime(this.recordTimeRange[0]),e.endTime=this.toAllStringByTime(this.recordTimeRange[1]);const s=this;return new Promise(((t,i)=>{(0,c.Z)({method:"post",url:`${n.Z.base_url}/gateway/videobussiness/api/createDeviceStreamUrl`,data:e,needRequestData:!0,headers:{"Access-Control-Allow-Origin":"*","Content-Type":"application/json",Authorization:"Bearer "+this.token},onSuccess(e){const a=e.data&&e.data.url;a?(s.downloadURL=a,t()):(s.$message.warning(e.errMsg),i(e.errMsg))},onError(e){console.error(e),i(e)}})}))},toAllStringByTime(e){const s={};let t=new Date(e);return s.y=this.addZero(t.getFullYear()),s.m=this.addZero(t.getMonth()+1),s.d=this.addZero(t.getDate()),s.h=this.addZero(t.getHours()),s.min=this.addZero(t.getMinutes()),s.s=this.addZero(t.getSeconds()),`${s.y}-${s.m}-${s.d} ${s.h}:${s.min}:${s.s}`},addZero:e=>{let s=e>9?e:"0"+e;return s},init(){let e={deviceId:this.deviceId,channelId:this.channelId,streamType:this.streamType,protoType:this.protoType,encryptMode:this.encrypt};return this.isLive?e.businessType="real":(e.businessType=this.recordType,e.beginTime=this.toAllStringByTime(this.recordTimeRange[0]),e.endTime=this.toAllStringByTime(this.recordTimeRange[1])),new Promise(((s,t)=>{fetch(`${n.Z.base_url}/gateway/videobussiness/api/createDeviceStreamUrl`,{method:"POST",body:JSON.stringify(e),mode:"cors",headers:{"Access-Control-Allow-Origin":"*","Content-Type":"application/json",Authorization:"Bearer "+this.token}}).then((e=>e.json())).then((e=>{const i=e.data&&e.data.url;if(i)this.rtspURL=i,s();else{const s="DV1019"==e.code?"设备能力级不支持！":e.errMsg;this.$message.warning(s),t(s)}}))}))},getToken(){const e=`${n.Z.base_url}/gateway/auth/oauth/token?grant_type=client_credentials&scope=server&client_id=${n.Z.client_id}&client_secret=${n.Z.client_secret}`;fetch(e,{headers:{"Access-Control-Allow-Origin":"*","Content-Type":"application/x-www-form-urlencoded"},method:"POST"}).then((e=>e.json())).then((e=>{this.token=e.access_token}))}},mounted(){this.recordTimeRange=[new Date,new Date],this.getToken(),o.Z.init([this.$refs["player"]])}},h=d,p=i(3736),y=(0,p.Z)(h,a,r,!1,null,null,null),v=y.exports}}]);