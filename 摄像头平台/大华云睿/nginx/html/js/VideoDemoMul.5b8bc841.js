(self["webpackChunkplayer_demo"]=self["webpackChunkplayer_demo"]||[]).push([[36],{8281:function(e,t,n){"use strict";n.d(t,{Z:function(){return h}});var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"video-player",attrs:{id:e.id}},[t("canvas",{ref:`download-${e.id}`,staticClass:"kind-stream-canvas video-player-canvas",staticStyle:{visibility:"hidden"},attrs:{"kind-channel-id":"0",width:"1920",height:"1080"}}),t("canvas",{ref:`downloadIvs-${e.id}`,staticClass:"kind-stream-canvas video-player-canvas",staticStyle:{visibility:"hidden"},attrs:{width:"1920",height:"1080"}}),t("canvas",{ref:`talk-${e.id}`,staticClass:"kind-stream-canvas video-player-canvas",staticStyle:{visibility:"hidden"},attrs:{"kind-channel-id":"0",width:"1920",height:"1080"}}),t("canvas",{ref:`talkIvs-${e.id}`,staticClass:"kind-stream-canvas video-player-canvas",staticStyle:{visibility:"hidden"},attrs:{width:"1920",height:"1080"}}),t("canvas",{ref:`can-${e.id}`,staticClass:"kind-stream-canvas video-player-canvas",style:{visibility:e.isPlay?"visible":"hidden"},attrs:{"kind-channel-id":"0",width:"1920",height:"1080"}}),t("canvas",{ref:`ivsCan-${e.id}`,staticClass:"kind-stream-canvas video-player-canvas",style:{visibility:e.isPlay?"visible":"hidden"},attrs:{width:"1920",height:"1080"}}),t("video",{ref:`video-${e.id}`,staticClass:"kind-stream-canvas",style:{visibility:e.isPlay?"visible":"hidden"},attrs:{"kind-channel-id":"0",width:"1920",height:"1080"}}),t("video",{ref:`download-video-${e.id}`,staticClass:"kind-stream-canvas",staticStyle:{visibility:"hidden"},attrs:{"kind-channel-id":"0",width:"1920",height:"1080"}}),t("video",{ref:`talk-video-${e.id}`,staticClass:"kind-stream-canvas",staticStyle:{visibility:"hidden"},attrs:{"kind-channel-id":"0",width:"1920",height:"1080"}}),e.isLoading?t("img",{attrs:{src:e.loading}}):e._e()])},r=[],s=(n(8675),n(7380),n(1118),n(2801),n(1703),function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){n.d(t,"h",(function(){return l})),n.d(t,"a",(function(){return c})),n.d(t,"f",(function(){return a})),n.d(t,"g",(function(){return o})),n.d(t,"e",(function(){return f})),n.d(t,"c",(function(){return u})),n.d(t,"b",(function(){return h})),n.d(t,"d",(function(){return d}));var i={Opera:"Opera",Chrome:"Chrome",Firefox:"Firefox",Edge:"Edge",IE:"IE",Safari:"Safari",Ios:"Ios"};function r(){var e=navigator.userAgent;return e.includes("Edge")?i.Edge:e.includes("Firefox")?i.Firefox:e.includes("Chrome")?i.Chrome:e.includes("Safari")?i.Safari:e.includes("compatible")&&e.includes("MSIE")&&e.includes("Opera")?i.IE:e.includes("Opera")?i.Opera:/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream?i.Ios:""}function s(e){var t=navigator.userAgent;return"Ios"==e?"":t.split(e)[1].split(".")[0].slice(1)}function a(){var e=r(),t=s(e),n=!1,a=0;if("undefined"!=typeof SharedArrayBuffer)switch(e){case i.Chrome:n=t>=91,a=701;break;case i.Firefox:n=t>=97,a=702;break;case i.Edge:n=t>=91,a=703;break;default:n=0}return{bSupportMultiThread:n,browserType:e,errorCode:a}}function o(){var e=r(),t=s(e),n=!1;switch(e){case i.Ios:n=0;break;case i.Chrome:n=t>=104;break;default:n=0}return n}var l={log:function(){},error:function(){},count:function(){},info:function(){}};function c(){var e=navigator.userAgent.toLowerCase(),t=navigator.appName,n=null;return"Microsoft Internet Explorer"===t||e.indexOf("trident")>-1||e.indexOf("edge/")>-1?(n="ie","Microsoft Internet Explorer"===t?(e=/msie ([0-9]{1,}[\.0-9]{0,})/.exec(e),n+=parseInt(e[1])):e.indexOf("trident")>-1?n+=11:e.indexOf("edge/")>-1&&(n="edge")):e.indexOf("safari")>-1?n=e.indexOf("chrome")>-1?"chrome":"safari":e.indexOf("firefox")>-1&&(n="firefox"),n}var u=function(){function e(){}return e.createFromElementId=function(t){for(var n=document.getElementById(t),i="",r=n.firstChild;r;)3===r.nodeType&&(i+=r.textContent),r=r.nextSibling;var s=new e;return s.type=n.type,s.source=i,s},e.createFromSource=function(t,n){var i=new e;return i.type=t,i.source=n,i},e}(),d=function(){return function(e,t){if("x-shader/x-fragment"===t.type)this.shader=e.createShader(e.FRAGMENT_SHADER);else{if("x-shader/x-vertex"!==t.type)return void error("Unknown shader type: "+t.type);this.shader=e.createShader(e.VERTEX_SHADER)}e.shaderSource(this.shader,t.source),e.compileShader(this.shader),e.getShaderParameter(this.shader,e.COMPILE_STATUS)||error("An error occurred compiling the shaders: "+e.getShaderInfoLog(this.shader))}}(),h=function(){function e(e){this.gl=e,this.program=this.gl.createProgram()}return e.prototype={attach:function(e){this.gl.attachShader(this.program,e.shader)},link:function(){this.gl.linkProgram(this.program)},use:function(){this.gl.useProgram(this.program)},getAttributeLocation:function(e){return this.gl.getAttribLocation(this.program,e)},setMatrixUniform:function(e,t){var n=this.gl.getUniformLocation(this.program,e);this.gl.uniformMatrix4fv(n,!1,t)}},e}(),f=function(){var e=null;function t(e,t,n){this.gl=e,this.size=t,this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),this.format=n||e.LUMINANCE,e.texImage2D(e.TEXTURE_2D,0,this.format,t.w,t.h,0,this.format,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}return t.prototype={fill:function(e,t){var n=this.gl;n.bindTexture(n.TEXTURE_2D,this.texture),t?n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.size.w,this.size.h,this.format,n.UNSIGNED_BYTE,e):n.texImage2D(n.TEXTURE_2D,0,this.format,this.size.w,this.size.h,0,this.format,n.UNSIGNED_BYTE,e)},bind:function(t,n,i){var r=this.gl;e||(e=[r.TEXTURE0,r.TEXTURE1,r.TEXTURE2]),r.activeTexture(e[t]),r.bindTexture(r.TEXTURE_2D,this.texture),r.uniform1i(r.getUniformLocation(n.program,i),t)}},t}()},function(e,t){e.exports=function(){return new Worker("/playerWasm/audioTalkWorker.worker.js")}},function(e,t,n){n.r(t);var i=n(0),r=1e-6;function s(){}function a(){}function o(){}function l(){}s.prototype={e:function(e){return e<1||e>this.elements.length?null:this.elements[e-1]},dimensions:function(){return this.elements.length},modulus:function(){return Math.sqrt(this.dot(this))},eql:function(e){var t=this.elements.length,n=e.elements||e;if(t!=n.length)return!1;do{if(Math.abs(this.elements[t-1]-n[t-1])>r)return!1}while(--t);return!0},dup:function(){return s.create(this.elements)},map:function(e){var t=[];return this.each((function(n,i){t.push(e(n,i))})),s.create(t)},each:function(e){var t,n=this.elements.length,i=n;do{t=i-n,e(this.elements[t],t+1)}while(--n)},toUnitVector:function(){var e=this.modulus();return 0===e?this.dup():this.map((function(t){return t/e}))},angleFrom:function(e){var t=e.elements||e,n=this.elements.length;if(n!=t.length)return null;var i=0,r=0,s=0;if(this.each((function(e,n){i+=e*t[n-1],r+=e*e,s+=t[n-1]*t[n-1]})),r=Math.sqrt(r),s=Math.sqrt(s),r*s===0)return null;var a=i/(r*s);return a<-1&&(a=-1),a>1&&(a=1),Math.acos(a)},isParallelTo:function(e){var t=this.angleFrom(e);return null===t?null:t<=r},isAntiparallelTo:function(e){var t=this.angleFrom(e);return null===t?null:Math.abs(t-Math.PI)<=r},isPerpendicularTo:function(e){var t=this.dot(e);return null===t?null:Math.abs(t)<=r},add:function(e){var t=e.elements||e;return this.elements.length!=t.length?null:this.map((function(e,n){return e+t[n-1]}))},subtract:function(e){var t=e.elements||e;return this.elements.length!=t.length?null:this.map((function(e,n){return e-t[n-1]}))},multiply:function(e){return this.map((function(t){return t*e}))},x:function(e){return this.multiply(e)},dot:function(e){var t=e.elements||e,n=0,i=this.elements.length;if(i!=t.length)return null;do{n+=this.elements[i-1]*t[i-1]}while(--i);return n},cross:function(e){var t=e.elements||e;if(3!=this.elements.length||3!=t.length)return null;var n=this.elements;return s.create([n[1]*t[2]-n[2]*t[1],n[2]*t[0]-n[0]*t[2],n[0]*t[1]-n[1]*t[0]])},max:function(){var e,t=0,n=this.elements.length,i=n;do{e=i-n,Math.abs(this.elements[e])>Math.abs(t)&&(t=this.elements[e])}while(--n);return t},indexOf:function(e){var t,n=null,i=this.elements.length,r=i;do{t=r-i,null===n&&this.elements[t]==e&&(n=t+1)}while(--i);return n},toDiagonalMatrix:function(){return a.Diagonal(this.elements)},round:function(){return this.map((function(e){return Math.round(e)}))},snapTo:function(e){return this.map((function(t){return Math.abs(t-e)<=r?e:t}))},distanceFrom:function(e){if(e.anchor)return e.distanceFrom(this);var t=e.elements||e;if(t.length!=this.elements.length)return null;var n,i=0;return this.each((function(e,r){n=e-t[r-1],i+=n*n})),Math.sqrt(i)},liesOn:function(e){return e.contains(this)},liesIn:function(e){return e.contains(this)},rotate:function(e,t){var n,i,r,o,l;switch(this.elements.length){case 2:return 2!=(n=t.elements||t).length?null:(i=a.Rotation(e).elements,r=this.elements[0]-n[0],o=this.elements[1]-n[1],s.create([n[0]+i[0][0]*r+i[0][1]*o,n[1]+i[1][0]*r+i[1][1]*o]));case 3:if(!t.direction)return null;var c=t.pointClosestTo(this).elements;return i=a.Rotation(e,t.direction).elements,r=this.elements[0]-c[0],o=this.elements[1]-c[1],l=this.elements[2]-c[2],s.create([c[0]+i[0][0]*r+i[0][1]*o+i[0][2]*l,c[1]+i[1][0]*r+i[1][1]*o+i[1][2]*l,c[2]+i[2][0]*r+i[2][1]*o+i[2][2]*l]);default:return null}},reflectionIn:function(e){if(e.anchor){var t=this.elements.slice(),n=e.pointClosestTo(t).elements;return s.create([n[0]+(n[0]-t[0]),n[1]+(n[1]-t[1]),n[2]+(n[2]-(t[2]||0))])}var i=e.elements||e;return this.elements.length!=i.length?null:this.map((function(e,t){return i[t-1]+(i[t-1]-e)}))},to3D:function(){var e=this.dup();switch(e.elements.length){case 3:break;case 2:e.elements.push(0);break;default:return null}return e},inspect:function(){return"["+this.elements.join(", ")+"]"},setElements:function(e){return this.elements=(e.elements||e).slice(),this}},s.create=function(e){return(new s).setElements(e)},s.i=s.create([1,0,0]),s.j=s.create([0,1,0]),s.k=s.create([0,0,1]),s.Random=function(e){var t=[];do{t.push(Math.random())}while(--e);return s.create(t)},s.Zero=function(e){var t=[];do{t.push(0)}while(--e);return s.create(t)},a.prototype={e:function(e,t){return e<1||e>this.elements.length||t<1||t>this.elements[0].length?null:this.elements[e-1][t-1]},row:function(e){return e>this.elements.length?null:s.create(this.elements[e-1])},col:function(e){if(e>this.elements[0].length)return null;var t,n=[],i=this.elements.length,r=i;do{t=r-i,n.push(this.elements[t][e-1])}while(--i);return s.create(n)},dimensions:function(){return{rows:this.elements.length,cols:this.elements[0].length}},rows:function(){return this.elements.length},cols:function(){return this.elements[0].length},eql:function(e){var t=e.elements||e;if("undefined"==typeof t[0][0]&&(t=a.create(t).elements),this.elements.length!=t.length||this.elements[0].length!=t[0].length)return!1;var n,i,s,o=this.elements.length,l=o,c=this.elements[0].length;do{n=l-o,i=c;do{if(s=c-i,Math.abs(this.elements[n][s]-t[n][s])>r)return!1}while(--i)}while(--o);return!0},dup:function(){return a.create(this.elements)},map:function(e){var t,n,i,r=[],s=this.elements.length,o=s,l=this.elements[0].length;do{n=l,r[t=o-s]=[];do{i=l-n,r[t][i]=e(this.elements[t][i],t+1,i+1)}while(--n)}while(--s);return a.create(r)},isSameSizeAs:function(e){var t=e.elements||e;return"undefined"==typeof t[0][0]&&(t=a.create(t).elements),this.elements.length==t.length&&this.elements[0].length==t[0].length},add:function(e){var t=e.elements||e;return"undefined"==typeof t[0][0]&&(t=a.create(t).elements),this.isSameSizeAs(t)?this.map((function(e,n,i){return e+t[n-1][i-1]})):null},subtract:function(e){var t=e.elements||e;return"undefined"==typeof t[0][0]&&(t=a.create(t).elements),this.isSameSizeAs(t)?this.map((function(e,n,i){return e-t[n-1][i-1]})):null},canMultiplyFromLeft:function(e){var t=e.elements||e;return"undefined"==typeof t[0][0]&&(t=a.create(t).elements),this.elements[0].length==t.length},multiply:function(e){if(!e.elements)return this.map((function(t){return t*e}));var t=!!e.modulus;if("undefined"==typeof(p=e.elements||e)[0][0]&&(p=a.create(p).elements),!this.canMultiplyFromLeft(p))return null;var n,i,r,s,o,l,c=this.elements.length,u=c,d=p[0].length,h=this.elements[0].length,f=[];do{f[n=u-c]=[],i=d;do{r=d-i,s=0,o=h;do{l=h-o,s+=this.elements[n][l]*p[l][r]}while(--o);f[n][r]=s}while(--i)}while(--c);var p=a.create(f);return t?p.col(1):p},x:function(e){return this.multiply(e)},minor:function(e,t,n,i){var r,s,o,l=[],c=n,u=this.elements.length,d=this.elements[0].length;do{l[r=n-c]=[],s=i;do{o=i-s,l[r][o]=this.elements[(e+r-1)%u][(t+o-1)%d]}while(--s)}while(--c);return a.create(l)},transpose:function(){var e,t,n,i=this.elements.length,r=this.elements[0].length,s=[],o=r;do{s[e=r-o]=[],t=i;do{n=i-t,s[e][n]=this.elements[n][e]}while(--t)}while(--o);return a.create(s)},isSquare:function(){return this.elements.length==this.elements[0].length},max:function(){var e,t,n,i=0,r=this.elements.length,s=r,a=this.elements[0].length;do{e=s-r,t=a;do{n=a-t,Math.abs(this.elements[e][n])>Math.abs(i)&&(i=this.elements[e][n])}while(--t)}while(--r);return i},indexOf:function(e){var t,n,i,r=this.elements.length,s=r,a=this.elements[0].length;do{t=s-r,n=a;do{if(i=a-n,this.elements[t][i]==e)return{i:t+1,j:i+1}}while(--n)}while(--r);return null},diagonal:function(){if(!this.isSquare)return null;var e,t=[],n=this.elements.length,i=n;do{e=i-n,t.push(this.elements[e][e])}while(--n);return s.create(t)},toRightTriangular:function(){var e,t,n,i,r=this.dup(),s=this.elements.length,a=s,o=this.elements[0].length;do{if(t=a-s,0==r.elements[t][t])for(j=t+1;j<a;j++)if(0!=r.elements[j][t]){e=[],n=o;do{i=o-n,e.push(r.elements[t][i]+r.elements[j][i])}while(--n);r.elements[t]=e;break}if(0!=r.elements[t][t])for(j=t+1;j<a;j++){var l=r.elements[j][t]/r.elements[t][t];e=[],n=o;do{i=o-n,e.push(i<=t?0:r.elements[j][i]-r.elements[t][i]*l)}while(--n);r.elements[j]=e}}while(--s);return r},toUpperTriangular:function(){return this.toRightTriangular()},determinant:function(){if(!this.isSquare())return null;var e,t=this.toRightTriangular(),n=t.elements[0][0],i=t.elements.length-1,r=i;do{e=r-i+1,n*=t.elements[e][e]}while(--i);return n},det:function(){return this.determinant()},isSingular:function(){return this.isSquare()&&0===this.determinant()},trace:function(){if(!this.isSquare())return null;var e,t=this.elements[0][0],n=this.elements.length-1,i=n;do{e=i-n+1,t+=this.elements[e][e]}while(--n);return t},tr:function(){return this.trace()},rank:function(){var e,t,n,i=this.toRightTriangular(),s=0,a=this.elements.length,o=a,l=this.elements[0].length;do{e=o-a,t=l;do{if(n=l-t,Math.abs(i.elements[e][n])>r){s++;break}}while(--t)}while(--a);return s},rk:function(){return this.rank()},augment:function(e){var t=e.elements||e;"undefined"==typeof t[0][0]&&(t=a.create(t).elements);var n,i,r,s=this.dup(),o=s.elements[0].length,l=s.elements.length,c=l,u=t[0].length;if(l!=t.length)return null;do{n=c-l,i=u;do{r=u-i,s.elements[n][o+r]=t[n][r]}while(--i)}while(--l);return s},inverse:function(){if(!this.isSquare()||this.isSingular())return null;var e,t,n,i,r,s,o,l=this.elements.length,c=l,u=this.augment(a.I(l)).toRightTriangular(),d=u.elements[0].length,h=[];do{r=[],n=d,h[e=l-1]=[],s=u.elements[e][e];do{i=d-n,o=u.elements[e][i]/s,r.push(o),i>=c&&h[e].push(o)}while(--n);for(u.elements[e]=r,t=0;t<e;t++){r=[],n=d;do{i=d-n,r.push(u.elements[t][i]-u.elements[e][i]*u.elements[t][e])}while(--n);u.elements[t]=r}}while(--l);return a.create(h)},inv:function(){return this.inverse()},round:function(){return this.map((function(e){return Math.round(e)}))},snapTo:function(e){return this.map((function(t){return Math.abs(t-e)<=r?e:t}))},inspect:function(){var e,t=[],n=this.elements.length,i=n;do{e=i-n,t.push(s.create(this.elements[e]).inspect())}while(--n);return t.join("\n")},setElements:function(e){var t,n=e.elements||e;if("undefined"!=typeof n[0][0]){var i,r,s,a=n.length,o=a;this.elements=[];do{r=i=n[t=o-a].length,this.elements[t]=[];do{s=r-i,this.elements[t][s]=n[t][s]}while(--i)}while(--a);return this}var l=n.length,c=l;this.elements=[];do{t=c-l,this.elements.push([n[t]])}while(--l);return this}},a.create=function(e){return(new a).setElements(e)},a.I=function(e){var t,n,i,r=[],s=e;do{r[t=s-e]=[],n=s;do{i=s-n,r[t][i]=t==i?1:0}while(--n)}while(--e);return a.create(r)},a.Diagonal=function(e){var t,n=e.length,i=n,r=a.I(n);do{t=i-n,r.elements[t][t]=e[t]}while(--n);return r},a.Rotation=function(e,t){if(!t)return a.create([[Math.cos(e),-Math.sin(e)],[Math.sin(e),Math.cos(e)]]);var n=t.dup();if(3!=n.elements.length)return null;var i=n.modulus(),r=n.elements[0]/i,s=n.elements[1]/i,o=n.elements[2]/i,l=Math.sin(e),c=Math.cos(e),u=1-c;return a.create([[u*r*r+c,u*r*s-l*o,u*r*o+l*s],[u*r*s+l*o,u*s*s+c,u*s*o-l*r],[u*r*o-l*s,u*s*o+l*r,u*o*o+c]])},a.RotationX=function(e){var t=Math.cos(e),n=Math.sin(e);return a.create([[1,0,0],[0,t,-n],[0,n,t]])},a.RotationY=function(e){var t=Math.cos(e),n=Math.sin(e);return a.create([[t,0,n],[0,1,0],[-n,0,t]])},a.RotationZ=function(e){var t=Math.cos(e),n=Math.sin(e);return a.create([[t,-n,0],[n,t,0],[0,0,1]])},a.Random=function(e,t){return a.Zero(e,t).map((function(){return Math.random()}))},a.Zero=function(e,t){var n,i,r,s=[],o=e;do{s[n=e-o]=[],i=t;do{r=t-i,s[n][r]=0}while(--i)}while(--o);return a.create(s)},o.prototype={eql:function(e){return this.isParallelTo(e)&&this.contains(e.anchor)},dup:function(){return o.create(this.anchor,this.direction)},translate:function(e){var t=e.elements||e;return o.create([this.anchor.elements[0]+t[0],this.anchor.elements[1]+t[1],this.anchor.elements[2]+(t[2]||0)],this.direction)},isParallelTo:function(e){if(e.normal)return e.isParallelTo(this);var t=this.direction.angleFrom(e.direction);return Math.abs(t)<=r||Math.abs(t-Math.PI)<=r},distanceFrom:function(e){if(e.normal)return e.distanceFrom(this);if(e.direction){if(this.isParallelTo(e))return this.distanceFrom(e.anchor);var t=this.direction.cross(e.direction).toUnitVector().elements,n=this.anchor.elements,i=e.anchor.elements;return Math.abs((n[0]-i[0])*t[0]+(n[1]-i[1])*t[1]+(n[2]-i[2])*t[2])}var r=e.elements||e,s=(n=this.anchor.elements,this.direction.elements),a=r[0]-n[0],o=r[1]-n[1],l=(r[2]||0)-n[2],c=Math.sqrt(a*a+o*o+l*l);if(0===c)return 0;var u=(a*s[0]+o*s[1]+l*s[2])/c,d=1-u*u;return Math.abs(c*Math.sqrt(d<0?0:d))},contains:function(e){var t=this.distanceFrom(e);return null!==t&&t<=r},liesIn:function(e){return e.contains(this)},intersects:function(e){return e.normal?e.intersects(this):!this.isParallelTo(e)&&this.distanceFrom(e)<=r},intersectionWith:function(e){if(e.normal)return e.intersectionWith(this);if(!this.intersects(e))return null;var t=this.anchor.elements,n=this.direction.elements,i=e.anchor.elements,r=e.direction.elements,a=n[0],o=n[1],l=n[2],c=r[0],u=r[1],d=r[2],h=t[0]-i[0],f=t[1]-i[1],p=t[2]-i[2],m=c*c+u*u+d*d,g=a*c+o*u+l*d,v=((-a*h-o*f-l*p)*m/(a*a+o*o+l*l)+g*(c*h+u*f+d*p))/(m-g*g);return s.create([t[0]+v*a,t[1]+v*o,t[2]+v*l])},pointClosestTo:function(e){if(e.direction){if(this.intersects(e))return this.intersectionWith(e);if(this.isParallelTo(e))return null;var t=this.direction.elements,n=e.direction.elements,i=t[0],r=t[1],a=t[2],o=n[0],c=n[1],u=n[2],d=a*o-i*u,h=i*c-r*o,f=r*u-a*c,p=s.create([d*u-h*c,h*o-f*u,f*c-d*o]);return(m=l.create(e.anchor,p)).intersectionWith(this)}var m=e.elements||e;if(this.contains(m))return s.create(m);var g=this.anchor.elements,v=(i=(t=this.direction.elements)[0],r=t[1],a=t[2],g[0]),y=g[1],w=g[2],S=(d=i*(m[1]-y)-r*(m[0]-v),h=r*((m[2]||0)-w)-a*(m[1]-y),f=a*(m[0]-v)-i*((m[2]||0)-w),s.create([r*d-a*f,a*h-i*d,i*f-r*h])),b=this.distanceFrom(m)/S.modulus();return s.create([m[0]+S.elements[0]*b,m[1]+S.elements[1]*b,(m[2]||0)+S.elements[2]*b])},rotate:function(e,t){"undefined"==typeof t.direction&&(t=o.create(t.to3D(),s.k));var n=a.Rotation(e,t.direction).elements,i=t.pointClosestTo(this.anchor).elements,r=this.anchor.elements,l=this.direction.elements,c=i[0],u=i[1],d=i[2],h=r[0]-c,f=r[1]-u,p=r[2]-d;return o.create([c+n[0][0]*h+n[0][1]*f+n[0][2]*p,u+n[1][0]*h+n[1][1]*f+n[1][2]*p,d+n[2][0]*h+n[2][1]*f+n[2][2]*p],[n[0][0]*l[0]+n[0][1]*l[1]+n[0][2]*l[2],n[1][0]*l[0]+n[1][1]*l[1]+n[1][2]*l[2],n[2][0]*l[0]+n[2][1]*l[1]+n[2][2]*l[2]])},reflectionIn:function(e){if(e.normal){var t=this.anchor.elements,n=this.direction.elements,i=t[0],r=t[1],s=t[2],a=n[0],l=n[1],c=n[2],u=this.anchor.reflectionIn(e).elements,d=i+a,h=r+l,f=s+c,p=e.pointClosestTo([d,h,f]).elements,m=[p[0]+(p[0]-d)-u[0],p[1]+(p[1]-h)-u[1],p[2]+(p[2]-f)-u[2]];return o.create(u,m)}if(e.direction)return this.rotate(Math.PI,e);var g=e.elements||e;return o.create(this.anchor.reflectionIn([g[0],g[1],g[2]||0]),this.direction)},setVectors:function(e,t){if(e=s.create(e),t=s.create(t),2==e.elements.length&&e.elements.push(0),2==t.elements.length&&t.elements.push(0),e.elements.length>3||t.elements.length>3)return null;var n=t.modulus();return 0===n?null:(this.anchor=e,this.direction=s.create([t.elements[0]/n,t.elements[1]/n,t.elements[2]/n]),this)}},o.create=function(e,t){return(new o).setVectors(e,t)},o.X=o.create(s.Zero(3),s.i),o.Y=o.create(s.Zero(3),s.j),o.Z=o.create(s.Zero(3),s.k),l.prototype={eql:function(e){return this.contains(e.anchor)&&this.isParallelTo(e)},dup:function(){return l.create(this.anchor,this.normal)},translate:function(e){var t=e.elements||e;return l.create([this.anchor.elements[0]+t[0],this.anchor.elements[1]+t[1],this.anchor.elements[2]+(t[2]||0)],this.normal)},isParallelTo:function(e){var t;return e.normal?(t=this.normal.angleFrom(e.normal),Math.abs(t)<=r||Math.abs(Math.PI-t)<=r):e.direction?this.normal.isPerpendicularTo(e.direction):null},isPerpendicularTo:function(e){var t=this.normal.angleFrom(e.normal);return Math.abs(Math.PI/2-t)<=r},distanceFrom:function(e){if(this.intersects(e)||this.contains(e))return 0;if(e.anchor){var t=this.anchor.elements,n=e.anchor.elements,i=this.normal.elements;return Math.abs((t[0]-n[0])*i[0]+(t[1]-n[1])*i[1]+(t[2]-n[2])*i[2])}var r=e.elements||e;return t=this.anchor.elements,i=this.normal.elements,Math.abs((t[0]-r[0])*i[0]+(t[1]-r[1])*i[1]+(t[2]-(r[2]||0))*i[2])},contains:function(e){if(e.normal)return null;if(e.direction)return this.contains(e.anchor)&&this.contains(e.anchor.add(e.direction));var t=e.elements||e,n=this.anchor.elements,i=this.normal.elements;return Math.abs(i[0]*(n[0]-t[0])+i[1]*(n[1]-t[1])+i[2]*(n[2]-(t[2]||0)))<=r},intersects:function(e){return"undefined"==typeof e.direction&&"undefined"==typeof e.normal?null:!this.isParallelTo(e)},intersectionWith:function(e){if(!this.intersects(e))return null;if(e.direction){var t=e.anchor.elements,n=e.direction.elements,i=this.anchor.elements,r=((c=this.normal.elements)[0]*(i[0]-t[0])+c[1]*(i[1]-t[1])+c[2]*(i[2]-t[2]))/(c[0]*n[0]+c[1]*n[1]+c[2]*n[2]);return s.create([t[0]+n[0]*r,t[1]+n[1]*r,t[2]+n[2]*r])}if(e.normal){for(var l=this.normal.cross(e.normal).toUnitVector(),c=this.normal.elements,u=(t=this.anchor.elements,e.normal.elements),d=e.anchor.elements,h=a.Zero(2,2),f=0;h.isSingular();)f++,h=a.create([[c[f%3],c[(f+1)%3]],[u[f%3],u[(f+1)%3]]]);for(var p=h.inverse().elements,m=c[0]*t[0]+c[1]*t[1]+c[2]*t[2],g=u[0]*d[0]+u[1]*d[1]+u[2]*d[2],v=[p[0][0]*m+p[0][1]*g,p[1][0]*m+p[1][1]*g],y=[],w=1;w<=3;w++)y.push(f==w?0:v[(w+(5-f)%3)%3]);return o.create(y,l)}},pointClosestTo:function(e){var t=e.elements||e,n=this.anchor.elements,i=this.normal.elements,r=(n[0]-t[0])*i[0]+(n[1]-t[1])*i[1]+(n[2]-(t[2]||0))*i[2];return s.create([t[0]+i[0]*r,t[1]+i[1]*r,(t[2]||0)+i[2]*r])},rotate:function(e,t){var n=a.Rotation(e,t.direction).elements,i=t.pointClosestTo(this.anchor).elements,r=this.anchor.elements,s=this.normal.elements,o=i[0],c=i[1],u=i[2],d=r[0]-o,h=r[1]-c,f=r[2]-u;return l.create([o+n[0][0]*d+n[0][1]*h+n[0][2]*f,c+n[1][0]*d+n[1][1]*h+n[1][2]*f,u+n[2][0]*d+n[2][1]*h+n[2][2]*f],[n[0][0]*s[0]+n[0][1]*s[1]+n[0][2]*s[2],n[1][0]*s[0]+n[1][1]*s[1]+n[1][2]*s[2],n[2][0]*s[0]+n[2][1]*s[1]+n[2][2]*s[2]])},reflectionIn:function(e){if(e.normal){var t=this.anchor.elements,n=this.normal.elements,i=t[0],r=t[1],s=t[2],a=n[0],o=n[1],c=n[2],u=this.anchor.reflectionIn(e).elements,d=i+a,h=r+o,f=s+c,p=e.pointClosestTo([d,h,f]).elements,m=[p[0]+(p[0]-d)-u[0],p[1]+(p[1]-h)-u[1],p[2]+(p[2]-f)-u[2]];return l.create(u,m)}if(e.direction)return this.rotate(Math.PI,e);var g=e.elements||e;return l.create(this.anchor.reflectionIn([g[0],g[1],g[2]||0]),this.normal)},setVectors:function(e,t,n){if(null===(e=(e=s.create(e)).to3D()))return null;if(null===(t=(t=s.create(t)).to3D()))return null;if("undefined"==typeof n)n=null;else if(null===(n=(n=s.create(n)).to3D()))return null;var i,r,a=e.elements[0],o=e.elements[1],l=e.elements[2],c=t.elements[0],u=t.elements[1],d=t.elements[2];if(null!==n){var h=n.elements[0],f=n.elements[1],p=n.elements[2];if(0===(r=(i=s.create([(u-o)*(p-l)-(d-l)*(f-o),(d-l)*(h-a)-(c-a)*(p-l),(c-a)*(f-o)-(u-o)*(h-a)])).modulus()))return null;i=s.create([i.elements[0]/r,i.elements[1]/r,i.elements[2]/r])}else{if(0===(r=Math.sqrt(c*c+u*u+d*d)))return null;i=s.create([t.elements[0]/r,t.elements[1]/r,t.elements[2]/r])}return this.anchor=e,this.normal=i,this}},a.Translation=function(e){var t;if(2===e.elements.length)return(t=a.I(3)).elements[2][0]=e.elements[0],t.elements[2][1]=e.elements[1],t;if(3===e.elements.length)return(t=a.I(4)).elements[0][3]=e.elements[0],t.elements[1][3]=e.elements[1],t.elements[2][3]=e.elements[2],t;throw"Invalid length for Translation"},a.prototype.flatten=function(){var e=[];if(0===this.elements.length)return[];for(var t=0;t<this.elements[0].length;t++)for(var n=0;n<this.elements.length;n++)e.push(this.elements[n][t]);return e},a.prototype.ensure4x4=function(){var e;if(4===this.elements.length&&4===this.elements[0].length)return this;if(this.elements.length>4||this.elements[0].length>4)return null;for(e=0;e<this.elements.length;e++)for(var t=this.elements[e].length;t<4;t++)e===t?this.elements[e].push(1):this.elements[e].push(0);for(e=this.elements.length;e<4;e++)0===e?this.elements.push([1,0,0,0]):1===e?this.elements.push([0,1,0,0]):2===e?this.elements.push([0,0,1,0]):3===e&&this.elements.push([0,0,0,1]);return this},a.prototype.make3x3=function(){return 4!==this.elements.length||4!==this.elements[0].length?null:a.create([[this.elements[0][0],this.elements[0][1],this.elements[0][2]],[this.elements[1][0],this.elements[1][1],this.elements[1][2]],[this.elements[2][0],this.elements[2][1],this.elements[2][2]]])},l.create=function(e,t,n){return(new l).setVectors(e,t,n)},l.XY=l.create(s.Zero(3),s.k),l.YZ=l.create(s.Zero(3),s.i),l.ZX=l.create(s.Zero(3),s.j),l.YX=l.XY,l.ZY=l.YZ,l.XZ=l.ZX;var c=s.create,u=a.create,d=(o.create,l.create,function(){function e(e,t,n){i.e.call(this,e,t,n)}return e.prototype=p(i.e,{fill:function(e,t){var n=this.gl;n.bindTexture(n.TEXTURE_2D,this.texture),t?n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.size.w,this.size.h,this.format,n.UNSIGNED_BYTE,e):n.texImage2D(n.TEXTURE_2D,0,this.format,this.format,n.UNSIGNED_BYTE,e)}}),e}()),h=function(){var e=i.c.createFromSource("x-shader/x-vertex",m(["attribute vec3 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat4 uMVMatrix;","uniform mat4 uPMatrix;","varying highp vec2 vTextureCoord;","void main(void) {","  gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);","  vTextureCoord = aTextureCoord;","}"])),t=i.c.createFromSource("x-shader/x-fragment",m(["precision highp float;","varying highp vec2 vTextureCoord;","uniform sampler2D texture;","void main(void) {","  gl_FragColor = texture2D(texture, vTextureCoord);","}"]));function n(e,t,n){this.canvas=e,this.size=t,this.canvas.width=t.w,this.canvas.height=t.h,this.onInitWebGL(),this.onInitShaders(),function(){var e=[1,1,0,-1,1,0,1,-1,0,-1,-1,0],t=this.gl;this.quadVPBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.quadVPBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW),this.quadVPBuffer.itemSize=3,this.quadVPBuffer.numItems=4,this.quadVTCBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.quadVTCBuffer),e=[1,0,0,0,1,1,0,1],t.bufferData(t.ARRAY_BUFFER,new Float32Array(e),t.STATIC_DRAW)}.call(this),n&&function(){var e=this.gl;this.framebuffer=e.createFramebuffer(),e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer),this.framebufferTexture=new i.e(this.gl,this.size,e.RGBA);var t=e.createRenderbuffer();e.bindRenderbuffer(e.RENDERBUFFER,t),e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_COMPONENT16,this.size.w,this.size.h),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this.framebufferTexture.texture,0),e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t)}.call(this),this.onInitTextures(),function(){var e=this.gl;this.perspectiveMatrix=function(e,t,n,i){var r=n*Math.tan(e*Math.PI/360),s=-r;return function(e,t,n,i,r,s){return u([[2*r/(t-e),0,(t+e)/(t-e),0],[0,2*r/(i-n),(i+n)/(i-n),0],[0,0,-(s+r)/(s-r),-2*s*r/(s-r)],[0,0,-1,0]])}(s*t,r*t,s,r,n,i)}(45,1,.1,100),r.call(this),s.call(this,[0,0,-2.415]),e.bindBuffer(e.ARRAY_BUFFER,this.quadVPBuffer),e.vertexAttribPointer(this.vertexPositionAttribute,3,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this.quadVTCBuffer),e.vertexAttribPointer(this.textureCoordAttribute,2,e.FLOAT,!1,0,0),this.onInitSceneTextures(),o.call(this),this.framebuffer&&e.bindFramebuffer(e.FRAMEBUFFER,this.framebuffer)}.call(this)}function r(){this.mvMatrix=a.I(4)}function s(e){(function(e){this.mvMatrix=this.mvMatrix.x(e)}).call(this,a.Translation(c([e[0],e[1],e[2]])).ensure4x4())}function o(){this.program.setMatrixUniform("uPMatrix",new Float32Array(this.perspectiveMatrix.flatten())),this.program.setMatrixUniform("uMVMatrix",new Float32Array(this.mvMatrix.flatten()))}return n.prototype={toString:function(){return"WebGLCanvas Size: "+this.size},checkLastError:function(e){var t=this.gl.getError();if(t!==this.gl.NO_ERROR){var n=this.glNames[t];n="undefined"!==typeof n?n+"("+t+")":"Unknown WebGL ENUM (0x"+value.toString(16)+")",e?i.h.log("WebGL Error: %s, %s",e,n):i.h.log("WebGL Error: %s",n),i.h.trace()}},onInitWebGL:function(){try{this.gl=this.canvas.getContext("webgl")}catch(e){i.h.log("inInitWebGL error = "+e)}if(this.gl||i.h.error("Unable to initialize WebGL. Your browser may not support it."),!this.glNames)for(var e in this.glNames={},this.gl)"number"===typeof this.gl[e]&&(this.glNames[this.gl[e]]=e)},onInitShaders:function(){this.program=new i.b(this.gl),this.program.attach(new i.d(this.gl,e)),this.program.attach(new i.d(this.gl,t)),this.program.link(),this.program.use(),this.vertexPositionAttribute=this.program.getAttributeLocation("aVertexPosition"),this.gl.enableVertexAttribArray(this.vertexPositionAttribute),this.textureCoordAttribute=this.program.getAttributeLocation("aTextureCoord"),this.gl.enableVertexAttribArray(this.textureCoordAttribute)},onInitTextures:function(){var e=this.gl;e.viewport(0,0,this.canvas.width,this.canvas.height),this.texture=new i.e(e,this.size,e.RGBA)},onInitSceneTextures:function(){this.texture.bind(0,this.program,"texture")},drawScene:function(){this.gl.drawArrays(this.gl.TRIANGLE_STRIP,0,4)},updateVertexArray:function(e){this.zoomScene(e)},readPixels:function(e){var t=this.gl;t.readPixels(0,0,this.size.w,this.size.h,t.RGBA,t.UNSIGNED_BYTE,e)},zoomScene:function(e){r.call(this),s.call(this,[e[0],e[1],e[2]]),o.call(this),this.drawScene()},setViewport:function(e,t){var n,r;i.h.log("toWidth="+e+",toHeight="+t),this.gl.drawingBufferWidth<e||this.gl.drawingBufferHeight<t?(n=this.gl.drawingBufferWidth,r=this.gl.drawingBufferHeight,this.canvas.width=n,this.canvas.height=r):(n=e,r=t),this.gl.viewport(0,0,n,r)},clearCanvas:function(){this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.DEPTH_BUFFER_BIT|this.gl.COLOR_BUFFER_BIT)}},n}(),f=(function(){function e(e,t){h.call(this,e,t)}e.prototype=p(h,{drawCanvas:function(e){this.texture.fill(e),this.drawScene()},onInitTextures:function(){var e=this.gl;this.setViewport(this.canvas.width,this.canvas.height),this.texture=new d(e,this.size,e.RGBA)},initCanvas:function(){this.gl.clear(this.gl.DEPTH_BUFFER_BIT|this.gl.COLOR_BUFFER_BIT)}})}(),function(){var e=i.c.createFromSource("x-shader/x-vertex",m(["attribute vec3 aVertexPosition;","attribute vec2 aTextureCoord;","uniform mat4 uMVMatrix;","uniform mat4 uPMatrix;","varying highp vec2 vTextureCoord;","void main(void) {","  gl_Position = uPMatrix * uMVMatrix * vec4(aVertexPosition, 1.0);","  vTextureCoord = aTextureCoord;","}"])),t=i.c.createFromSource("x-shader/x-fragment",m(["precision highp float;","varying highp vec2 vTextureCoord;","uniform sampler2D YTexture;","uniform sampler2D UTexture;","uniform sampler2D VTexture;","const mat4 YUV2RGB = mat4","("," 1.16438, 0.00000, 1.59603, -.87079,"," 1.16438, -.39176, -.81297, .52959,"," 1.16438, 2.01723, 0, -1.08139,"," 0, 0, 0, 1",");","void main(void) {"," gl_FragColor = vec4( texture2D(YTexture,  vTextureCoord).x, texture2D(UTexture, vTextureCoord).x, texture2D(VTexture, vTextureCoord).x, 1) * YUV2RGB;","}"]));function n(e,t){h.call(this,e,t)}return n.prototype=p(h,{onInitShaders:function(){this.program=new i.b(this.gl),this.program.attach(new i.d(this.gl,e)),this.program.attach(new i.d(this.gl,t)),this.program.link(),this.program.use(),this.vertexPositionAttribute=this.program.getAttributeLocation("aVertexPosition"),this.gl.enableVertexAttribArray(this.vertexPositionAttribute),this.textureCoordAttribute=this.program.getAttributeLocation("aTextureCoord"),this.gl.enableVertexAttribArray(this.textureCoordAttribute)},onInitTextures:function(){this.setViewport(this.size.w,this.size.h),this.YTexture=new i.e(this.gl,this.size),this.UTexture=new i.e(this.gl,this.size.getHalfSize()),this.VTexture=new i.e(this.gl,this.size.getHalfSize())},onInitSceneTextures:function(){this.YTexture.bind(0,this.program,"YTexture"),this.UTexture.bind(1,this.program,"UTexture"),this.VTexture.bind(2,this.program,"VTexture")},fillYUVTextures:function(e,t,n){this.YTexture.fill(e),this.UTexture.fill(t),this.VTexture.fill(n),this.drawScene()},drawCanvas:function(e,t,n){this.YTexture.fill(e),this.UTexture.fill(t),this.VTexture.fill(n),this.drawScene()},updateVertexArray:function(e){this.zoomScene(e)},toString:function(){return"YUVCanvas Size: "+this.size},initCanvas:function(){this.gl.clear(this.gl.DEPTH_BUFFER_BIT|this.gl.COLOR_BUFFER_BIT)}}),n}());function p(e,t){for(var n=Object.create(e.prototype),i=Object.keys(t),r=0;r<i.length;r++)n[i[r]]=t[i[r]];return n}function m(e){return e.join("\n")}var g=function(e,t,n){var r,s=t,a=e,o=n,l=null,c=0,u=0,d=!1,h=null,p=0,m=0,g=!1,v=!1,y=1,w=Object(i.f)(),S=w.bSupportMultiThread;w.browserType,w.errorCode,r=S;var b=null,T=!1,C=null,_=null,P=!1,A=function(e){(function(e){this.buffer=e,this.previous=null,this.next=null}).call(this,e)};function R(){var e=s||25;function t(){this.first=null,this.size=0}return t.prototype={enqueue:function(t){this.size>=e&&this.clear();var n=new A(t);if(null===this.first)this.first=n;else{for(var i=this.first;null!==i.next;)i=i.next;i.next=n}return this.size+=1,n},dequeue:function(){var e=null;return null!==this.first&&(e=this.first,this.first=this.first.next,this.size-=1),e},clear:function(){for(var e=null;null!==this.first;)e=this.first,this.first=this.first.next,this.size-=1,e.buffer=null,e=null;this.size=0,this.first=null}},new t}function x(){h=new R,d=!1}var I=function(e){return"undefined"!==typeof l&&(l.drawCanvas(e.buffer.dataY,e.buffer.dataU,e.buffer.dataV),T&&(T=!1,M([C],b)),delete e.buffer,e.buffer=null,e.previous=null,e.next=null,e=null,!0)},E=function e(t){if(!0===d){if(0===c||t-c<200)return 0===c&&(c=t),void(null!==h&&(g||null!==(n=h.dequeue())&&null!==n.buffer&&null!==n.buffer.dataY&&(g=!0,I(n)),window.requestAnimationFrame(e)));if(o)return null!==(n=h.dequeue())&&null!==n.buffer&&null!==n.buffer.dataY&&I(n),void window.requestAnimationFrame(e);0===u&&(u=t);var n,i=t-u;i>m&&null!==(n=h.dequeue())&&null!==n.buffer&&null!==n.buffer.dataY&&(v&&(p=i-m),m=n.buffer.nCostTime,m-=p,I(n),u=t,v=!0),window.requestAnimationFrame(e)}};function D(e,t){function n(e,t){n.prototype.w=e,n.prototype.h=t}return n.prototype={toString:function(){return"("+n.prototype.w+", "+n.prototype.h+")"},getHalfSize:function(){return new D(n.prototype.w>>>1,n.prototype.h>>>1)},length:function(){return n.prototype.w*n.prototype.h}},new n(e,t)}function M(e,t){var n=C.width,i=C.height,r=document.createElement("canvas");r.width=n,r.height=i;for(var s=r.getContext("2d"),a=0;a<e.length;a++)s.drawImage(e[a],0,0,n,i);for(var o=r.toDataURL(),l=atob(o.substring("data:image/png;base64,".length)),c=new Uint8Array(l.length),u=0,d=l.length;u<d;++u)c[u]=l.charCodeAt(u);var h=new Blob([c.buffer],{type:"image/png"});c=null,_&&_(h),P||(U(h,t+".png"),h=null)}x.prototype={draw:function(e,t,n,i){if(!0===d){if(r)return l&&l.drawCanvas(e,t,n),void(T&&(T=!1,M([C],b)));if(null!==h)if(document.hidden&&h.size>=25)h.clear();else{var s={};s.dataY=e,s.dataU=t,s.dataV=n,0==i&&(i=25);var a=1e3/i,c=h.size*a;o||(y=c>500?1.2:c<200?.8:1),s.nCostTime=1e3/i/y,s.nCostTime<20&&(s.nCostTime=20),h.enqueue(s)}}},resize:function(e,t){this.stopRendering(),null!==h&&h.clear(),l&&(l=null);var n=new D(e,t);l=new f(a,n),n=null,this.startRendering()},initStartTime:function(){0===c&&this.startRendering()},startRendering:function(){0===c&&(d=!0,r||window.requestAnimationFrame(E))},pause:function(){d=!1},play:function(){d=!0},stopRendering:function(){d=!1,c=0},capture:function(e,t,n,i){b=e,T=!0,C=t,_=n,P=i},setPlaySpeed:function(e){y=e},terminate:function(){d=!1,c=0,null!==h&&(h.clear(),h=null),l&&l.clearCanvas(),l=null},getVideoBufferQueueSize:function(){return h.size}};var U=function(e){var t=e.document,n=function(){return e.URL||e.webkitURL||e},i=t.createElementNS("http://www.w3.org/1999/xhtml","a"),r="download"in i,s=/constructor/i.test(e.HTMLElement),a=/CriOS\/[\d]+/.test(navigator.userAgent),o=function(t){(e.setImmediate||e.setTimeout)((function(){throw t}),0)},l=function(e){setTimeout((function(){"string"===typeof e?n().revokeObjectURL(e):e.remove()}),4e4)},c=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},u=function(t,u,d){d||(t=c(t));var h,f=this,p="application/octet-stream"===t.type,m=function(){!function(e,t,n){for(var i=(t=[].concat(t)).length;i--;){var r=e["on"+t[i]];if("function"===typeof r)try{r.call(e,n||e)}catch(e){o(e)}}}(f,"writestart progress write writeend".split(" "))};if(f.readyState=f.INIT,r)return h=n().createObjectURL(t),void setTimeout((function(){i.href=h,i.download=u,function(e){var t=new MouseEvent("click");e.dispatchEvent(t)}(i),m(),l(h),f.readyState=f.DONE}));!function(){if((a||p&&s)&&e.FileReader){var i=new FileReader;return i.onloadend=function(){var t=a?i.result:i.result.replace(/^data:[^;]*;/,"data:attachment/file;");e.open(t,"_blank")||(e.location.href=t),t=void 0,f.readyState=f.DONE,m()},i.readAsDataURL(t),void(f.readyState=f.INIT)}h||(h=n().createObjectURL(t)),p?e.location.href=h:e.open(h,"_blank")||(e.location.href=h),f.readyState=f.DONE,m(),l(h)}()},d=u.prototype;return"undefined"!==typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return t=t||e.name||"download",n||(e=c(e)),navigator.msSaveOrOpenBlob(e,t)}:(d.readyState=d.INIT=0,d.WRITING=1,d.DONE=2,d.error=d.onwritestart=d.onprogress=d.onwrite=d.onabort=d.onerror=d.onwriteend=null,function(e,t,n){return new u(e,t||e.name||"download",n)})}(window);return new x},v=function(){var e=200,t=null,n=null,r=null,s=0,a=0,o=!1,l=0,c=0,u=null,d=!1,h=new Float32Array(8e4),f=0,p=null,m=0;function g(n,i){var s=i-l;if((s>e||s<0)&&(a=0,f=0,d=!0,null!==p&&p.stop()),a-t.currentTime<0&&(a=0),l=i,h=function(e,t,n){var i=e;return n+t.length>=i.length&&(i=new Float32Array(i.length+8e4)).set(i,0),i.set(t,n),i}(h,n,f),f+=n.length,!d){var o=0;if(f/n.length>1&&(null!==u&&(o=u*m),o>=f||null===u))return void(f=0);var c=null;(c=t.createBuffer(1,f-o,m)).getChannelData(0).set(h.subarray(o,f)),f=0,(p=t.createBufferSource()).buffer=c,p.connect(r),a||(a=t.currentTime+.1),p.start(a),a+=c.duration}}function v(){}return v.prototype={audioInit:function(e,s){if(a=0,null!==t)i.h.info("Audio context already defined!");else try{return window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext,(t=new AudioContext).onstatechange=function(){"running"===t.state&&(o=!0)},m=s,n=t.createGain(),(r=t.createBiquadFilter()).connect(n),r.type="lowpass",r.frequency.value=1500,r.gain.value=40,n.connect(t.destination),this.setVolume(e),!0}catch(e){return i.h.error("Web Audio API is not supported in this web browser! : "+e),!1}},play:function(){this.setVolume(s)},stop:function(){s=0,n.gain.value=0,a=0,t=null},bufferAudio:function(e,t){o&&g(e,0)},setVolume:function(e){s=e;var t=e/1;t<=0?(n.gain.value=0,a=0):n.gain.value=t>=1?1:t},getVolume:function(){return s},Mute:function(e){if(e)n.gain.value=0,a=0;else{var t=s/1;t<=0?(n.gain.value=0,a=0):n.gain.value=t>=1?1:t}},terminate:function(){"closed"!==t.state&&(a=0,o=!1,t.close())},setBufferingFlag:function(e,t){"init"===t?c=e:d&&(0===e||"undefined"===typeof e||null===e?u=null:(u=e-c,c=0),d=!1)},getBufferingFlag:function(){return d},setInitVideoTimeStamp:function(e){c=e},getInitVideoTimeStamp:function(){return c},setSamplingRate:function(e){m=e},resume:function(){t&&t.resume()}},new v},y=function(e){var t=[],n={},r=e;function s(){for(var e in t)t[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)];1==r?n.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]):2==r&&(n.FTYP=new Uint8Array([105,115,111,109,0,0,2,0,105,115,111,109,105,115,111,50,97,118,99,49,109,112,52,49])),n.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),n.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),n.STSC=n.STCO=n.STTS,n.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),n.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),n.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),n.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),n.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}t={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],hev1:[],hvcC:[]};var a=function(e){for(var t=8,n=Array.prototype.slice.call(arguments,1),i=0;i<n.length;i++)t+=n[i].byteLength;var r=new Uint8Array(t),s=0;for(r[s++]=t>>>24&255,r[s++]=t>>>16&255,r[s++]=t>>>8&255,r[s++]=255&t,r.set(e,s),s+=4,i=0;i<n.length;i++)r.set(n[i],s),s+=n[i].byteLength;return r},o=function(e){return a(t.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(65280&e.channelcount)>>8,255&e.channelcount,(65280&e.samplesize)>>8,255&e.samplesize,0,0,0,0,(65280&e.samplerate)>>8,255&e.samplerate,0,0]),function(e){var n=e.config,i=n.length,r=new Uint8Array([0,0,0,0,3,23+i,0,1,0,4,15+i,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([i]).concat(n).concat([6,1,2]));return a(t.esds,r)}(e))},l=function(e){return"audio"===e.type?a(t.stsd,n.STSD_PREFIX,o(e)):a(t.stsd,n.STSD_PREFIX,function(e){var n=e.vps||[],i=e.sps||[],s=e.pps||[],o=[],l=[],c=[],u=0;for(u=0;u<n.length;u++)o.push((65280&n[u].byteLength)>>>8),o.push(255&n[u].byteLength),o=o.concat(Array.prototype.slice.call(n[u]));for(u=0;u<i.length;u++)l.push((65280&i[u].byteLength)>>>8),l.push(255&i[u].byteLength),l=l.concat(Array.prototype.slice.call(i[u]));for(u=0;u<s.length;u++)c.push((65280&s[u].byteLength)>>>8),c.push(255&s[u].byteLength),c=c.concat(Array.prototype.slice.call(s[u]));return 1==r?a(t.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(65280&e.width)>>8,255&e.width,(65280&e.height)>>8,255&e.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a(t.avcC,new Uint8Array([1,e.profileIdc,e.profileCompatibility,e.levelIdc,255].concat([i.length]).concat(l).concat([s.length]).concat(c)))):2==r?a(t.hev1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(65280&e.width)>>8,255&e.width,(65280&e.height)>>8,255&e.height,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a(t.hvcC,new Uint8Array([1,e.general_profile_flag,(4278190080&e.general_profile_compatibility_flags)>>>24,(16711680&e.general_profile_compatibility_flags)>>>16,(65280&e.general_profile_compatibility_flags)>>>8,255&e.general_profile_compatibility_flags,(0xff0000000000&e.general_constraint_indicator_flags)>>>40,(0xff00000000&e.general_constraint_indicator_flags)>>>32,(4278190080&e.general_constraint_indicator_flags)>>>24,(16711680&e.general_constraint_indicator_flags)>>>16,(65280&e.general_constraint_indicator_flags)>>>8,255&e.general_constraint_indicator_flags,e.general_level_idc,240,0,252,252|e.chroma_format_idc,248|e.bitDepthLumaMinus8,248|e.bitDepthChromaMinus8,0,0,e.rate_layers_nested_length,3].concat([32,0,1]).concat(o).concat([33,0,1]).concat(l).concat([34,0,1]).concat(c)))):void 0}(e))},c=function(e){var i=null;return i="audio"===e.type?a(t.smhd,n.SMHD):a(t.vmhd,n.VMHD),a(t.minf,i,a(t.dinf,a(t.dref,n.DREF)),function(e){return a(t.stbl,l(e),a(t.stts,n.STTS),a(t.stsc,n.STSC),a(t.stsz,n.STSZ),a(t.stco,n.STCO))}(e))},u=function(e){return a(t.mdia,function(e){var n=e.timescale,i=e.duration;return a(t.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n,i>>>24&255,i>>>16&255,i>>>8&255,255&i,85,196,0,0]))}(e),function(e){var i=null;return i="audio"===e.type?n.HDLR_AUDIO:n.HDLR_VIDEO,a(t.hdlr,i)}(e),c(e))},d=function(e){return a(t.trak,function(e){var n=e.id,i=e.duration,r=e.width,s=e.height;return a(t.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>>8&255,255&r,0,0,s>>>8&255,255&s,0,0]))}(e),u(e))},h=function(e){return a(t.mvex,function(e){var n=e.id,i=new Uint8Array([0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return a(t.trex,i)}(e))},f=function(e){var n,r,s=(n=e.timescale,r=e.duration,i.h.log("mvhd:  timescale: "+n+"  duration: "+r),a(t.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,n>>>24&255,n>>>16&255,n>>>8&255,255&n,r>>>24&255,r>>>16&255,r>>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))),o=d(e),l=h(e);return a(t.moov,s,o,l)},p=function(e,n){return"audio"===e.type?audioTrun(e,n):function(e,n){var i,r=null,s=null,o=0,l=n;if(null===(i=e.samples||[])[0].frameDuration)for(l+=24+4*i.length,r=trunHeader(i,l),o=0;o<i.length;o++)s=i[o],r=r.concat([(4278190080&s.size)>>>24,(16711680&s.size)>>>16,(65280&s.size)>>>8,255&s.size]);else for(r=function(e,t){return[0,0,3,5,(4278190080&e.length)>>>24,(16711680&e.length)>>>16,(65280&e.length)>>>8,255&e.length,(4278190080&t)>>>24,(16711680&t)>>>16,(65280&t)>>>8,255&t,0,0,0,0]}(i,l+=24+4*i.length+4*i.length),o=0;o<i.length;o++)s=i[o],r=r.concat([(4278190080&s.frameDuration)>>>24,(16711680&s.frameDuration)>>>16,(65280&s.frameDuration)>>>8,255&s.frameDuration,(4278190080&s.size)>>>24,(16711680&s.size)>>>16,(65280&s.size)>>>8,255&s.size]);return a(t.trun,new Uint8Array(r))}(e,n)},m=function(e,n){return a(t.moof,function(e){var n=new Uint8Array([0,0,0,0,e>>>24&255,e>>>16&255,e>>>8&255,255&e]);return a(t.mfhd,n)}(e),function(e){var n,i,r;return n=a(t.tfhd,new Uint8Array([0,2,0,0,0,0,0,1])),i=a(t.tfdt,new Uint8Array([0,0,0,0,e.baseMediaDecodeTime>>>24&255,e.baseMediaDecodeTime>>>16&255,e.baseMediaDecodeTime>>>8&255,255&e.baseMediaDecodeTime])),r=p(e,72),a(t.traf,n,i,r)}(n))};return s.prototype={initSegment:function(e){var r=a(t.ftyp,n.FTYP);i.h.log(e);var s=f(e),o=new Uint8Array(r.byteLength+s.byteLength);return o.set(r,0),o.set(s,r.byteLength),o},mediaSegment:function(e,n,i,r){var s=m(e,n),o=function(e){return a(t.mdat,e)}(i),l=null;return(l=new Uint8Array(s.byteLength+o.byteLength)).set(s),l.set(o,s.byteLength),l}},new s};function w(e){var t=7,n=7,i=2,r=3,s=4,a=5,o=8,l=16,c=32,u=255,d=0,h=null,f=e;function p(){d=0,h=new S}function m(e,i){var s=i,a=d+s>>r;return s=d+i&t,e[a]>>n-(s&n)&1}function g(e,t){var n=d>>r,i=8*(n+1)-d;if(i<8)for(var s=0;s<3;s++){var a=e[n+s];a=0==s?a>>i<<i:2==s?a&255>>8-i|1<<i:0,e.set([a],n+s)}else e.set([0],n),e.set([1],n+1)}function v(e,t){return t<=25?y(e,t):y(e,16)<<t-16|y(e,t-16)}function y(e,t){var n=0;if(1===t)n=m(e,0);else for(var i=0;i<t;i++)n=(n<<1)+m(e,i);return d+=t,n}function w(e,t){for(var n=0,r=0,s=t;d+s<8*e.length&&!m(e,s++);)n++;if(0===n)return d+=1,0;r=1<<n;for(var a=n-1;a>=0;a--,s++)r|=m(e,s)<<a;return d+=n*i+1,r-1}function b(e,t){var n=w(e,t);return 1&n?(n+1)/i:-n/i}function T(e){h.put("cpb_cnt_minus1",w(e,0)),h.put("bit_rate_scale",y(e,s)),h.put("cpb_size_scale",y(e,s));for(var t=h.get("cpb_cnt_minus1"),n=new Array(t),i=new Array(t),r=new Array(t),o=0;o<=t;o++)n[o]=w(e,0),i[o]=w(e,0),r[o]=y(e,1);h.put("bit_rate_value_minus1",n),h.put("cpb_size_value_minus1",i),h.put("cbr_flag",r),h.put("initial_cpb_removal_delay_length_minus1",y(e,a)),h.put("cpb_removal_delay_length_minus1",y(e,a)),h.put("dpb_output_delay_length_minus1",y(e,a)),h.put("time_offset_length",y(e,a))}return p.prototype={parse:function(e){if(d=0,h.clear(),1==f){h.put("forbidden_zero_bit",y(e,1)),h.put("nal_ref_idc",y(e,i)),h.put("nal_unit_type",y(e,a)),h.put("profile_idc",y(e,o)),h.put("profile_compatibility",y(e,o)),h.put("level_idc",y(e,o)),h.put("seq_parameter_set_id",w(e,0));var t=h.get("profile_idc");if((100===t||110===t||122===t||244===t||44===t||83===t||86===t||118===t||128===t||138===t||139===t||134===t)&&(h.put("chroma_format_idc",w(e,0)),h.get("chroma_format_idc")===r&&h.put("separate_colour_plane_flag",y(e,1)),h.put("bit_depth_luma_minus8",w(e,0)),h.put("bit_depth_chroma_minus8",w(e,0)),h.put("qpprime_y_zero_transform_bypass_flag",y(e,1)),h.put("seq_scaling_matrix_present_flag",y(e,1)),h.get("seq_scaling_matrix_present_flag"))){for(var n=h.get("chroma_format_idc")!==r?o:12,s=new Array(n),p=0;p<n;p++)if(s[p]=y(e,1),s[p])for(var m=p<6?l:64,S=8,C=8,_=0;_<m;_++)C&&(C=(S+b(e,0)+256)%256),S=0===C?S:C;h.put("seq_scaling_list_present_flag",s)}if(h.put("log2_max_frame_num_minus4",w(e,0)),h.put("pic_order_cnt_type",w(e,0)),0===h.get("pic_order_cnt_type"))h.put("log2_max_pic_order_cnt_lsb_minus4",w(e,0));else if(1===h.get("pic_order_cnt_type")){h.put("delta_pic_order_always_zero_flag",y(e,1)),h.put("offset_for_non_ref_pic",b(e,0)),h.put("offset_for_top_to_bottom_field",b(e,0)),h.put("num_ref_frames_in_pic_order_cnt_cycle",w(e,0));for(var P=0;P<h.get("num_ref_frames_in_pic_order_cnt_cycle");P++)h.put("num_ref_frames_in_pic_order_cnt_cycle",b(e,0))}h.put("num_ref_frames",w(e,0)),h.put("gaps_in_frame_num_value_allowed_flag",y(e,1)),h.put("pic_width_in_mbs_minus1",w(e,0)),h.put("pic_height_in_map_units_minus1",w(e,0)),h.put("frame_mbs_only_flag",y(e,1)),0===h.get("frame_mbs_only_flag")&&h.put("mb_adaptive_frame_field_flag",y(e,1)),h.put("direct_8x8_interence_flag",y(e,1)),h.put("frame_cropping_flag",y(e,1)),1===h.get("frame_cropping_flag")&&(h.put("frame_cropping_rect_left_offset",w(e,0)),h.put("frame_cropping_rect_right_offset",w(e,0)),h.put("frame_cropping_rect_top_offset",w(e,0)),h.put("frame_cropping_rect_bottom_offset",w(e,0))),h.put("vui_parameters_present_flag",y(e,1)),h.get("vui_parameters_present_flag")&&function(e){h.put("aspect_ratio_info_present_flag",y(e,1)),h.get("aspect_ratio_info_present_flag")&&(h.put("aspect_ratio_idc",y(e,o)),h.get("aspect_ratio_idc")===u&&(g(e),h.put("sar_width",y(e,l)),g(e),h.put("sar_height",y(e,l)))),h.put("overscan_info_present_flag",y(e,1)),h.get("overscan_info_present_flag")&&h.put("overscan_appropriate_flag",y(e,1)),h.put("video_signal_type_present_flag",y(e,1)),h.get("video_signal_type_present_flag")&&(h.put("video_format",y(e,r)),h.put("video_full_range_flag",y(e,1)),h.put("colour_description_present_flag",y(e,1)),h.get("colour_description_present_flag")&&(h.put("colour_primaries",y(e,o)),h.put("transfer_characteristics",y(e,o)),h.put("matrix_coefficients",y(e,o)))),h.put("chroma_loc_info_present_flag",y(e,1)),h.get("chroma_loc_info_present_flag")&&(h.put("chroma_sample_loc_type_top_field",w(e,0)),h.put("chroma_sample_loc_type_bottom_field",w(e,0))),h.put("timing_info_present_flag",y(e,1)),h.get("timing_info_present_flag")&&(h.put("num_units_in_tick",y(e,c)),h.put("time_scale",y(e,c)),h.put("fixed_frame_rate_flag",y(e,1))),h.put("nal_hrd_parameters_present_flag",y(e,1)),h.get("nal_hrd_parameters_present_flag")&&T(e),h.put("vcl_hrd_parameters_present_flag",y(e,1)),h.get("vcl_hrd_parameters_present_flag")&&T(e),(h.get("nal_hrd_parameters_present_flag")||h.get("vcl_hrd_parameters_present_flag"))&&h.put("low_delay_hrd_flag",y(e,1)),h.put("pic_struct_present_flag",y(e,1)),h.put("bitstream_restriction_flag",y(e,1)),h.get("bitstream_restriction_flag")&&(h.put("motion_vectors_over_pic_boundaries_flag",y(e,1)),h.put("max_bytes_per_pic_denom",w(e,0)),h.put("max_bits_per_mb_denom",w(e,0)))}(e)}else if(2==f){var A=new ArrayBuffer(256),R=new Uint8Array(A);!function(e,t,n,i){for(var r=0,s=0;r+2<t&&s+2<i;++r)0==e[r]&&0==e[r+1]&&3==e[r+2]?(n[s++]=e[r++],n[s++]=e[r++]):n[s++]=e[r];for(;r<t&&s<i;)n[s++]=e[r++]}(e,e.length,R,256);var x=[],I=[];y(R,4);var E=y(R,3);for(h.put("temporalIdNested",y(R,1)),h.put("general_profile_space",y(R,2)),h.put("general_tier_flag",y(R,1)),h.put("general_profile_idc",y(R,5)),h.put("general_profile_compatibility_flags",v(R,32)),h.put("general_constraint_indicator_flags",(D=R,(M=48)<=32?v(D,M):v(D,M-32)<<32|v(D,32))),h.put("general_level_idc",y(R,8)),p=0;p<E&&p<MAX_SUB_LAYERS;p++)x[p]=y(R,1),I[p]=y(R,1);if(E>0)for(p=E;p<8;p++)y(R,2);for(p=0;p<E&&p<MAX_SUB_LAYERS;p++)I[p]&&y(R,8);w(R,0),h.put("chroma_format_idc",w(R,0)),w(R,0),w(R,0),y(R,1),w(R,0),w(R,0),w(R,0),w(R,0),h.put("bitDepthLumaMinus8",w(R,0)+8),h.put("bitDepthChromaMinus8",w(R,0)+8),A=null,R=null}var D,M;return!0},getSizeInfo:function(){var e=0,t=0;0===h.get("chroma_format_idc")?e=t=0:1===h.get("chroma_format_idc")?e=t=i:h.get("chroma_format_idc")===i?(e=i,t=1):h.get("chroma_format_idc")===r&&(0===h.get("separate_colour_plane_flag")?e=t=1:1===h.get("separate_colour_plane_flag")&&(e=t=0));var n=h.get("pic_width_in_mbs_minus1")+1,s=h.get("pic_height_in_map_units_minus1")+1,a=(i-h.get("frame_mbs_only_flag"))*s,o=0,c=0,u=0,d=0;1===h.get("frame_cropping_flag")&&(o=h.get("frame_cropping_rect_left_offset"),c=h.get("frame_cropping_rect_right_offset"),u=h.get("frame_cropping_rect_top_offset"),d=h.get("frame_cropping_rect_bottom_offset"));var f=n*l*(a*l);return{width:n*l-e*(o+c),height:a*l-t*(i-h.get("frame_mbs_only_flag"))*(u+d),decodeSize:f}},getSpsValue:function(e){return h.get(e)},getCodecInfo:function(){return h.get("profile_idc").toString(l)+(h.get("profile_compatibility")<15?"0"+h.get("profile_compatibility").toString(l):h.get("profile_compatibility").toString(l))+h.get("level_idc").toString(l)}},new p}var S=function(){this.map={}};S.prototype={put:function(e,t){this.map[e]=t},get:function(e){return this.map[e]},containsKey:function(e){return e in this.map},containsValue:function(e){for(var t in this.map)if(this.map[t]===e)return!0;return!1},isEmpty:function(e){return 0===this.size()},clear:function(){for(var e in this.map)delete this.map[e]},remove:function(e){delete this.map[e]},keys:function(){var e=[];for(var t in this.map)e.push(t);return e},values:function(){var e=[];for(var t in this.map)e.push(this.map[t]);return e},size:function(){var e=0;for(var t in this.map)e++;return e}};var b=function(){var e=null,t="",n=null,r=null,s=null,a=null,o=null,l=null,c=null,u=1,d={timestamp:0,timestamp_usec:0,timezone:0},h={timestamp:0,timestamp_usec:0,timezone:0},f=null,p=!1,m=null,g=null,v=null,y=!1,w=!0,S=0,b=!1,T=[],C=.5,_=null,P=null,A=null,R=0,x=0,I=!1,E=null,D="png",M=1,U=Object(i.a)(),k=null,L=0,N=0,O=0,F=8,B=null,V=!1,$=!1,W=[],z={},q=25,G=.5,Y=!1,H=!1;function j(){}function Z(){K(),H=!0}function X(){var e=0;if(null!==m)for(e=0;e<m.length;e++)A.removeEventListener(m[e].type,m[e].function);if(null!==v)for(e=0;e<v.length;e++)P.removeEventListener(v[e].type,v[e].function);if(null!==g)for(e=0;e<g.length;e++)_.removeEventListener(g[e].type,g[e].function)}function K(){if(null===P||"ended"===P.readyState)return function(e){(v=[]).push({type:"sourceopen",function:Z}),v.push({type:"error",function:re});for(var t=0;t<v.length;t++)e.addEventListener(v[t].type,v[t].function)}(P=new MediaSource),_.src=window.URL.createObjectURL(P),void i.h.log("videoMediaSource::appendInitSegment new MediaSource()");if(i.h.log("videoMediaSource::appendInitSegment start"),0===P.sourceBuffers.length){P.duration=0;var r=null;if(1==n?r='video/mp4;codecs="avc1.'+t+'"':2==n&&(r='video/mp4; codecs="hvc1.1.6.L30.B0"'),null==r)return;if(!MediaSource.isTypeSupported(r))return i.h.log("not support"+r),void(l&&l("InitError"));!function(e){(m=[]).push({type:"error",function:se}),m.push({type:"updateend",function:ne}),m.push({type:"update",function:ie});for(var t=0;t<m.length;t++)e.addEventListener(m[t].type,m[t].function)}(A=P.addSourceBuffer(r))}var s=e();null!==s?(A.appendBuffer(s),i.h.log("videoMediaSource::appendInitSegment end, codecInfo = "+t)):P.endOfStream("network")}function J(){_.paused&&(s(),y||V||_.play())}function Q(){_.paused||w||(i.h.log("pause"),_.pause())}function ee(){W.length&&function(e){if(!Y&&H&&(Y=!0,K()),null!==A&&"closed"!==P.readyState&&"ended"!==P.readyState)try{if(T.length>0)return i.h.count("1.segmentWaitDecode.length: "+T.length),T.push(e),void i.h.count("2.segmentWaitDecode.length: "+T.length);A.updating?(i.h.log("updating.........."),T.push(e)):(A.appendBuffer(e),V&&(z.buffer=e))}catch(e){i.h.log("videoMediaSource::appendNextMediaSegment error >> initVideo"),T.length=0,B&&B({errorCode:101,description:"videoMediaSource::appendNextMediaSegment error"})}}(W.shift())}function te(){if(null!==P)try{if(A&&A.buffered.length>0&&(function(){var e=1*A.buffered.start(A.buffered.length-1),t=1*A.buffered.end(A.buffered.length-1);t-e>60&&A.remove(e,t-10)}(),$&&!V||_.duration>G&&(_.currentTime=(_.duration-G).toFixed(3),G+=q<10?.5:.1),_&&_.duration-_.currentTime>F&&B&&B({errorCode:101,description:"Video has been generated, but no video appears"}),b&&!p)){var e=1*A.buffered.start(A.buffered.length-1),t=1*A.buffered.end(A.buffered.length-1);if((0===_.currentTime?t-e:t-_.currentTime)>=C+.1){if(i.h.log("跳秒"),A.updating)return;var n=t-.1;_.currentTime=n.toFixed(3)}}}catch(e){i.h.log("sourceBuffer has been removed")}}function ne(){}function ie(){T.length>0&&(i.h.count("1. onSourceUpdate .segmentWaitDecode.length: "+T.length),A.updating||(i.h.count("2. onSourceUpdate .appendBuffer: "+T.length+"  "+T[0].length),A.appendBuffer(T[0]),T.shift()))}function re(){console.log("videoMediaSource::onSourceError"),l&&l("SourceError")}function se(){console.log("videoMediaSource::onSourceBufferErrormsg"),l&&l("SourceBufferError")}function ae(){console.log("videoMediaSource::onError"),Q(),B&&B({errorCode:101,description:"videoMediaSource Error"}),l&&l("Error")}function oe(){y=!0,w=!1,$=!0,I||(I=!0,o("PlayStart"))}function le(){y=!1,w=!0,i.h.log("暂停播放----------------------------------------------")}function ce(){var e=parseInt(P.duration,10),t=parseInt(_.currentTime,10),n={timestamp:d.timestamp-u*(e-t+(1!==u?1:0)),timestamp_usec:0,timezone:d.timezone};0===t||isNaN(e)||!p&&Math.abs(e-t)>4&&1===u||_.paused||(null===f?(f=n,a(0,"currentTime")):(f.timestamp<=n.timestamp&&u>=1||f.timestamp>n.timestamp&&u<1)&&(f=n,++S>4&&a(n.timestamp,"currentTime")))}function ue(){null!=A&&(J(),te())}function de(){s()}function he(){J()}function fe(){if(i.h.log("需要缓冲下一帧"),b=!1,0==x)R=Date.now(),x++;else{x++;var e=Date.now()-R;i.h.log("diffTime: "+e+"  Count: "+x),x>=5&&e<6e4&&C<=1&&(C+=.1,x=0,R=0,i.h.log("delay + 0.1 = "+C))}}function pe(){i.h.log("Can play !")}function me(){i.h.log("Can play without waiting"),b=!0}function ge(){i.h.log("loadedmetadata")}function ve(e,t,n,i,r){for(var s=e.width,a=e.height,o=e.getContext("2d"),l=0;l<t.length;l++)o.drawImage(t[l],0,0,s,a);for(var c=e.toDataURL(),u=atob(c.substring("data:image/png;base64,".length)),d=new Uint8Array(u.length),h=0,f=u.length;h<f;++h)d[h]=u.charCodeAt(h);var p=new Blob([d.buffer],{type:"image/png"});i&&i(p),r||ye(p,n+".png")}j.prototype={init:function(e){c=Object(i.a)(),i.h.log("videoMediaSource::init browserType = "+c),(_=e).autoplay="safari"!==c,_.controls=!1,_.preload="auto",function(e){(g=[]).push({type:"durationchange",function:ue}),g.push({type:"playing",function:oe}),g.push({type:"error",function:ae}),g.push({type:"pause",function:le}),g.push({type:"timeupdate",function:ce}),g.push({type:"resize",function:de}),g.push({type:"seeked",function:he}),g.push({type:"waiting",function:fe}),g.push({type:"canplaythrough",function:me}),g.push({type:"canplay",function:pe}),g.push({type:"loadedmetadata",function:ge});for(var t=0;t<g.length;t++)e.addEventListener(g[t].type,g[t].function)}(_),K()},setInitSegmentFunc:function(t){e=t},getVideoElement:function(){return _},setCodecInfo:function(e){t=e},setMediaSegment:function(e){W.push(e),V||ee()},capture:function(e,t,n,i){E&&clearInterval(E);var r=document.createElement("canvas");r.width=_.videoWidth,r.height=_.videoHeight;var s=t.ivsCanvasArr;b||"edge"===U?(r.getContext("2d").drawImage(_,0,0,r.width,r.height),ve(r,s,e,n,i)):E=setInterval((function(){b&&(r.getContext("2d").drawImage(_,0,0,r.width,r.height),ve(r,s,e,n,i),clearInterval(E))}),200)},getCapture:function(e,t,n){E&&clearInterval(E),M=n||1,D="png","jpg"!==t&&"jpeg"!==t||(D="jpeg");var i=document.createElement("canvas"),r=null;return i.width=_.videoWidth,i.height=_.videoHeight,(b||"edge"===U)&&(i.getContext("2d").drawImage(_,0,0,i.width,i.height),r=i.toDataURL("image/"+D,M)),r},setInitSegment:function(){K()},setTimeStamp:function(e){r=e},setVideoSizeCallback:function(e){s=e},setAudioStartCallback:function(e){a=e},setMseErrorCallback:function(e){l=e},getPlaybackTimeStamp:function(){return r},setSpeedPlay:function(e){u=e},setvideoTimeStamp:function(e){var t=Math.abs(d.timestamp-e.timestamp)>3;h.timestamp,!0===t&&(S=0,a((h=e).timestamp,"init"),0!==d.timestamp&&p&&(_.currentTime=P.duration-.1),f=null),d=e},pause:function(){V=!0,Q()},play:function(){V=!1},setPlaybackFlag:function(e){p=e},setTimeStampInit:function(){f=null,h={timestamp:0,timestamp_usec:0,timezone:0}},close:function(){X(),Q()},setBeginDrawCallback:function(e){o=e},setErrorCallback:function(e){B=e},terminate:function(){null!==_&&(X(),"open"===P.readyState&&(A&&P.removeSourceBuffer(A),P.endOfStream()),A=null,P=null,_=null,E&&(clearInterval(E),E=null),k&&(clearInterval(k),k=null),O=0,N=0,L=0,Y=!1,H=!1)},getDuration:function(){return _.duration-_.currentTime},setFPS:function(e){e&&(q=e)},setRtspOver:function(){_.duration.toFixed(4)-0===_.currentTime.toFixed(4)-0||(L=parseInt(_.currentTime),N=parseInt(_.duration),k=setInterval((function(){L===parseInt(_.currentTime)&&N===parseInt(_.duration)?O++>10&&(k&&clearInterval(k),k=null):parseInt(_.currentTime)>=parseInt(_.duration)?(k&&clearInterval(k),k=null):(L=parseInt(_.currentTime),N=parseInt(_.duration),O=0)}),150))},getVideoBufferQueueSize:function(){return W.length},playNextFrame:function(){ee()},getCurFrameInfo:function(){return z.src=function(){var e=document.createElement("canvas");return e.width=_.videoWidth,e.height=_.videoHeight,e.getContext("2d").drawImage(_,0,0,e.width,e.height),e.toDataURL()}(),z},setDecodeType:function(e){n=e}};var ye=function(e){var t=e.document,n=function(){return e.URL||e.webkitURL||e},i=t.createElementNS("http://www.w3.org/1999/xhtml","a"),r="download"in i,s=/constructor/i.test(e.HTMLElement),a=/CriOS\/[\d]+/.test(navigator.userAgent),o=function(t){(e.setImmediate||e.setTimeout)((function(){throw t}),0)},l=function(e){setTimeout((function(){"string"===typeof e?n().revokeObjectURL(e):e.remove()}),4e4)},c=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},u=function(t,u,d){d||(t=c(t));var h,f=this,p="application/octet-stream"===t.type,m=function(){!function(e,t,n){for(var i=(t=[].concat(t)).length;i--;){var r=e["on"+t[i]];if("function"===typeof r)try{r.call(e,n||e)}catch(e){o(e)}}}(f,"writestart progress write writeend".split(" "))};if(f.readyState=f.INIT,r)return h=n().createObjectURL(t),void setTimeout((function(){i.href=h,i.download=u,function(e){var t=new MouseEvent("click");e.dispatchEvent(t)}(i),m(),l(h),f.readyState=f.DONE}));!function(){if((a||p&&s)&&e.FileReader){var i=new FileReader;return i.onloadend=function(){var t=a?i.result:i.result.replace(/^data:[^;]*;/,"data:attachment/file;");e.open(t,"_blank")||(e.location.href=t),t=void 0,f.readyState=f.DONE,m()},i.readAsDataURL(t),void(f.readyState=f.INIT)}h||(h=n().createObjectURL(t)),p?e.location.href=h:e.open(h,"_blank")||(e.location.href=h),f.readyState=f.DONE,m(),l(h)}()},d=u.prototype;return"undefined"!==typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return t=t||e.name||"download",n||(e=c(e)),navigator.msSaveOrOpenBlob(e,t)}:(d.readyState=d.INIT=0,d.WRITING=1,d.DONE=2,d.error=d.onwritestart=d.onprogress=d.onwrite=d.onabort=d.onerror=d.onwriteend=null,function(e,t,n){return new u(e,t||e.name||"download",n)})}(window);return new j},T=function(){var e=null,t=null,n=null,r=null,s=!1,a=null,o={audio:!0,video:!1},l=null;function c(){}return c.prototype={init:function(){if(void 0===e||null===e)try{window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext,(e=new AudioContext).onstatechange=function(){i.h.info("Audio Context State changed :: "+e.state)}}catch(e){return void i.h.error("Web Audio API is not supported in this web browser! : "+e)}},initAudioOut:function(){if(null!==t&&null!==n||(t=e.createGain(),(n=e.createScriptProcessor(4096,1,1)).onaudioprocess=function(e){if(null!==a){var t=e.inputBuffer.getChannelData(0);null!==l&&!0===s&&l(t)}},t.connect(n),n.connect(e.destination),r=e.sampleRate,t.gain.value=1),void 0===navigator.mediaDevices&&(navigator.mediaDevices={}),void 0===navigator.mediaDevices.getUserMedia&&(navigator.mediaDevices.getUserMedia=function(e,t,n){var i=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return i?new Promise((function(t,n){i.call(navigator,e,t,n)})):(n(),Promise.reject(new Error("getUserMedia is not implemented in this browser")))}),navigator.mediaDevices.getUserMedia)return navigator.mediaDevices.getUserMedia(o).then((function(n){a=n,e.createMediaStreamSource(n).connect(t)})).catch((function(e){i.h.error(e)})),s=!0,r;i.h.error("Cannot open local media stream! :: navigator.mediaDevices.getUserMedia is not defined!")},controlVolumnOut:function(e){var n=e/20*2;t.gain.value=n<=0?0:n>=10?10:n},stopAudioOut:function(){if(null!==a&&s)try{for(var e=a.getAudioTracks(),t=0,n=e.length;t<n;t++)e[t].stop();s=!1,a=null}catch(e){i.h.log(e)}},terminate:function(){this.stopAudioOut(),e.close(),t=null,n=null},setSendAudioTalkBufferCallback:function(e){l=e}},new c},C=n(1),_=n.n(C),P=function(e,t){var n=null,r=null,s=null;function a(){}function o(e){var t={type:"getRtpData",data:e};n.postMessage(t)}function l(e){var t=e.data;switch(t.type){case"rtpData":s(t.data)}}return a.prototype={setSendAudioTalkCallback:function(e){s=e},talkInit:function(e,t){var s={type:"sdpInfo",data:{sdpInfo:e,aacCodecInfo:t,decodeMode:"canvas",mp4Codec:arguments.length>2&&void 0!==arguments[2]?arguments[2]:null}};try{window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext,(n=new _.a).onmessage=l,null===r&&((r=new T).init(),r.setSendAudioTalkBufferCallback(o)),n.postMessage(s),s={type:"sampleRate",data:r.initAudioOut()},n.postMessage(s)}catch(e){return void i.h.error("Web Audio API is not supported in this web browser! : "+e)}},stop:function(){r&&(r.terminate(),r=null),n&&(n.terminate(),n=null)}},new a},A=function(){var e=null,t=null,n=-100,i="#0000FF";function r(){}function s(e,t,n){return(t.x-e.x)*(n.y-e.y)-(n.x-e.x)*(t.y-e.y)}function a(e,t){for(var n=0,i=0;i<e.length-1;i++)e[i].y<=t.y?e[i+1].y>t.y&&s(e[i],e[i+1],t)>0&&++n:e[i+1].y<=t.y&&s(e[i],e[i+1],t)<0&&--n;return 0!=n}return r.prototype={Init:function(n){t=(e=n).getContext("2d")},SetCurrentColor:function(e){i=e},drawLine:function(e,n){e.x==n.x&&e.y==n.y||(t.beginPath(),t.lineWidth=4,t.strokeStyle=i,t.moveTo(e.x,e.y),t.lineTo(n.x,n.y),t.stroke(),t.setLineDash([]),t.closePath())},drawPolyLine:function(e,n){if(!(n<2)){t.beginPath(),t.lineWidth=4,t.strokeStyle=i;for(var r=0;r<n;r++)0===r?t.moveTo(e[r].x,e[r].y):t.lineTo(e[r].x,e[r].y);t.stroke(),t.setLineDash([0,0]),t.closePath()}},drawArrow:function(e,t){var n,i={},r={};e.x==t.x&&e.y==t.y||(t.x<e.x?(n=Math.atan((e.y-t.y)/(e.x-t.x)),i.x=t.x+20*Math.cos(n-Math.PI/6),i.y=t.y+20*Math.sin(n-Math.PI/6),r.x=t.x+20*Math.cos(n+Math.PI/6),r.y=t.y+20*Math.sin(n+Math.PI/6)):t.x>e.x?(n=Math.atan((e.y-t.y)/(e.x-t.x)),i.x=t.x-20*Math.cos(n-Math.PI/6),i.y=t.y-20*Math.sin(n-Math.PI/6),r.x=t.x-20*Math.cos(n+Math.PI/6),r.y=t.y-20*Math.sin(n+Math.PI/6)):(n=Math.atan((e.y-t.y)/(e.x-t.x)),i.x=t.x+20*Math.cos(n-Math.PI/6),i.y=t.y+20*Math.sin(n-Math.PI/6),r.x=t.x+20*Math.cos(n+Math.PI/6),r.y=t.y+20*Math.sin(n+Math.PI/6)),this.drawLine(t,i),this.drawLine(t,r))},drawTrackLine:function(e,t){if(1===t||3===t){var n=e.x,i=e.y,r=e.xSize,s=e.ySize,a=new Array(4),o=new Array(8);a[0].x=n-r,a[0].y=i-s,a[1].x=n+r,a[1].y=i-s,a[2].x=n+r,a[2].y=i+s,a[3].x=n-r,a[3].y=i+s,o[0].x=a[0].x+r/2,o[0].y=a[0].y,o[1].x=a[1].x-r/2,o[1].y=a[1].y,o[2].x=a[2].x-r/2,o[2].y=a[2].y,o[3].x=a[3].x+r/2,o[3].y=a[3].y,o[4].x=a[0].x,o[4].y=a[0].y+s/2,o[5].x=a[1].x,o[5].y=a[1].y+s/2,o[6].x=a[2].x,o[6].y=a[2].y-s/2,o[7].x=a[3].x,o[7].y=a[3].y-s/2;for(var l=0;l<4;l++)this.drawLine(a[l],o[l]),this.drawLine(a[l],o[l+4]);a=null,o=null}else{var c=new Array(5);for(l=0;l<5;l++)c[l]={};c[0].x=e.x-e.xSize,c[0].y=e.y-e.ySize,c[1].x=e.x+e.xSize,c[1].y=e.y-e.ySize,c[2].x=e.x+e.xSize,c[2].y=e.y+e.ySize,c[3].x=e.x-e.xSize,c[3].y=e.y+e.ySize,c[4].x=e.x-e.xSize,c[4].y=e.y-e.ySize,this.drawPolyLine(c,5),c=null}if(3===t){n=e.x,i=e.y;var u=0;u=(r=e.xSize)>(s=e.ySize)?s:r,(c=new Array(8))[0].x=n-r,c[0].y=i,c[1].x=n-r-u,c[1].y=i,c[2].x=n,c[2].y=i+s,c[3].x=n,c[3].y=i+s+u,c[4].x=n+r,c[4].y=i,c[5].x=n+r+u,c[5].y=i,c[6].x=n,c[6].y=i-s,c[7].x=n,c[7].y=i-s-u,this.drawPolyLine(c,2),this.drawPolyLine(c+2,2),this.drawPolyLine(c+4,2),this.drawPolyLine(c+6,2),c=null}},drawDirection:function(e,t,n,i){var r,s={},a={},o=(e.x+t.x)/2,l=(e.y+t.y)/2;if(e.x!=t.x)if((r=(e.y-t.y)/(e.x-t.x))>0){var c=Math.atan(r);s.x=o+i*Math.sin(c),s.y=l-i*Math.cos(c),a.x=o-i*Math.sin(c),a.y=l+i*Math.cos(c)}else r<0?(c=Math.atan(-r),s.x=o-i*Math.sin(c),s.y=l-i*Math.cos(c),a.x=o+i*Math.sin(c),a.y=l+i*Math.cos(c)):(s.x=o,a.x=s.x,s.y=l-i,a.y=s.y+2*i);else s.x=e.x-i,a.x=e.x+i,s.y=l,a.y=s.y;this.drawLine(s,a),e.x==t.x?t.y<e.y?(1!=n&&this.drawArrow(s,a),0!=n&&this.drawArrow(a,s)):(1!=n&&this.drawArrow(a,s),0!=n&&this.drawArrow(s,a)):e.x<t.x?(1!=n&&this.drawArrow(s,a),0!=n&&this.drawArrow(a,s)):(1!=n&&this.drawArrow(a,s),0!=n&&this.drawArrow(s,a))},drawRegionDirection:function(e,t,n,i){var r={},s={},o=0,l={},c={};if(null!==e&&0!==t){if(r.x=e[0].x,r.y=e[0].y,s.x=e[1].x,s.y=e[1].y,r.x!=s.x?(o=(r.y-s.y)/(r.x-s.x))>0?(l.x=(r.x+s.x)/2+i*Math.sin(Math.atan(o)),l.y=(r.y+s.y)/2-i*Math.cos(Math.atan(o)),c.x=(r.x+s.x)/2-i*Math.sin(Math.atan(o)),c.y=(r.y+s.y)/2+i*Math.cos(Math.atan(o))):o<0?(l.x=(r.x+s.x)/2-i*Math.sin(Math.atan(-o)),l.y=(r.y+s.y)/2-i*Math.cos(Math.atan(-o)),c.x=(r.x+s.x)/2+i*Math.sin(Math.atan(-o)),c.y=(r.y+s.y)/2+i*Math.cos(Math.atan(-o))):(l.x=(r.x+s.x)/2,c.x=l.x,l.y=(r.y+s.y)/2-i,c.y=l.y+2*i):(l.x=r.x-i,c.x=r.x+i,l.y=(r.y+s.y)/2,c.y=l.y),this.drawLine(l,c),2==n)return this.drawArrow(l,c),void this.drawArrow(c,l);e[e.length]=e[0];var u=a(e,l),d=a(e,c);0==n&&u||1==n&&d?this.drawArrow(c,l):this.drawArrow(l,c)}},drawText:function(e,n,r){n&&n.length&&n[0]&&void 0!==n[0].x&&void 0!==n[0].y&&(t.beginPath(),t.font="25px Tahoma",t.fillStyle=i,t.textAlign="left",t.textBaseline="middle",t.fillText(e,n[0].x,n[0].y),t.closePath())},getTextAngleCoordinates:function(e,t,n){for(var i={},r=new Array(t),s=0;s<t;s++)r[s]={},r[s].x=e[s].x,r[s].y=-e[s].y;var a,o,l,c=0,u=-1,d=0,h=0;if(0==n){for(c=0;c<t-1;c++)a=r[c].x-r[c+1].x,o=r[c].y-r[c+1].y,(l=Math.sqrt(a*a+o*o))-h>1e-4&&(u=c,h=l,d=Math.atan2(o,a));if(-1==u||h<0)return void(r=null)}else 2==nSideConfig&&(a=r[0].x-r[1].x,o=r[0].y-r[1].y,l=Math.sqrt(a*a+o*o),u=0,d=Math.atan2(o,a));var f=180*d/Math.PI;return i=90==f||-90==f?r[u].y>r[u+1].y?r[u]:r[u+1]:r[u].x<r[u+1].x?r[u]:r[u+1],f>=-180&&f<-90?f+=180:f>=90&&f<=180&&(f-=180),r=null,{pPointsDraw:i,nAngleDraw:f}},drawHalfline:function(e,t){var n=new Array(2);n[0]={},n[1]={},n[0].x=e.x,n[0].y=e.y,n[1].x=(3*e.x+t.x)/4,n[1].y=(3*e.y+t.y)/4,this.drawLine(n[0],n[1]),n[0].x=(e.x+3*t.x)/4,n[0].y=(e.y+3*t.y)/4,n[1].x=t.x,n[1].y=t.y,this.drawLine(n[0],n[1])},drawBlock:function(e,t){var n=new Array(5),i=0;0==t&&(n[0]={},n[1]={},n[2]={},n[3]={},n[4]={},n[0].x=e.left,n[0].y=e.top,n[1].x=e.right,n[1].y=e.top,n[2].x=e.right,n[2].y=e.bottom,n[3].x=e.left,n[3].y=e.bottom,n[4].x=e.left,n[4].y=e.top,i=5),this.drawPolyLine(n,i)},clearCanvasLayer:function(){t.clearRect(0,0,e.width+1,e.height+1)},TestDraw:function(){n++;var e=t.createLinearGradient(n+20,n+20,n+150,n+150);e.addColorStop(0,"yellow"),e.addColorStop(1,"red"),t.fillStyle=e,t.fillRect(n,n,300,300),t.stroke(),n>1100&&(n=0)},Stop:function(){jsRuleBuf=null,jsRuleInfo=null,jsRuleDataView=null}},new r};function R(e){var t,n,i,r,s,a;for(t="",i=e.length,n=0;n<i;)switch((r=e[n++])>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:t+=String.fromCharCode(r);break;case 12:case 13:s=e[n++],t+=String.fromCharCode((31&r)<<6|63&s);break;case 14:s=e[n++],a=e[n++],t+=String.fromCharCode((15&r)<<12|(63&s)<<6|(63&a)<<0)}return t}var x=function(){var e="#0000FF",t="#FF0000",n="#00CCFF",i="#E1D800",r="#24FF00",s="#FF8000",a="#FF80FF",o="#8000FF",l="#FF5700",c="#FFFFFF",u=287,d=294,h=601,f=769,p=770,m=804,g=16384,v=573,y=556,w=299,S=300,b=null,T=null,C=null,_=null,P=null,x=null,I=null,E=null,D=null,M=null,U=60,k=50,L=new Array(32),N=0,O=new Array(32),F=0,B={};function V(){}function $(e){var t="#00FF00";switch(e){case 1:t=n;break;case 2:case 16:t=i;break;case 17:t=r;break;case 22:t=s;break;case 23:t=a;break;case 63:t=o}return t}return V.prototype={Init:function(e){(b=new A).Init(e)},setIVSData:function(e,t,n,i){switch(t){case 4:!function(e,t){Date.now(),C||(T=new ArrayBuffer(t),C=new Uint8Array(T),_=new DataView(T)),C.set(Module.HEAPU8.subarray(e,e+t));var n=0;L[N]={},L[N].nRuleID=_.getUint32(0,!0),L[N].nRuleType=_.getUint32(4,!0),L[N].nRuleSubType=_.getUint32(8,!0),L[N].nRuleNameLength=_.getUint32(12,!0);var i=C.slice(16,16+L[N].nRuleNameLength);L[N].strRuleName=R(i),L[N].nExcludeRegionNum=_.getUint32(144,!0),L[N].nDirection=_.getInt32(148,!0),L[N].nAlarmNum=_.getUint32(152),L[N].bAlarm=_.getUint8(154),n=156;for(var r=_.getUint32(n,!0),s=new Array(r),a=0;a<r;a++)s[a]={},s[a].x=_.getUint32(n+4+8*a,!0),s[a].y=_.getUint32(n+8+8*a,!0);L[N].DetectLinePoints=s,n=n+4+256;var o=_.getUint32(n,!0),l=new Array(o);for(a=0;a<o;a++)l[a]={},l[a].x=_.getUint32(n+4+8*a,!0),l[a].y=_.getUint32(n+8+8*a,!0);L[N].RuleRegionPoints=l,n=n+4+256;var c=_.getUint32(n,!0),u=new Array(c);for(a=0;a<c;a++)u[a]={},u[a].x=_.getUint32(n+4+8*a,!0),u[a].y=_.getUint32(n+8+8*a,!0);L[N].DetectRegionPoints=u;var d=n=n+4+256,h=new Array(L[N].nExcludeRegionNum);for(a=0;a<L[N].nExcludeRegionNum;a++){var f=_.getUint32(d,!0);h[a]=new Array(f);for(var p=0;p<f;p++)h[a][p]={},h[a][p].x=_.getUint32(d+4+8*p,!0),h[a][p].y=_.getUint32(d+8+8*p,!0);d=d+4+256}L[N].ExcludeRegionPoints=h,n+=2600;var m=new Array(2);for(a=0;a<2;a++)m[a]={},m[a].x=_.getUint32(n+8*a,!0),m[a].y=_.getUint32(n+4+8*a,!0);L[N].DirectionPoints=m,n+=16,L[N].nIntelFlowLength=_.getUint32(n,!0);var g=C.slice(n+4,n+4+L[N].nIntelFlowLength);L[N].strIntelFlow=R(g),n=n+4+256;var v=_.getUint32(n,!0),y=new Array(v);for(a=0;a<v;a++)y[a]={},y[a].x=_.getUint32(n+4+8*a,!0),y[a].y=_.getUint32(n+8+8*a,!0);L[N].EscalatorLeftPoints=y,n=n+4+256;var w=_.getUint32(n,!0),S=new Array(w);for(a=0;a<w;a++)S[a]={},S[a].x=_.getUint32(n+4+8*a,!0),S[a].y=_.getUint32(n+8+8*a,!0);L[N].EscalatorRightPoints=S,n=n+4+256,Date.now(),N++}(n,i);break;case 5:!function(e,t){O[F]={},x||(P=new ArrayBuffer(t),x=new Uint8Array(P),I=new DataView(P)),x.set(Module.HEAPU8.subarray(e,e+t)),O[F].bAlarm=I.getUint8(0),O[F].nObjType=I.getUint32(4,!0);var n={};n.x=I.getUint16(8,!0),n.y=I.getUint16(10,!0),n.xSize=I.getUint16(12,!0),n.ySize=I.getUint16(14,!0),O[F].ptIvsTrackPoint=n;var i={};i.x=I.getUint16(16,!0),i.y=I.getUint16(18,!0),i.xSize=I.getUint16(20,!0),i.ySize=I.getUint16(22,!0),O[F].ptSpecialShapePoint=i;for(var r=new Array(2),s=0;s<2;s++)r[s]={},r[s].x=I.getUint32(24+8*s,!0),r[s].y=I.getUint32(28+8*s,!0);O[F].ptTrackTextPoints=r,O[F].nTrackTextLength=I.getUint32(40,!0);var a=x.slice(44,44+O[F].nTrackTextLength);O[F].strTrackTextInfo=R(a);var o=300;O[F].struAttribute80={};var l={};l.x=I.getUint16(o,!0),l.y=I.getUint16(o+2,!0),l.xSize=I.getUint16(o+4,!0),l.ySize=I.getUint16(o+6,!0),O[F].struAttribute80.ptCarWindowPoint=l,o+=8,O[F].struAttribute84={},O[F].struAttribute84.nPointsNum=I.getUint32(o,!0),o+=4;var c=new Array(O[F].struAttribute84.nPointsNum);for(s=0;s<O[F].struAttribute84.nPointsNum;s++)c[s]={},c[s].x=I.getUint16(o+8*s,!0),c[s].y=I.getUint16(o+2+8*s,!0),c[s].xSize=I.getUint16(o+4+8*s,!0),c[s].ySize=I.getUint16(o+6+8*s,!0);O[F].struAttribute84.ptIvsTrackPoints=c,o+=256;var u=new Array(O[F].struAttribute84.nPointsNum);for(s=0;s<O[F].struAttribute84.nPointsNum;s++)u[s]={},u[s].x=I.getUint32(o+8*s,!0),u[s].y=I.getUint32(o+4+8*s,!0);O[F].struAttribute84.ptTrackPoints0=u,o+=256;var d=new Array(O[F].struAttribute84.nPointsNum);for(s=0;s<O[F].struAttribute84.nPointsNum;s++)d[s]={},d[s].x=I.getUint32(o+8*s,!0),d[s].y=I.getUint32(o+4+8*s,!0);O[F].struAttribute84.ptTrackPoints1=d,o+=256,O[F].struAttribute8C={},O[F].struAttribute8C.nAccessoryNum=I.getUint8(o),O[F].struAttribute8C.nTissueBoxNum=I.getUint8(o+1),O[F].struAttribute8C.nSunVisorCount=I.getUint8(o+2),O[F].struAttribute8C.nStandardCount=I.getUint8(o+3),o+=4;var h=new Array(O[F].struAttribute8C.nAccessoryNum);for(s=0;s<O[F].struAttribute8C.nAccessoryNum;s++)h[s]={},h[s].x=I.getUint16(o+8*s,!0),h[s].y=I.getUint16(o+2+8*s,!0),h[s].xSize=I.getUint16(o+4+8*s,!0),h[s].ySize=I.getUint16(o+6+8*s,!0);O[F].struAttribute8C.ptAccessoryPoints=h,o+=256;var f=new Array(O[F].struAttribute8C.nTissueBoxNum);for(s=0;s<O[F].struAttribute8C.nTissueBoxNum;s++)f[s]={},f[s].x=I.getUint16(o+8*s,!0),f[s].y=I.getUint16(o+2+8*s,!0),f[s].xSize=I.getUint16(o+4+8*s,!0),f[s].ySize=I.getUint16(o+6+8*s,!0);O[F].struAttribute8C.ptTissueBoxPoints=f,o+=256;var p=new Array(O[F].struAttribute8C.nSunVisorCount);for(s=0;s<O[F].struAttribute8C.nSunVisorCount;s++)p[s]={},p[s].x=I.getUint16(o+8*s,!0),p[s].y=I.getUint16(o+2+8*s,!0),p[s].xSize=I.getUint16(o+4+8*s,!0),p[s].ySize=I.getUint16(o+6+8*s,!0);O[F].struAttribute8C.ptSunVisorPoints=p,o+=256;var m=new Array(O[F].struAttribute8C.nStandardCount);for(s=0;s<O[F].struAttribute8C.nStandardCount;s++)m[s]={},m[s].x=I.getUint16(o+8*s,!0),m[s].y=I.getUint16(o+2+8*s,!0),m[s].xSize=I.getUint16(o+4+8*s,!0),m[s].ySize=I.getUint16(o+6+8*s,!0);O[F].struAttribute8C.ptStandardPoints=m,o+=256,O[F].struAttribute8D={},O[F].struAttribute8D.nVirtualCoilNum=I.getUint32(o,!0),o+=4,O[F].struAttribute8D.struVirtualCoil=new Array(O[F].struAttribute8D.nVirtualCoilNum);for(s=0;s<O[F].struAttribute8D.nVirtualCoilNum;s++){O[F].struAttribute8D.struVirtualCoil[s]={},O[F].struAttribute8D.struVirtualCoil[s].nFirstCoilNum=I.getUint32(o,!0),o+=4;for(var g=new Array(O[F].struAttribute8D.struVirtualCoil[s].nFirstCoilNum),v=0;v<O[F].struAttribute8D.struVirtualCoil[s].nFirstCoilNum;v++)g[v]={},g[v].x=I.getUint32(o+8*v,!0),g[v].y=I.getUint32(o+4+8*v,!0);O[F].struAttribute8D.struVirtualCoil[s].ptFirstCoilPoints=g,o+=64,O[F].struAttribute8D.struVirtualCoil[s].nSecondCoilNum=I.getUint32(o,!0),o+=4;var y=new Array(O[F].struAttribute8D.struVirtualCoil[s].nSecondCoilNum);for(v=0;v<O[F].struAttribute8D.struVirtualCoil[s].nSecondCoilNum;v++)y[v]={},y[v].x=I.getUint32(o+8*v,!0),y[v].y=I.getUint32(o+4+8*v,!0);O[F].struAttribute8D.struVirtualCoil[s].ptSecondCoilPoints=y,o+=64;var w=new Array(2);for(v=0;v<2;v++)w[v]={},w[v].x=I.getUint32(o+8*v,!0),w[v].y=I.getUint32(o+4+8*v,!0);O[F].struAttribute8D.struVirtualCoil[s].ptRtailCoilPoints=w,o+=16;var S=new Array(2);for(v=0;v<2;v++)S[v]={},S[v].x=I.getUint32(o+8*v,!0),S[v].y=I.getUint32(o+4+8*v,!0);O[F].struAttribute8D.struVirtualCoil[s].ptStrInfoPoints=S,o+=16,O[F].struAttribute8D.struVirtualCoil[s].nStrInfoLength=I.getUint32(o,!0);var b=x.slice(o+4,o+4+O[F].struAttribute8D.struVirtualCoil[s].nStrInfoLength);O[F].struAttribute8D.struVirtualCoil[s].strInfo=R(b),o+=260}O[F].struAttribute8D.nVirtualCoilNum<5&&(o+=428*(5-O[F].struAttribute8D.nVirtualCoilNum)),O[F].struAttribute90={};var T=new Array(2);for(s=0;s<2;s++)T[s]={},T[s].x=I.getUint32(o+8*s,!0),T[s].y=I.getUint32(o+4+8*s,!0);O[F].struAttribute90.ptTimePoints=T,o+=16,O[F].struAttribute90.nTimeInfoLength=I.getUint32(o,!0);var C=x.slice(o+4,o+4+O[F].struAttribute90.nTimeInfoLength);O[F].struAttribute90.strTimeInfo=R(C),o+=260,F++}(n,i);break;case 6:!function(e,t){D||(E=new ArrayBuffer(t),D=new Uint8Array(E),M=new DataView(E)),D.set(Module.HEAPU8.subarray(e,e+t)),B.nBlockNum=M.getUint32(0,!0);for(var n=new Array(B.nBlockNum),i=0;i<B.nBlockNum;i++)n[i]={},n[i].left=M.getUint32(4+16*i,!0),n[i].top=M.getUint32(8+16*i,!0),n[i].right=M.getUint32(12+16*i,!0),n[i].bottom=M.getUint32(16+16*i,!0);B.arrBlockRect=n}(n,i)}},Stop:function(){T=null,C=null,_=null,P=null,x=null,I=null,E=null,D=null,M=null,L=null,N=0,O=null,F=0,b.clearCanvasLayer()},drawIVSData:function(){b.clearCanvasLayer(),function(){var n=e;b.SetCurrentColor(n);for(var i=0;i<N;i++){L[i].bAlarm&&(n=t,b.SetCurrentColor(n));var r=L[i].DetectLinePoints.length,s=L[i].RuleRegionPoints.length,a=L[i].DetectRegionPoints.length,o=L[i].nRuleType;switch(o){case u:b.drawPolyLine(L[i].DetectLinePoints,r);for(var T=1;T<r;T++)b.drawDirection(L[i].DetectLinePoints[T-1],L[i].DetectLinePoints[T],L[i].nDirection,U);b.drawPolyLine(L[i].RuleRegionPoints,s);break;case d:0!=L[i].nAlarmNum&&b.drawPolyLine(L[i].RuleRegionPoints,s);break;case h:if(2==r&&(b.drawLine(L[i].DetectLinePoints[0],L[i].DetectLinePoints[1]),b.drawArrow(L[i].DetectLinePoints[0],L[i].DetectLinePoints[1])),L[i].nRuleRegionNum>0)for(T=0;T<s/2;T++)b.drawLine(L[i].RuleRegionPoints[2*T],L[i].RuleRegionPoints[2*T+1]);break;case f:case p:case m:2==r&&b.drawPolyLine(L[i].DetectLinePoints,r),b.drawPolyLine(L[i].RuleRegionPoints,s);break;case g:break;case v:b.drawPolyLine(L[i].EscalatorLeftPoints,L[i].EscalatorLeftPoints.length),b.drawPolyLine(L[i].EscalatorRightPoints,L[i].EscalatorRightPoints.length);break;default:b.SetCurrentColor(n);var C=!1;r>0&&(b.drawPolyLine(L[i].DetectLinePoints,r),L[i].nDirection>=0&&r>1&&(b.drawDirection(L[i].DetectLinePoints[0],L[i].DetectLinePoints[1],L[i].nDirection,U),C=!0)),s>0&&(L[i].RuleRegionPoints[s]=L[i].RuleRegionPoints[0],b.drawPolyLine(L[i].RuleRegionPoints,s+1),L[i].nDirection>=0&&s>1&&(b.drawRegionDirection(L[i].RuleRegionPoints,s,L[i].nDirection,k),C=!0)),C||L[i].DirectionPoints[0].x==L[i].DirectionPoints[1].x&&L[i].DirectionPoints[0].y==L[i].DirectionPoints[1].y||(b.drawLine(L[i].DirectionPoints[0],L[i].DirectionPoints[1]),b.drawArrow(L[i].DirectionPoints[0],L[i].DirectionPoints[1]))}a>0&&(b.SetCurrentColor(l),L[i].DetectRegionPoints[a]=L[i].DetectRegionPoints[0],b.drawPolyLine(L[i].DetectRegionPoints,a+1)),b.SetCurrentColor(c);for(T=0;T<L[i].nExcludeRegionNum;T++){var _=L[i].ExcludeRegionPoints[T].length;L[i].ExcludeRegionPoints[T][_]=L[i].ExcludeRegionPoints[T][0],b.drawPolyLine(L[i].ExcludeRegionPoints[T],_+1)}b.SetCurrentColor(n);var P={};r>0?P=L[i].DetectLinePoints:s>0&&(P=L[i].RuleRegionPoints),L[i].nIntelFlowLength>0&&b.drawText(L[i].strIntelFlow,P,P.length),o!=y&&(o==h||o==w||o==S?b.drawText(L[i].strRuleName,L[i].RuleRegionPoints,L[i].RuleRegionPoints.length):o==f||o==p?ptRuleRegionCnt>0&&b.drawText(L[i].strRuleName,L[i].RuleRegionPoints,L[i].RuleRegionPoints.length):b.drawText(L[i].strRuleName,P,P.length))}N=0}(),function(){for(var e=0;e<F;e++){var n=$(O[e].nObjType);b.SetCurrentColor(n),O[e].bAlarm&&b.SetCurrentColor(t),b.drawTrackLine(O[e].ptIvsTrackPoint,0),b.drawTrackLine(O[e].ptSpecialShapePoint,0),b.drawText(O[e].strTrackTextInfo,O[e].ptTrackTextPoints,O[e].ptTrackTextPoints.length),b.drawTrackLine(O[e].struAttribute80.ptCarWindowPoint,0);for(var i=0;i<O[e].struAttribute84.nPointsNum;i++)b.drawTrackLine(O[e].struAttribute84.ptIvsTrackPoints[i],0);for(i=0;i<O[e].struAttribute8C.nAccessoryNum;i++)b.drawTrackLine(O[e].struAttribute8C.ptAccessoryPoints[i],0);for(i=0;i<O[e].struAttribute8C.nTissueBoxNum;i++)b.drawTrackLine(O[e].struAttribute8C.ptTissueBoxPoints[i],0);for(i=0;i<O[e].struAttribute8C.nSunVisorCount;i++)b.drawTrackLine(O[e].struAttribute8C.ptSunVisorPoints[i],0);for(i=0;i<O[e].struAttribute8C.nStandardCount;i++)b.drawTrackLine(O[e].struAttribute8C.ptStandardPoints[i],0);for(i=0;i<O[e].struAttribute8D.nVirtualCoilNum;i++){b.drawPolyLine(O[e].struAttribute8D.struVirtualCoil[i].ptFirstCoilPoints,O[e].struAttribute8D.struVirtualCoil[i].nFirstCoilNum),b.drawPolyLine(O[e].struAttribute8D.struVirtualCoil[i].ptSecondCoilPoints,O[e].struAttribute8D.struVirtualCoil[i].nSecondCoilNum),b.drawLine(O[e].struAttribute8D.struVirtualCoil[i].ptRtailCoilPoints[0],O[e].struAttribute8D.struVirtualCoil[i].ptRtailCoilPoints[1]);var r=O[e].struAttribute8D.struVirtualCoil[i].strInfo.length;b.drawText(O[e].struAttribute8D.struVirtualCoil[i].strInfo,O[e].struAttribute8D.struVirtualCoil[i].ptStrInfoPoints,r)}b.drawText(O[e].struAttribute90.strTimeInfo,O[e].struAttribute90.ptTimePoints,O[e].struAttribute90.strTimeInfo.length)}F=0}(),function(){for(var e=B.nBlockNum,t=0;t<e;t++)b.drawBlock(B.arrBlockRect[t],0)}()}},new V};function I(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?I(Object(n),!0).forEach((function(t){D(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):I(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function D(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function M(e,t){return t=(t=t.toLowerCase())[0].toUpperCase()+t.substr(1),Object.prototype.toString.call(e)==="[object "+t+"]"}function U(e,t,n){if(void 0===n&&(n=2),void 0===t&&(t=0),(e=e.toString()).length>=n)return e;var i=n-e.length;return new Array(i).fill(String(t)).join("")+e}function k(e,t){return void 0!==e&&e?(t=t||new Date,e=(e=(e=(e=(e=(e=e.replace(/y/gi,U(t.getFullYear()),0)).replace(/m/gi,U(t.getMonth()+1),0)).replace(/d/gi,U(t.getDate()),0)).replace(/h/gi,U(t.getHours()),0)).replace(/i/gi,U(t.getMinutes()),0)).replace(/s/gi,U(t.getSeconds()),0)):""}function L(e,t){var n=(e=e||{}).nameFormat||["ymd_his"];t=t||new Date;var i="";if(M(n,"string"))n=[n,{}];else{if(!M(n,"array"))return void function(e){throw new Error(e)}("name format must be string or array");M(n[0],"string")||(n[0]="ymd_his"),M(n[1],"object")||(n[1]={})}var r=n[0].split(/\{(?:[^{}]+)\}/),s=n[1];n[0].replace(/\{([^{}]*)\}/g,(function(e,t,n){r.shift(),i+=k(),i+=t in s?s[t]:e}));var a=r.shift();return i+=k(a,t)}function N(e,t){this.name=e,this.allowUpDateName=!0,this.byteLength=0,this.options=t,this.startTime=(new Date).toLocaleString()}N.prototype.setEndTime=function(){this.endTime=(new Date).toLocaleString()},N.prototype.updateNameByStream=function(e,t){if(this.allowUpDateName){var n=new Uint8Array(t),i=(n[19]<<24)+(n[18]<<16)+(n[17]<<8)+n[16]>>>0,r="20"+(i>>26)+"/"+(i>>22&15)+"/"+(i>>17&31)+" "+(i>>12&31)+":"+(i>>6&63)+":"+(63&i);this.name=L(e,new Date(r)),this.allowUpDateName=!1,n=null}t=null};var O=new function(){var e={count:0,total:0,group:[]},t=function(){};return t.prototype.add=function(t){e.count++,e.total+=t.byteLength,e.group.push(t)},t.prototype.get=function(t){return t in e?e[t]:e},new t},F=function(){var e=1048576,t=null,n=null,i=0,r=void 0,s=null,a=0,o=null;function l(){this.onMessage=function(){},this.postMessage=function(e){this.__onMessage(e)},this.__postMessage=function(e){this.onMessage(e)}}return l.prototype.__onMessage=function(e){var t=e;switch(t.type){case"init":this.init(t.options);break;case"addBuffer":this.addBuffer(t);break;case"close":this.close();break;case"cancel":this.cancel()}},l.prototype.init=function(t){this.fullSize=t.fullSize||1/0,this.singleSize=t.singleSize+20*e||520*e,r="init",o=t.recordName,this.limitOptions=Object.assign({limitBy:"fullSize"},t.limitOptions),this.nameOptions=Object.assign({namedBy:"date",nameFormat:["ymd_his",{}]},t.nameOptions)},l.prototype._malloc=function(e){t&&n&&(n=null,t=null),t=new ArrayBuffer(e),n=new DataView(t);var i=this.nameOptions,r="";if(null!=o)r=o;else switch(this.nameOptions.namedBy.toLowerCase()){case"date":r=L(i);break;default:r=L()}s=new N(r)},l.prototype._initVideoMem=function(){!t&&this.singleSize&&this._malloc(this.singleSize)},l.prototype.appendVideoBuf=function(t,r,s,o){var l=t.byteLength,c=0;if((c=5==a?r+l:i+l)>this.singleSize-20*e)this.inNodePlace(),this.addBuffer({buffer:t});else{if(5==a){for(var u=r;u<c;u++)n.setUint8(u,t[u-r]);c>i&&(i=c)}else{for(u=i;u<c;u++)n.setUint8(u,t[u-i]);i=c}this.__postMessage({type:"pendding",size:i,total:this.singleSize,time:t?s.timeStamp:"",utcTime:t?s.utcTimeStamp:""})}},l.prototype.addBuffer=function(e){if("closed"!==r){var t=e.buffer,n=e.offset,s=e.timeStamp,o=e.utcTimeStamp;a=e.recordType,this._initVideoMem(),r="addBuffer";var l=t.length,c=0;c=5==a?n+l:i+l,O.get("total")+c>this.fullSize?this.close():this.appendVideoBuf(t,n,{timeStamp:s,utcTimeStamp:o})}},l.prototype.inNodePlace=function(){if("addBuffer"===r){r="download",s.updateNameByStream(this.nameOptions,t.slice(0,20)),s.byteLength=i,s.setEndTime(),O.add(s);var e=t.slice(0,i);if(this.reset(),this.__postMessage({type:"download",data:E(E({},s),{},{buffer:e})}),e=null,"count"===this.limitOptions.limitBy){var n=this.limitOptions.count;n&&n===O.get("count")&&this.close()}}},l.prototype.reset=function(){i=0,this._malloc(this.singleSize)},l.prototype.close=function(){this.inNodePlace(),"closed"!==r&&void 0!==r&&(r="closed",this.__postMessage({type:"closed",message:"record was closed"}),t=null,n=null)},l.prototype.cancel=function(){"closed"!==r&&void 0!==r&&(r="closed",this.__postMessage({type:"closed",message:"record was closed"}),t=null,n=null)},new l},B=function(){var e=0,t=null,n=null,r=null,s=null,a=null,o=null,l=null,c=null,u=null,d=1,h="",f=!1,p=null,m=0,S={id:1,samples:null,baseMediaDecodeTime:0},T=0,C=null,_=2,A=0,R=0,I=0,E=1,D=0,M=null,U={timestamp:0,timestamp_usec:0},k=null,L=null,N=null,O=null,B=null,V=null,$=null,W=null,z=null,q=null,G=null,Y="",H=!1,j=null,Z=null,X=0,K=0,J=0,Q=null,ee=null,te=null,ne=0,ie=null,re=null,se=null,ae=null,oe=null,le=null,ce=null,ue=null,de=null,he=null,fe=null,pe=null,me=null,ge=0,ve=0,ye=null,we=0,Se=0,be=0,Te=null,Ce=0,_e=!(/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream),Pe=!1,Ae=!1,Re=0,xe=null,Ie=0,Ee=!1,De=18,Me=20,Ue=!1,ke=!1;function Le(){}function Ne(){s&&(s.setDecodeType(Ce),s.setCodecInfo(h),s.setInitSegmentFunc(Be),s.setSpeedPlay(d),s.setFPS(m))}function Oe(){s&&(s.setVideoSizeCallback(Ve),s.setBeginDrawCallback(k),s.setErrorCallback(O),s.setAudioStartCallback(Fe),s.setMseErrorCallback($e))}function Fe(e,t){}function Be(){return p}function Ve(){null!==N&&N(!1)}function $e(e){switch(e){case"InitError":1==Ce?_e=!1:Pe=!1,Module._PLAY_SetSupportWebMSE(_e,Pe);break;case"Error":case"SourceError":case"SourceBufferError":Ae=!0}}function We(){s&&(s.close(),s.terminate(),s=null),p=null,a=null,o=null,f=!1,Ee=!1,A=0,S={id:1,samples:null,baseMediaDecodeTime:0},T=0,E=1,I=0,D=0,R=0,_=2}function ze(e){return e<10?"0".concat(e):e}return Le.prototype={Init:function(r,a,o,l){Pe=Object(i.g)(),Module._PLAY_SetSupportWebMSE(_e,Pe);var c=Module._malloc(1),u=new Uint8Array(Module.HEAPU8.buffer,c,1);Module._PLAY_GetFreePort(u.byteOffset),e=u[0],u=null,Module._free(c),Module._PLAY_ViewResolutionChanged(e,parseInt(r.width),parseInt(r.height),0);var d=l?1:0,h=Module._PLAY_SetStreamOpenMode(e,d);return Module._PLAY_OpenStream(e,0,0,10485760),(h=Module._PLAY_Play(e,1))&&(z=Module._malloc(5242880),q=new Uint8Array(Module.HEAPU8.buffer,z,5242880),ye=new g(r,!0===l?100:25,l),t=a,n=o,(Pe||_e)&&((s=b()).init(t),Oe())),h},GetPlayPort:function(){return e},InputData:function(t,n){var i=0;return q&&(q.set(n),i=Module._PLAY_InputData(e,q.byteOffset,n.length)),i},Pause:function(e){return Module._PLAY_Pause(e)},SetPlaySpeed:function(t){var n=Module._PLAY_SetPlaySpeed(e,t);return ye.setPlaySpeed(t),d=t,n},SetSecurityKey:function(t,n,i,r,s){var a=Module._malloc(49),o=new Uint8Array(Module.HEAPU8.buffer),l=0;if(1==t)n.forEach((function(e,t){o[a+l>>0]=e,l++}));else if(2==t){var c=new Uint8Array(16);if(o[a+l>>0]=1,l++,0==s){for(var u=0;u<16;u++)c[u]=0;s=16,r=c}r.forEach((function(e,t){o[a+l>>0]=e,l++})),n.forEach((function(e,t){o[a+l]=e,l++})),i=1+i+s,c=null}else 3==t&&n.split("").forEach((function(e,t){o[a+l>>0]=e.charCodeAt(0),l++}));var d=Module._PLAY_SetSecurityKey(e,a,i);return Module._free(a),d},StartRecord:function(t){return xe=new F,function(e,t){var n=parseInt(e)||500;xe.postMessage({type:"init",options:{recordName:t,singleSize:1048576*n,nameOptions:{namedBy:"date",nameFormat:["ymd_his"]},limitOptions:{limitBy:"count",count:10}}}),xe.onMessage=function(e){switch(e.type){case"pendding":$&&$(e);break;case"download":!function(e,t){var n=new Blob([t]),i=document.createElement("a");i.href=URL.createObjectURL(n),i.download=e,i.click(),URL.revokeObjectURL(i.href),i=null,t=null}(e.data.name,e.data.buffer);break;case"closed":$&&$(e),xe=null}}}(500,t),ne=5,Module._PLAY_StartDataRecord(e,0,5)},StopRecord:function(){var t=Module._PLAY_StopDataRecord(e);return xe.postMessage({type:"close"}),xe=null,t},CancelRecord:function(){var t=Module._PLAY_StopDataRecord(e);return xe.postMessage({type:"cancel"}),xe=null,t},OpenIVSDraw:function(){return(Te=new x).Init(n),Module._PLAY_RenderPrivateData(e,1,0)},CloseIVSDraw:function(){var t=Module._PLAY_RenderPrivateData(e,0,0);return Te.Stop(),Te=null,t},Stop:function(){var t=Module._PLAY_Stop(e);return 0==t||(t=Module._PLAY_CloseStream(e),a=null,o=null,s&&(s.close(),s.terminate(),s=null),q=null,Module._free(z),Q=null,ee=null,te=null,ie=null,re=null,se=null,ae=null,oe=null,le=null,ce=null,ue=null,de=null,fe=null,pe=null,me=0,he&&(he.stop(),he=null),ye&&(ye&&ye.stopRendering(),ye&&ye.terminate(),ye=null),we=0,Se=0,be=0,p=null,h=null,Ae=!1,f=!1,Te&&(Te.Stop(),Te=null),Ie=0,Ee=!1,Re=0,ke=!1),t},FrameDataCallBack:function(e,n,i,r,g,P,x,L){re||(ie=new ArrayBuffer(292),re=new Uint8Array(ie),se=new DataView(ie)),re.set(Module.HEAPU8.subarray(P,P+292));var N=se.getInt32(0,!0),O=(se.getInt32(4,!0),se.getInt32(56,!0)),F=se.getUint16(40,!0),$=ze(se.getUint16(42,!0)),z=ze(se.getUint16(46,!0)),q=ze(se.getUint16(48,!0)),Q=ze(se.getUint16(50,!0)),ee=ze(se.getUint16(52,!0)),te=Date.UTC(F,$,z,q,Q,ee)/1e3,ne=new Date("".concat(F,"-").concat($,"-").concat(z," ").concat(q,":").concat(Q,":").concat(ee)).getTime();if(U.timestamp=te,U.timestamp_usec=0,1==N){var Te=se.getInt32(68,!0),xe=se.getInt32(72,!0),Le=se.getUint32(8,!0);if(U.timestamp=8==xe?te:Le/1e3,U.timestamp_usec=0,2==Te||4==Te||8==Te?Ce=1:12==Te&&(Ce=2),se.getInt32(36,!0),X=se.getInt32(12,!0),K=se.getInt32(16,!0),0==X||0==K)return;if(m=se.getInt32(20,!0),Ie<=5&&Ie++,De==O||Me==O?J=1:0==O&&(J=0),(1==Ce&&1==_e||2==Ce&&1==Pe)&&!J&&13!=xe){if(X==we&&K==Se&&Te==be||(0!=we&&(Ae=!0),we=X,Se=K,be=Te),Ae&&(We(),Ae=!1),0==Ee&&0!=O)return;Z=new ArrayBuffer(g),(G=new Uint8Array(Z)).set(Module.HEAPU8.subarray(n,n+g)),null==a&&(a=new w(Ce)),null==o&&(o=new y(Ce)),function(e,t,n){for(var i=null,r=e.length,s=[],d=0;d<=r;)if(0==e[d])if(0==e[d+1])if(1==e[d+2]){if(s.push(d),d+=3,1==Ce){if(5==(31&e[d])||1==(31&e[d]))break}else if(2==Ce&&(38==(255&e[d])||2==(255&e[d])))break}else 0==e[d+2]?d++:d+=3;else d+=2;else d+=1;var g=0;if(1==Ce){for(d=0;d<s.length;d++)switch(i=e.subarray(s[d]+3,s[d+1]),31&e[s[d]+3]){case 1:case 5:g=s[d]-1,M=e.subarray(g,e.length);break;case 7:a.parse(i),c=i;break;case 8:u=i}if(!f){f=!0;var v={id:1,width:X,height:K,type:"video",profileIdc:a.getSpsValue("profile_idc"),profileCompatibility:0,levelIdc:a.getSpsValue("level_idc"),sps:[c],pps:[u],timescale:1e3,fps:m};p=o.initSegment(v),h=a.getCodecInfo()}}else if(2==Ce){for(d=0;d<s.length;d++)switch(i=e.subarray(s[d]+3,s[d+1]-1),255&e[s[d]+3]){case 2:case 38:g=s[d]-1,M=e.subarray(g,e.length);break;case 64:l=i;break;case 66:var y=e.subarray(s[d]+5,s[d+1]-1);a.parse(y),c=i;break;case 68:u=i}if(!f){f=!0;var w=a.getSpsValue("general_profile_space"),S=a.getSpsValue("general_tier_flag"),b=a.getSpsValue("general_profile_idc"),T=a.getSpsValue("temporalIdNested");v=(a.getSpsValue("general_profile_compatibility_flags"),a.getSpsValue("general_constraint_indicator_flags"),{id:1,width:X,height:K,type:"video",general_profile_flag:w<<6|S<<5|b,general_profile_compatibility_flags:a.getSpsValue("general_profile_compatibility_flags"),general_constraint_indicator_flags:a.getSpsValue("general_constraint_indicator_flags"),general_level_idc:a.getSpsValue("general_level_idc"),chroma_format_idc:a.getSpsValue("chroma_format_idc"),bitDepthLumaMinus8:a.getSpsValue("bitDepthLumaMinus8"),bitDepthChromaMinus8:a.getSpsValue("bitDepthChromaMinus8"),rate_layers_nested_length:11|(1&T)<<2,vps:[l],sps:[c],pps:[u],timescale:1e3,fps:m});p=o.initSegment(v)}}}(G),0==Ee&&(Re=1,null==s&&(s=b()).init(t),B(Fe={decodeMode:"video"}),Oe(),Ne(),Ee=!0),H&&(H=!1,s&&s.capture(Y,{ivsCanvasArr:[j]},W,Ue)),s&&s.setvideoTimeStamp(U),function(){if(null!=M){var e={duration:Math.round(1/m*1e3),size:M.length,frame_time_stamp:null,frameDuration:null};e.frameDuration=e.duration,null==S.samples&&(S.samples=new Array(_)),S.samples[A++]=e,R+=e.frameDuration,I+=e.frameDuration;var t=M.length-4;M[0]=(4278190080&t)>>>24,M[1]=(16711680&t)>>>16,M[2]=(65280&t)>>>8,M[3]=255&t;var n=new Uint8Array(M.length+T);if(0!==T&&n.set(C),n.set(M,T),T=(C=n).length,A%_===0&&0!==A){if(null!==S.samples[0].frameDuration&&(S.baseMediaDecodeTime=1===E?0:D,D=R),1==d)for(var i=S.samples.length,r=I/_,a=0;a<i;a++)S.samples[a].frameDuration=r;I=0;var l=o.mediaSegment(E,S,C,S.baseMediaDecodeTime);E++,A=0,C=null,T=0,null!==s?s.setMediaSegment(l):!1===f&&Ne(),2==_&&(_=1,S.samples=null,S.samples=new Array(_))}}}(),Z=null,G=null}else{if(0==n||0==i||0==r)return;0!=Re&&(We(),Ae=!0,we=0,Se=0);var Fe,Be=se.getInt32(76,!0);X==we&&K==Se||(Re=0,we=X,Se=K,ye.resize(X,K),(Fe={decodeMode:"canvas"}).width=X,Fe.height=K,[2,4,8].includes(Te)?Fe.encodeMode="H264":12===Te&&(Fe.encodeMode="H265"),B(Fe),ae=null,oe=null,le=null,ce=null,ue=null,de=null,ae=new ArrayBuffer(X*K),ce=new Uint8Array(ae),oe=new ArrayBuffer(X*K/4),ue=new Uint8Array(oe),le=new ArrayBuffer(X*K/4),de=new Uint8Array(le));var Ve=0;for(Ve=0;Ve<K;Ve++)ce.set(Module.HEAPU8.subarray(n+Ve*Be,n+Ve*Be+X),Ve*X);for(Ve=0;Ve<K/2;Ve++)ue.set(Module.HEAPU8.subarray(i+Ve*Be/2,i+Ve*Be/2+X/2),Ve*X/2);for(Ve=0;Ve<K/2;Ve++)de.set(Module.HEAPU8.subarray(r+Ve*Be/2,r+Ve*Be/2+X/2),Ve*X/2);ke||(ke=!0,k("PlayStart")),ye&&ye.draw(ce,ue,de,m),H&&(H=!1)}V({timeStamp:ne,utcTimeStamp:te})}else if(2==N){if(d>1)return;if(Ie<5&&!L){if(m>5||0==m)return;if(Ie<2)return}if(se.getInt32(24,!0),se.getInt32(80,!0)>0)return;var $e=se.getInt32(28,!0),qe=se.getInt32(32,!0);se.getInt32(84,!0),me!=g&&(me=g,fe=null,pe=null,fe=new ArrayBuffer(g),pe=new Uint8Array(fe)),pe.set(Module.HEAPU8.subarray(n,n+g));for(var Ge=new Int16Array(pe.buffer,pe.byteOffset,pe.byteLength/Int16Array.BYTES_PER_ELEMENT),Ye=new Float32Array(Ge.length),He=0;He<Ge.length;He++)Ye[He]=Ge[He]/Math.pow(2,15);qe==ge&&$e==ve||(ge=qe,ve=$e,he&&(he.stop(),he=null),he=new v,window.webAudioPlayer=he,he.setSamplingRate(qe),null!==he&&(he.setInitVideoTimeStamp(0),he.audioInit(x,qe)||(he.stop(),he=null,window.webAudioPlayer=null))),he&&he.bufferAudio(Ye,0),Ge=null,Ye=null}},DecryptionResultCallBack:function(e,t,n){},IVSDataCallBack:function(e,t,n,i){Te&&Te.setIVSData(e,t,n,i)},DrawIVSDataCallBack:function(e){Te&&Te.drawIVSData()},RecordDataCallBack:function(e,t,n,i,r){ee||(Q=new ArrayBuffer(292),ee=new Uint8Array(Q),te=new DataView(Q)),ee.set(Module.HEAPU8.subarray(r,r+292));var s=te.getInt32(0,!0);if(te.getInt32(4,!0),te.getInt32(56,!0),1==s){te.getInt32(68,!0),te.getInt32(72,!0),te.getUint32(8,!0);var a=te.getUint16(40,!0),o=ze(te.getUint16(42,!0)),l=ze(te.getUint16(46,!0)),c=ze(te.getUint16(48,!0)),u=ze(te.getUint16(50,!0)),d=ze(te.getUint16(52,!0)),h=Date.UTC(a,o,l,c,u,d)/1e3,f=new Date("".concat(a,"-").concat(o,"-").concat(l," ").concat(c,":").concat(u,":").concat(d)).getTime()}var p=new ArrayBuffer(n),m=new Uint8Array(p);m.set(Module.HEAPU8.subarray(t,t+n)),xe.postMessage({type:"addBuffer",buffer:m,offset:i,timeStamp:f,utcTimeStamp:h,recordType:ne}),p=null,m=null},setCallback:function(e,t){switch(e){case"timeStamp":case"ResolutionChanged":break;case"audioTalk":L=t;break;case"stepRequest":case"metaEvent":case"videoMode":break;case"loadingBar":N=t;break;case"Error":O=t;break;case"PlayStart":k=t;break;case"DecodeStart":B=t;break;case"UpdateCanvas":V=t;break;case"FrameTypeChange":case"MSEResolutionChanged":case"audioChange":case"WorkerReady":break;case"recordChanged":$=t;break;case"CaptureChanged":W=t}},capture:function(e,t,n){Y=e,H=!0,j=t,Ue=n,ye.capture(e,t,W,Ue)},mute:function(e){he&&he.Mute(e)},setVolume:function(e){he&&he.setVolume(e)},talkInit:function(e,t){r||(r=new P),r.talkInit(e,t),r.setSendAudioTalkCallback(L)},talkStop:function(){r&&r.stop()},setPlaybackSpeed:function(e){d=e,ye.setPlaySpeed(d)},GetCurrentPlayTime:function(){return U.timestamp}},new Le};function V(e){return(V="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}if("undefined"==typeof $)var $={};$.MD5=function(e){function t(e){var t=(e>>>0).toString(16);return"00000000".substr(0,8-t.length)+t}function n(e,t,n){return e&t|~e&n}function i(e,t,n){return n&e|~n&t}function r(e,t,n){return e^t^n}function s(e,t,n){return t^(e|~n)}function a(e,t){return e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]}function o(e){for(var t=[],n=0;n<e.length;n++)if(e.charCodeAt(n)<=127)t.push(e.charCodeAt(n));else for(var i=encodeURIComponent(e.charAt(n)).substr(1).split("%"),r=0;r<i.length;r++)t.push(parseInt(i[r],16));return t}function l(e){for(var t=new Array(e.length),n=0;n<e.length;n++)t[n]=e[n];return t}var c=null,u=null;function d(e,t){return 4294967295&e+t}return"string"==typeof e?c=o(e):e.constructor==Array?0===e.length?c=e:"string"==typeof e[0]?c=function(e){for(var t=[],n=0;n<e.length;n++)t=t.concat(o(e[n]));return t}(e):"number"==typeof e[0]?c=e:u=V(e[0]):"undefined"!=typeof ArrayBuffer?e instanceof ArrayBuffer?c=l(new Uint8Array(e)):e instanceof Uint8Array||e instanceof Int8Array?c=l(e):e instanceof Uint32Array||e instanceof Int32Array||e instanceof Uint16Array||e instanceof Int16Array||e instanceof Float32Array||e instanceof Float64Array?c=l(new Uint8Array(e.buffer)):u=V(e):u=V(e),u&&alert("MD5 type mismatch, cannot process "+u),function(){function e(e,t,n,i){var r,s,a=w;w=y,y=v,v=d(v,(r=d(g,d(e,d(t,n))))<<(s=i)&4294967295|r>>>32-s),g=a}var o=c.length;c.push(128);var l=c.length%64;if(l>56){for(var u=0;u<64-l;u++)c.push(0);l=c.length%64}for(u=0;u<56-l;u++)c.push(0);c=c.concat(function(e){for(var t=[],n=0;n<8;n++)t.push(255&e),e>>>=8;return t}(8*o));var h=1732584193,f=4023233417,p=2562383102,m=271733878,g=0,v=0,y=0,w=0;for(u=0;u<c.length/64;u++){g=h;var S=64*u;e(n(v=f,y=p,w=m),3614090360,a(c,S),7),e(n(v,y,w),3905402710,a(c,S+4),12),e(n(v,y,w),606105819,a(c,S+8),17),e(n(v,y,w),3250441966,a(c,S+12),22),e(n(v,y,w),4118548399,a(c,S+16),7),e(n(v,y,w),1200080426,a(c,S+20),12),e(n(v,y,w),2821735955,a(c,S+24),17),e(n(v,y,w),4249261313,a(c,S+28),22),e(n(v,y,w),1770035416,a(c,S+32),7),e(n(v,y,w),2336552879,a(c,S+36),12),e(n(v,y,w),4294925233,a(c,S+40),17),e(n(v,y,w),2304563134,a(c,S+44),22),e(n(v,y,w),1804603682,a(c,S+48),7),e(n(v,y,w),4254626195,a(c,S+52),12),e(n(v,y,w),2792965006,a(c,S+56),17),e(n(v,y,w),1236535329,a(c,S+60),22),e(i(v,y,w),4129170786,a(c,S+4),5),e(i(v,y,w),3225465664,a(c,S+24),9),e(i(v,y,w),643717713,a(c,S+44),14),e(i(v,y,w),3921069994,a(c,S),20),e(i(v,y,w),3593408605,a(c,S+20),5),e(i(v,y,w),38016083,a(c,S+40),9),e(i(v,y,w),3634488961,a(c,S+60),14),e(i(v,y,w),3889429448,a(c,S+16),20),e(i(v,y,w),568446438,a(c,S+36),5),e(i(v,y,w),3275163606,a(c,S+56),9),e(i(v,y,w),4107603335,a(c,S+12),14),e(i(v,y,w),1163531501,a(c,S+32),20),e(i(v,y,w),2850285829,a(c,S+52),5),e(i(v,y,w),4243563512,a(c,S+8),9),e(i(v,y,w),1735328473,a(c,S+28),14),e(i(v,y,w),2368359562,a(c,S+48),20),e(r(v,y,w),4294588738,a(c,S+20),4),e(r(v,y,w),2272392833,a(c,S+32),11),e(r(v,y,w),1839030562,a(c,S+44),16),e(r(v,y,w),4259657740,a(c,S+56),23),e(r(v,y,w),2763975236,a(c,S+4),4),e(r(v,y,w),1272893353,a(c,S+16),11),e(r(v,y,w),4139469664,a(c,S+28),16),e(r(v,y,w),3200236656,a(c,S+40),23),e(r(v,y,w),681279174,a(c,S+52),4),e(r(v,y,w),3936430074,a(c,S),11),e(r(v,y,w),3572445317,a(c,S+12),16),e(r(v,y,w),76029189,a(c,S+24),23),e(r(v,y,w),3654602809,a(c,S+36),4),e(r(v,y,w),3873151461,a(c,S+48),11),e(r(v,y,w),530742520,a(c,S+60),16),e(r(v,y,w),3299628645,a(c,S+8),23),e(s(v,y,w),4096336452,a(c,S),6),e(s(v,y,w),1126891415,a(c,S+28),10),e(s(v,y,w),2878612391,a(c,S+56),15),e(s(v,y,w),4237533241,a(c,S+20),21),e(s(v,y,w),1700485571,a(c,S+48),6),e(s(v,y,w),2399980690,a(c,S+12),10),e(s(v,y,w),4293915773,a(c,S+40),15),e(s(v,y,w),2240044497,a(c,S+4),21),e(s(v,y,w),1873313359,a(c,S+32),6),e(s(v,y,w),4264355552,a(c,S+60),10),e(s(v,y,w),2734768916,a(c,S+24),15),e(s(v,y,w),1309151649,a(c,S+52),21),e(s(v,y,w),4149444226,a(c,S+16),6),e(s(v,y,w),3174756917,a(c,S+44),10),e(s(v,y,w),718787259,a(c,S+8),15),e(s(v,y,w),3951481745,a(c,S+36),21),h=d(h,g),f=d(f,v),p=d(p,y),m=d(m,w)}return function(e,n,i,r){for(var s="",a=0,o=0,l=3;l>=0;l--)a=255&(o=arguments[l]),a<<=8,a|=255&(o>>>=8),a<<=8,a|=255&(o>>>=8),a<<=8,s+=t(a|=o>>>=8);return s}(m,p,f,h).toUpperCase()}()};var W=function(e){return $.MD5(e)},z=0;function q(e){return Y(G(H(e)))}function G(e){return X(K(Z(e),8*e.length))}function Y(e){for(var t,n=z?"0123456789ABCDEF":"0123456789abcdef",i="",r=0;r<e.length;r++)t=e.charCodeAt(r),i+=n.charAt(t>>>4&15)+n.charAt(15&t);return i}function H(e){for(var t,n,i="",r=-1;++r<e.length;)t=e.charCodeAt(r),n=r+1<e.length?e.charCodeAt(r+1):0,55296<=t&&t<=56319&&56320<=n&&n<=57343&&(t=65536+((1023&t)<<10)+(1023&n),r++),t<=127?i+=String.fromCharCode(t):t<=2047?i+=String.fromCharCode(192|t>>>6&31,128|63&t):t<=65535?i+=String.fromCharCode(224|t>>>12&15,128|t>>>6&63,128|63&t):t<=2097151&&(i+=String.fromCharCode(240|t>>>18&7,128|t>>>12&63,128|t>>>6&63,128|63&t));return i}function Z(e){for(var t=Array(e.length>>2),n=0;n<t.length;n++)t[n]=0;for(n=0;n<8*e.length;n+=8)t[n>>5]|=(255&e.charCodeAt(n/8))<<24-n%32;return t}function X(e){for(var t="",n=0;n<32*e.length;n+=8)t+=String.fromCharCode(e[n>>5]>>>24-n%32&255);return t}function K(e,t){e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;for(var n=Array(80),i=1732584193,r=-271733879,s=-1732584194,a=271733878,o=-1009589776,l=0;l<e.length;l+=16){for(var c=i,u=r,d=s,h=a,f=o,p=0;p<80;p++){n[p]=p<16?e[l+p]:te(n[p-3]^n[p-8]^n[p-14]^n[p-16],1);var m=ee(ee(te(i,5),J(p,r,s,a)),ee(ee(o,n[p]),Q(p)));o=a,a=s,s=te(r,30),r=i,i=m}i=ee(i,c),r=ee(r,u),s=ee(s,d),a=ee(a,h),o=ee(o,f)}return Array(i,r,s,a,o)}function J(e,t,n,i){return e<20?t&n|~t&i:e<40?t^n^i:e<60?t&n|t&i|n&i:t^n^i}function Q(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514}function ee(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}function te(e,t){return e<<t|e>>>32-t}var ne=q,ie=function(e){var t=e.wsURL,n=e.rtspURL,r=e.sourceId,s=null,a=e.isPlayback||!1,o=e.isTalkService||!1,l=e.isDownloadService,c=e.realm,u=6,d=null,h=null,f=0,p=0,m='Authorization: WSSE profile="UsernameToken"',g=null,v=!1,y=e.playsdk,w={OK:200,UNAUTHORIZED:401,NOTFOUND:404,INVALID_RANGE:457,NOTSERVICE:503,DISCONNECT:999},S=1e4,b=3,T=[],C=0,_=null,P={},A="UnAuthorized",R=null,x="",I=null,E={},D=null,M={},U={PLAY:0,PAUSE:1,KEEP_LIVE:2,STOP:3,SCALE:4},k=0,L=null,N="play",O=null;function F(){}function B(){G($("TEARDOWN")),clearInterval(I),I=null,null!==s&&(s.onerror=null),null!==s&&s.readyState===WebSocket.OPEN&&(s.close(),s=null),y&&y.Stop()}function V(e,t){var n=e.split("#")[0];if(n){var i=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),r=n.match(i);if(null!==r)return unescape(r[2])}return null}function $(e,s,l,u){var d="",h="",f=W(M.username+":"+c+":"+M.password),p=t.split("://")[1].split("/")[0].split(":")[0]+":8086";if(a)var v=V(r,"beginTime"),y=V(r,"endTime"),w=v?v.replace(/-|:|\s/g,"_"):"",S=y?y.replace(/-|:|\s/g,"_"):"";var b=r&&r.replace(/&beginTime=\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}&endTime=\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}/,"");switch(e){case 0:var T=function(){for(var e=[],t=0;t<32;t++)e.push(String.fromCharCode(256*Math.random()|0));return W(e.join(""))}(),_=function(){var e=new Date,t=e.getTimezoneOffset(),n=e.getTime()+60*t*1e3,i=new Date(n),r=i.getFullYear(),s=i.getMonth()+1,a=i.getDate(),o=i.getHours(),l=i.getMinutes(),c=i.getSeconds(),u=function(e){return e<10?"0"+e:e};return r+"-"+u(s)+"-"+u(a)+"T"+u(o)+":"+u(l)+":"+u(c)+"Z"}(),P=function(e){for(var t,n,i,r,s,a,o,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="",u=0;u<e.length;)t=e[u++],n=e[u++],i=e[u++],r=t>>2,s=(3&t)<<4|n>>4,a=(15&n)<<2|i>>6,o=63&i,isNaN(n)?a=o=64:isNaN(i)&&(o=64),c=c+l.charAt(r)+l.charAt(s)+l.charAt(a)+l.charAt(o);return c}(function(e){var t,n=e.trim(),i="0x"===n.substr(0,2).toLowerCase()?n.substr(2):n,r=i.length;if(r%2!==0)return"";for(var s=[],a=0;a<r;a+=2)t=parseInt(i.substr(a,2),16),s.push(t);return s}(ne(T+_+f.toUpperCase())));d="GET "+n+(a?"&starttime=".concat(w,"&endtime=").concat(S,"&"):"&")+"method="+e+"?sourceId="+b+" HTTP/1.1\r\n",d+="Accept-Sdp: Private\r\n",d+=g+"\r\n",d+="Connection: keep-alive\r\nCseq: "+C+"\r\nHost: "+p+"\r\n",u?d+="Range: npt="+u+"-\r\n":"ContinuePlay"!==A&&(d+="Range: npt=0.000000-\r\n"),!0===o&&(h+="v=0\r\n",h+="o=- 2208989105 2208989105 IN IP4 0.0.0.0\r\n",h+="s=Media Server\r\n",h+="c=IN IP4 0.0.0.0\r\n",h+="t=0 0\r\n",h+="a=control:*\r\n",h+="a=packetization-supported:DH\r\n",h+="a=rtppayload-supported:DH\r\n",h+="a=range:npt=now-\r\n",h+="m=audio 0 RTP/AVP 8\r\n",h+="a=control:trackID=5\r\n",h+="a=rtpmap:8 PCMA/16000\r\n",d+="Private-Length: "+(h+="a=sendonly\r\n").length+"\r\n",d+="Private-Type: application/sdp\r\n"),d+=g===m?'WSSE: UsernameToken Username="'+M.username+'", PasswordDigest="'+P+'", Nonce="'+T+'", Created="'+_+'"\r\n\r\n':"\r\n",d+=h;break;case 1:d="GET "+n+(a?"&starttime=".concat(w,"&endtime=").concat(S,"&"):"&")+"method="+e+"?sourceId="+b+" HTTP/1.1\r\n",d+="Connection: keep-alive\r\nCseq: "+C+"\r\nHost: "+p+"\r\n\r\n";break;case 2:case 3:d="GET "+n+(a?"&starttime=".concat(w,"&endtime=").concat(S,"&"):"&")+"method="+e+"?sourceId="+b+" HTTP/1.1\r\n",d+="Connection: keep-alive\r\nCseq: "+C+"\r\nHost: "+p+"\r\n\r\n";break;case 4:d="GET "+n+(a?"&starttime=".concat(w,"&endtime=").concat(S,"&"):"&")+"method=0?sourceId="+b+" HTTP/1.1\r\n",d+=u<8?"Speed: "+u+"\r\n":"Scale: "+u+"\r\n",d+="Connection: keep-alive\r\nCseq: "+C+"\r\nHost: "+p+"\r\n\r\n"}return i.h.log(d),d}function z(e){i.h.log(e);var t,r=e.search("Cseq: ")+5;if(C=parseInt(e.slice(r,r+10))+1,(t=function(e){var t={},n=0,i=0,r=null,s=null;if(-1!==e.search("Content-Type: application/sdp")){var a=e.split("\r\n\r\n");s=a[0]}else s=e;var o=s.split("\r\n"),l=o[0].split(" ");if(l.length>2&&(t.ResponseCode=parseInt(l[1]),t.ResponseMessage=l[2]),t.ResponseCode===w.OK){for(n=1;n<o.length;n++)if("Public"===(r=o[n].split(":"))[0])t.MethodsSupported=r[1].split(",");else if("Cseq"===r[0])t.Cseq=parseInt(r[1]);else if("Content-Type"===r[0])t.ContentType=r[1],-1!==t.ContentType.search("application/sdp")&&(t.SDPData=Z(e));else if("Content-Length"===r[0])t.ContentLength=parseInt(r[1]);else if("Content-Base"===r[0]){var c=o[n].search("Content-Base:");-1!==c&&(t.ContentBase=o[n].substr(c+13))}else if("Session"===r[0]){var u=r[1].split(";");t.SessionID=parseInt(u[0])}else if("Transport"===r[0]){var d=r[1].split(";");for(i=0;i<d.length;i++){var h=d[i].search("interleaved=");if(-1!==h){var f=d[i].substr(h+12),p=f.split("-");p.length>1&&(t.RtpInterlevedID=parseInt(p[0]),t.RtcpInterlevedID=parseInt(p[1]))}}}else if("RTP-Info"===r[0]){r[1]=o[n].substr(9);var m=r[1].split(",");for(t.RTPInfoList=[],i=0;i<m.length;i++){var g=m[i].split(";"),v={},y=0;for(y=0;y<g.length;y++){var S=g[y].search("url=");-1!==S&&(v.URL=g[y].substr(S+4)),-1!==(S=g[y].search("seq="))&&(v.Seq=parseInt(g[y].substr(S+4)))}t.RTPInfoList.push(v)}}}else if(t.ResponseCode===w.UNAUTHORIZED)for(n=1;n<o.length;n++)if("Cseq"===(r=o[n].split(":"))[0])t.Cseq=parseInt(r[1]);else if("WWW-Authenticate"===r[0]){var b=r[1].split(",");for(i=0;i<b.length;i++){var T=b[i].search("Digest realm=");if(-1!==T){var C=b[i].substr(T+13).split('"');t.Realm=C[1]}if(-1!==(T=b[i].search("nonce="))){var _=b[i].substr(T+6).split('"');t.Nonce=_[1]}}}return t}(e)).ResponseCode===w.UNAUTHORIZED&&g===m)!function(e){var t=M.username,i=M.passWord,r={Method:null,Realm:null,Nonce:null,Uri:null},s=null;r={Method:A.toUpperCase(),Realm:e.Realm,Nonce:e.Nonce,Uri:n},s=function(e,t,n,i,r,s){var a=null,o=null;return a=W(e+":"+i+":"+t).toLowerCase(),o=W(s+":"+n).toLowerCase(),W(a+":"+r+":"+o).toLowerCase()}(t,i,r.Uri,r.Realm,r.Nonce,r.Method),g='Authorization: Digest username="'+t+'", realm="'+r.Realm+'",',g+=' nonce="'+r.Nonce+'", uri="'+r.Uri+'", response="'+s+'"',G($(U.PLAY))}(t);else if(t.ResponseCode===w.OK)if("UnAuthorized"===A){P=Z(e),"undefined"!==typeof t.ContentBase&&(P.ContentBase=t.ContentBase);var a=0;for(a=0;a<P.Sessions.length;a+=1){var c={};"JPEG"===P.Sessions[a].CodecMime||"H264"===P.Sessions[a].CodecMime||"H265"===P.Sessions[a].CodecMime||"H264-SVC"==P.Sessions[a].CodecMime||"RAW"==P.Sessions[a].CodecMime?(c.codecName=P.Sessions[a].CodecMime,"H264-SVC"===P.Sessions[a].CodecMime&&(c.codecName="H264"),"H265"!==P.Sessions[a].CodecMime&&"RAW"!==P.Sessions[a].CodecMime||F.prototype.setLiveMode("canvas"),c.trackID=P.Sessions[a].ControlURL,c.ClockFreq=P.Sessions[a].ClockFreq,c.Port=parseInt(P.Sessions[a].Port),"undefined"!==typeof P.Sessions[a].Framerate&&(c.Framerate=parseInt(P.Sessions[a].Framerate),D(c.Framerate)),T.push(c)):"PCMU"===P.Sessions[a].CodecMime||-1!==P.Sessions[a].CodecMime.search("G726-16")||-1!==P.Sessions[a].CodecMime.search("G726-24")||-1!==P.Sessions[a].CodecMime.search("G726-32")||-1!==P.Sessions[a].CodecMime.search("G726-40")||"PCMA"===P.Sessions[a].CodecMime||-1!==P.Sessions[a].CodecMime.search("G723.1")||-1!==P.Sessions[a].CodecMime.search("G729")||-1!==P.Sessions[a].CodecMime.search("MPA")||-1!==P.Sessions[a].CodecMime.search("L16")?("PCMU"===P.Sessions[a].CodecMime?c.codecName="G.711Mu":"G726-16"===P.Sessions[a].CodecMime?c.codecName="G.726-16":"G726-24"===P.Sessions[a].CodecMime?c.codecName="G.726-24":"G726-32"===P.Sessions[a].CodecMime?c.codecName="G.726-32":"G726-40"===P.Sessions[a].CodecMime?c.codecName="G.726-40":"PCMA"===P.Sessions[a].CodecMime?c.codecName="G.711A":"G723.1"===P.Sessions[a].CodecMime?c.codecName="G.723":"G729"===P.Sessions[a].CodecMime?c.codecName="G.729":"MPA"===P.Sessions[a].CodecMime?c.codecName="mpeg2":"L16"===P.Sessions[a].CodecMime&&(c.codecName="PCM"),c.trackID=P.Sessions[a].ControlURL,c.ClockFreq=P.Sessions[a].ClockFreq,c.Port=parseInt(P.Sessions[a].Port),c.Bitrate=parseInt(P.Sessions[a].Bitrate),c.TalkTransType=P.Sessions[a].TalkTransType,T.push(c)):"mpeg4-generic"===P.Sessions[a].CodecMime||"MPEG4-GENERIC"===P.Sessions[a].CodecMime?(c.codecName="mpeg4-generic",c.trackID=P.Sessions[a].ControlURL,c.ClockFreq=P.Sessions[a].ClockFreq,c.Port=parseInt(P.Sessions[a].Port),c.Bitrate=parseInt(P.Sessions[a].Bitrate),c.TalkTransType=P.Sessions[a].TalkTransType,T.push(c)):"vnd.onvif.metadata"===P.Sessions[a].CodecMime?(c.codecName="MetaData",c.trackID=P.Sessions[a].ControlURL,c.ClockFreq=P.Sessions[a].ClockFreq,c.Port=parseInt(P.Sessions[a].Port),T.push(c)):"stream-assist-frame"===P.Sessions[a].CodecMime?(c.codecName="stream-assist-frame",c.trackID=P.Sessions[a].ControlURL,c.ClockFreq=P.Sessions[a].ClockFreq,c.Port=parseInt(P.Sessions[a].Port),T.push(c)):("audio"===P.Sessions[a].Type&&_({errorCode:201,description:"Audio format not supported"}),i.h.log("Unknown codec type:",P.Sessions[a].CodecMime,P.Sessions[a].ControlURL))}for(var u=0;u<T.length;u++)T[u].RtpInterlevedID=2*(T[u].trackID.split("=")[1]-0);o&&(y.setCallback("audioTalk",q),y.talkInit(T,E)),R=0,clearInterval(I),I=setInterval((function(){return"GET_PARAMETER"===N&&"PAUSE"!=A?k++:k=0,k===b&&(s.fileOver=!0,l&&(l=!1,y.StopRecord()),B(),_({errorCode:"999",description:"no rtsv response"})),G($(U.KEEP_LIVE))}),S),A="Playing"}else"ContinuePlay"===A?A="Playing":"Playing"===A||i.h.log("unknown rtsp state:"+A);else if(t.ResponseCode===w.NOTSERVICE){if("Setup"===A&&-1!==T[R].trackID.search("trackID=t"))return T[R].RtpInterlevedID=-1,T[R].RtcpInterlevedID=-1,R+=1,o=!1,_({errorCode:"504",description:"Talk Service Unavilable",place:"RtspClient.js"}),R<T.length?$("SETUP",T[R].trackID):(A="Play",$("PLAY"));_({errorCode:"503",description:"Service Unavilable"})}else if(t.ResponseCode===w.NOTFOUND){if("Describe"===A||"Options"===A)return void _({errorCode:404,description:"rtsp not found"})}else if(t.ResponseCode===w.INVALID_RANGE)return"backup"!==x&&"playback"!==x||_({errorCode:"457",description:"Invalid range"}),void i.h.log("RTP disconnection detect!!!")}function q(e){!0===o&&function(e){null!==s&&s.readyState===WebSocket.OPEN?s.send(e):i.h.log("SendRtpData - Websocket does not exist")}(e)}function G(e){void 0!=e&&null!=e&&""!=e&&(null!==s&&s.readyState===WebSocket.OPEN?void 0!=e&&s.send(Y(e)):i.h.log("ws未连接"))}function Y(e){for(var t=e.length,n=new Uint8Array(new ArrayBuffer(t)),i=0;i<t;i++)n[i]=e.charCodeAt(i);return n}function H(e){var t=new Uint8Array,n=new Uint8Array(e.data);for((t=new Uint8Array(n.length)).set(n,0),f=t.length;f>0;)if(36!==t[0]){var i=String.fromCharCode.apply(null,t),r=null;-1===i.indexOf("OffLine: File Over")&&-1===i.indexOf("OffLine:File Over")&&-1===i.indexOf("OffLine:Internal Error")||(s.fileOver=!0,l&&(l=!1,y.StopRecord(),B())),-1===i.indexOf("OffLine:File Over")&&-1===i.indexOf("OffLine: File Over")||O&&O(),-1!==i.indexOf("OffLine:Internal Error")&&_({errorCode:500,description:"Internal Error"}),-1!==i.indexOf("OffLine:KmsUnavailable")&&_({errorCode:203,description:"KmsUnavailable"}),!1===v&&-1!==i.indexOf("200 OK")?(r=i.lastIndexOf("\r\n"),v=!0):r=i.search("\r\n\r\n");var a=i.search("HTTP");if(-1===a)return void(t=new Uint8Array);if(-1===r)return void(f=t.length);d=t.subarray(a,r+u),t=t.subarray(r+u);var o=String.fromCharCode.apply(null,d);G(z(o)),f=t.length}else{if(N="PLAY",clearTimeout(L),L=setTimeout((function(){N="GET_PARAMETER"}),1e4),h=t.subarray(0,u),!((p=h[2]<<24|h[3]<<16|h[4]<<8|h[5])+u<=t.length))return void(f=t.length);var c=t.subarray(u,p+u);j(h,c),t=t.subarray(p+u),f=t.length}}function j(e,t){y.InputData(e,t)}function Z(e){var t={Sessions:[]},n=(-1!==e.search("Private-Type: application/sdp")?e.split("\r\n\r\n")[1]:e).split("\r\n"),i=0,r=!1;for(i=0;i<n.length;i++){var s=n[i].split("=");if(s.length>0)switch(s[0]){case"a":var a=s[1].split(":");if(a.length>1){if("control"===a[0]){var l=n[i].search("control:");!0===r?-1!==l&&(t.Sessions[t.Sessions.length-1].ControlURL=n[i].substr(l+8)):-1!==l&&(t.BaseURL=n[i].substr(l+8))}else if("rtpmap"===a[0]){var c=a[1].split(" ");t.Sessions[t.Sessions.length-1].PayloadType=c[0];var u=c[1].split("/");t.Sessions[t.Sessions.length-1].CodecMime=u[0],u.length>1&&(t.Sessions[t.Sessions.length-1].ClockFreq=u[1])}else if("framesize"===a[0]){var d=a[1].split(" ");if(d.length>1){var h=d[1].split("-");t.Sessions[t.Sessions.length-1].Width=h[0],t.Sessions[t.Sessions.length-1].Height=h[1]}}else if("framerate"===a[0])t.Sessions[t.Sessions.length-1].Framerate=a[1];else if("fmtp"===a[0]){var f=n[i].split(" ");if(f.length<2)continue;for(var p=1;p<f.length;p++){var m=f[p].split(";"),g=0;for(g=0;g<m.length;g++){var v=m[g].search("mode=");if(-1!==v&&(t.Sessions[t.Sessions.length-1].mode=m[g].substr(v+5)),-1!==(v=m[g].search("config="))&&(t.Sessions[t.Sessions.length-1].config=m[g].substr(v+7),E.config=t.Sessions[t.Sessions.length-1].config,E.clockFreq=t.Sessions[t.Sessions.length-1].ClockFreq,E.bitrate=t.Sessions[t.Sessions.length-1].Bitrate),-1!==(v=m[g].search("sprop-vps="))&&(t.Sessions[t.Sessions.length-1].VPS=m[g].substr(v+10)),-1!==(v=m[g].search("sprop-sps="))&&(t.Sessions[t.Sessions.length-1].SPS=m[g].substr(v+10)),-1!==(v=m[g].search("sprop-pps="))&&(t.Sessions[t.Sessions.length-1].PPS=m[g].substr(v+10)),-1!==(v=m[g].search("sprop-parameter-sets="))){var y=m[g].substr(v+21).split(",");y.length>1&&(t.Sessions[t.Sessions.length-1].SPS=y[0],t.Sessions[t.Sessions.length-1].PPS=y[1])}}}}}else 1===a.length&&("recvonly"===a[0]?t.Sessions[t.Sessions.length-1].TalkTransType="recvonly":"sendonly"===a[0]&&(t.Sessions[t.Sessions.length-1].TalkTransType="sendonly"));break;case"m":var w=s[1].split(" "),S={};S.Type=w[0],S.Port=w[1],S.Payload=w[3],t.Sessions.push(S),r=!0;break;case"b":if(!0===r){var b=s[1].split(":");t.Sessions[t.Sessions.length-1].Bitrate=b[1]}}}if(!0===o)for(var T=0;T<t.Sessions.length;T+=1)"1"!==t.Sessions[T].ControlURL.split("=")[1]&&"2"!==t.Sessions[T].ControlURL.split("=")[1]||t.Sessions.splice(T,1);return t}function G(e){void 0!=e&&null!=e&&""!=e&&(s&&s.readyState===WebSocket.OPEN?void 0!=e&&s.send(Y(e)):i.h.log("ws未连接"))}return F.prototype={connect:function(){s||(console.log("---------start create websocket-----------"),(s=new WebSocket(t)).binaryType="arraybuffer",s.fileOver=!1,s.addEventListener("message",H,!1),s.onopen=function(){g=m,G($(U.PLAY))},s.onerror=function(e){_({errorCode:202,description:"Open WebSocket Error"})},s.onclose=function(e){s&&!s.fileOver&&_({errorCode:202,description:"Open WebSocket Error"})})},disconnect:function(){G($(U.STOP)),clearInterval(I),I=null,null!==s&&(s.onerror=null),null!==s&&s.readyState===WebSocket.OPEN&&(s.close(),s=null),y&&y.Stop()},controlPlayer:function(e){var t="";switch(e.command,e.command){case"PLAY":if(A="Play",null!=e.range){t=$(U.PLAY,0,0,e.range);break}t=$(U.PLAY);break;case"PAUSE":if("PAUSE"===A)break;A="PAUSE",t=$(U.PAUSE);break;case"SCALE":t=$(U.SCALE,0,0,e.data),y&&y.SetPlaySpeed(e.data);break;case"TEARDOWN":t=$(U.STOP),y&&y.Stop();break;case"audioPlay":case"volumn":case"audioSamplingRate":y&&y.setVolume(e.data);break;default:i.h.log("未知指令: "+e.command)}""!=t&&G(t)},setLiveMode:function(e){},setPlayMode:function(e){},setRTSPURL:function(e){n=e},setCallback:function(e,t){"GetFrameRate"===e?D=t:y.setCallback(e,t),"FileOver"==e&&(O=t),"Error"==e&&(_=t)},setUserInfo:function(e,t){M.username=e,M.passWord=t},capture:function(e,t){y.capture(e,t)},setLessRate:function(e){},setFrameData:function(e,t,n,i,r,s,a){y.setFrameData(e,t,n,i,r,s,a)}},new F},re=function(e){var t=e.wsURL,n=null,r=e.isTalkService,s=e.isDownloadService,a=6,o=null,l=null,c=0,u=0,d=!1,h=!1,f=e.playsdk,p={OK:200,UNAUTHORIZED:401,NOTFOUND:404,INVALID_RANGE:457,NOTSERVICE:503,DISCONNECT:999},m=1e4,g=3,v="",y=[],w=1,S=null,b={},T="Options",C=null,_=null,P="",A=null,R={},x=e.rtspURL,I=null,E={},D=0,M=null,U="play",k=null;function L(){}function N(){V(O("TEARDOWN",null)),clearInterval(A),A=null,null!==n&&(n.onerror=null),null!==n&&n.readyState===WebSocket.OPEN&&(n.close(),n=null,_=null),f&&f.Stop()}function O(e,t,n,s){var a="";switch(e){case"OPTIONS":case"TEARDOWN":case"GET_PARAMETER":case"SET_PARAMETERS":a=e+" "+x+" RTSP/1.0\r\nCSeq: "+w+"\r\n"+v+"\r\n";break;case"DESCRIBE":a=e+" "+x+" RTSP/1.0\r\nCSeq: "+w,!0===r&&(a+="\r\nRequire: www.onvif.org/ver20/backchannel"),a=a+"\r\n"+v+"\r\n";break;case"SETUP":i.h.log("trackID: "+t),a=e+" "+x+"/trackID="+t+" RTSP/1.0\r\nCSeq: "+w+"\r\n"+v+"Transport: DH/AVP/TCP;unicast;interleaved="+2*t+"-"+(2*t+1)+"\r\n",a+=0!=_?"Session: "+_+"\r\n\r\n":"\r\n";break;case"PLAY":a=e+" "+x+" RTSP/1.0\r\nCSeq: "+w+"\r\nSession: "+_+"\r\n",void 0!=s&&0!=s?(a+="Range: npt="+s+"-\r\n",a+=v+"\r\n"):a+=v+"\r\n";break;case"PAUSE":a=e+" "+x+" RTSP/1.0\r\nCSeq: "+w+"\r\nSession: "+_+"\r\n\r\n";break;case"SCALE":a="PLAY "+x+" RTSP/1.0\r\nCSeq: "+w+"\r\nSession: "+_+"\r\n",a+=s<8?"Speed: "+s+"\r\n":"Scale: "+s+"\r\n",a+=v+"\r\n"}return i.h.log(a),a}function F(e){i.h.log(e);var t,a=e.search("CSeq: ")+5;if(w=parseInt(e.slice(a,a+10))+1,(t=function(e){var t={},n=0,i=0,r=null,s=null;if(-1!==e.search("Content-Type: application/sdp")){var a=e.split("\r\n\r\n");s=a[0]}else s=e;var o=s.split("\r\n"),l=o[0].split(" ");if(l.length>2&&(t.ResponseCode=parseInt(l[1]),t.ResponseMessage=l[2]),t.ResponseCode===p.OK){for(n=1;n<o.length;n++)if("Public"===(r=o[n].split(":"))[0])t.MethodsSupported=r[1].split(",");else if("CSeq"===r[0])t.CSeq=parseInt(r[1]);else if("Content-Type"===r[0])t.ContentType=r[1],-1!==t.ContentType.search("application/sdp")&&(t.SDPData=G(e));else if("Content-Length"===r[0])t.ContentLength=parseInt(r[1]);else if("Content-Base"===r[0]){var c=o[n].search("Content-Base:");-1!==c&&(t.ContentBase=o[n].substr(c+13))}else if("Session"===r[0]){var u=r[1].split(";");t.SessionID=parseInt(u[0])}else if("Transport"===r[0]){var d=r[1].split(";");for(i=0;i<d.length;i++){var h=d[i].search("interleaved=");if(-1!==h){var f=d[i].substr(h+12),m=f.split("-");m.length>1&&(t.RtpInterlevedID=parseInt(m[0]),t.RtcpInterlevedID=parseInt(m[1]))}}}else if("RTP-Info"===r[0]){r[1]=o[n].substr(9);var g=r[1].split(",");for(t.RTPInfoList=[],i=0;i<g.length;i++){var v=g[i].split(";"),y={},w=0;for(w=0;w<v.length;w++){var S=v[w].search("url=");-1!==S&&(y.URL=v[w].substr(S+4)),-1!==(S=v[w].search("seq="))&&(y.Seq=parseInt(v[w].substr(S+4)))}t.RTPInfoList.push(y)}}}else if(t.ResponseCode===p.UNAUTHORIZED)for(n=1;n<o.length;n++)if("CSeq"===(r=o[n].split(":"))[0])t.CSeq=parseInt(r[1]);else if("WWW-Authenticate"===r[0]){var b=r[1].split(",");for(i=0;i<b.length;i++){var T=b[i].search("Digest realm=");if(-1!==T){var C=b[i].substr(T+13).split('"');t.Realm=C[1]}if(-1!==(T=b[i].search("nonce="))){var _=b[i].substr(T+6).split('"');t.Nonce=_[1]}}}return t}(e)).ResponseCode===p.UNAUTHORIZED&&""===v)!function(e){var t=E.username,n=E.passWord,i={Method:null,Realm:null,Nonce:null,Uri:null},r=null;i={Method:T.toUpperCase(),Realm:e.Realm,Nonce:e.Nonce,Uri:x},r=function(e,t,n,i,r,s){var a=null,o=null;return a=W(e+":"+i+":"+t).toLowerCase(),o=W(s+":"+n).toLowerCase(),W(a+":"+r+":"+o).toLowerCase()}(t,n,i.Uri,i.Realm,i.Nonce,i.Method),v='Authorization: Digest username="'+t+'", realm="'+i.Realm+'",',v+=' nonce="'+i.Nonce+'", uri="'+i.Uri+'", response="'+r+'"',v+="\r\n",V(O("OPTIONS",null))}(t);else if(t.ResponseCode===p.OK){if("Options"===T)return T="Describe",O("DESCRIBE",null);if("Describe"===T){b=G(e),"undefined"!==typeof t.ContentBase&&(b.ContentBase=t.ContentBase);var o=0;for(o=0;o<b.Sessions.length;o+=1){var l={};"JPEG"===b.Sessions[o].CodecMime||"H264"===b.Sessions[o].CodecMime||"H265"===b.Sessions[o].CodecMime||"H264-SVC"==b.Sessions[o].CodecMime?(l.codecName=b.Sessions[o].CodecMime,"H264-SVC"==b.Sessions[o].CodecMime&&(l.codecName="H264"),"H265"==b.Sessions[o].CodecMime&&L.prototype.setLiveMode("canvas"),l.trackID=b.Sessions[o].ControlURL,l.ClockFreq=b.Sessions[o].ClockFreq,l.Port=parseInt(b.Sessions[o].Port),"undefined"!==typeof b.Sessions[o].Framerate&&(l.Framerate=parseInt(b.Sessions[o].Framerate),I(l.Framerate)),y.push(l)):"PCMU"===b.Sessions[o].CodecMime||-1!==b.Sessions[o].CodecMime.search("G726-16")||-1!==b.Sessions[o].CodecMime.search("G726-24")||-1!==b.Sessions[o].CodecMime.search("G726-32")||-1!==b.Sessions[o].CodecMime.search("G726-40")||"PCMA"===b.Sessions[o].CodecMime?("PCMU"===b.Sessions[o].CodecMime?l.codecName="G.711Mu":"G726-16"===b.Sessions[o].CodecMime?l.codecName="G.726-16":"G726-24"===b.Sessions[o].CodecMime?l.codecName="G.726-24":"G726-32"===b.Sessions[o].CodecMime?l.codecName="G.726-32":"G726-40"===b.Sessions[o].CodecMime?l.codecName="G.726-40":"PCMA"===b.Sessions[o].CodecMime&&(l.codecName="G.711A"),l.trackID=b.Sessions[o].ControlURL,l.ClockFreq=b.Sessions[o].ClockFreq,l.Port=parseInt(b.Sessions[o].Port),l.Bitrate=parseInt(b.Sessions[o].Bitrate),l.TalkTransType=b.Sessions[o].TalkTransType,y.push(l)):"mpeg4-generic"===b.Sessions[o].CodecMime||"MPEG4-GENERIC"===b.Sessions[o].CodecMime?(l.codecName="mpeg4-generic",l.trackID=b.Sessions[o].ControlURL,l.ClockFreq=b.Sessions[o].ClockFreq,l.Port=parseInt(b.Sessions[o].Port),l.Bitrate=parseInt(b.Sessions[o].Bitrate),l.TalkTransType=b.Sessions[o].TalkTransType,y.push(l)):"vnd.onvif.metadata"===b.Sessions[o].CodecMime?(l.codecName="MetaData",l.trackID=b.Sessions[o].ControlURL,l.ClockFreq=b.Sessions[o].ClockFreq,l.Port=parseInt(b.Sessions[o].Port),y.push(l)):"stream-assist-frame"===b.Sessions[o].CodecMime?(l.codecName="stream-assist-frame",l.trackID=b.Sessions[o].ControlURL,l.ClockFreq=b.Sessions[o].ClockFreq,l.Port=parseInt(b.Sessions[o].Port),y.push(l)):("audio"===b.Sessions[o].Type&&S({errorCode:201,description:"Audio format not supported"}),i.h.log("Unknown codec type:",b.Sessions[o].CodecMime,b.Sessions[o].ControlURL))}return!1===r?void S({errorCode:404,description:"rtsp not found"}):(C=0,T="Setup",i.h.log(y),O("SETUP",y[C].trackID.split("=")[1]-0))}if("Setup"===T){if(_=t.SessionID,C<y.length)return y[C].RtpInterlevedID=t.RtpInterlevedID,y[C].RtcpInterlevedID=t.RtcpInterlevedID,(C+=1)!==y.length?O("SETUP",y[C].trackID.split("=")[1]-0):(r&&(f.setCallback("audioTalk",B),f.talkInit(y,R)),T="Play",O("PLAY",null));if(r)return f.setCallback("audioTalk",B),f.talkInit(y,R),T="Play",O("PLAY",null);i.h.log("Unknown setup SDP index")}else"Play"===T?(_=t.SessionID,clearInterval(A),A=setInterval((function(){return"GET_PARAMETER"===U&&"PAUSE"!=T?D++:D=0,D===g&&(n.fileOver=!0,s&&(s=!1,f.StopRecord()),N(),S({errorCode:"999",description:"no rtsp response"})),V(O("GET_PARAMETER",null))}),m),D=0,T="Playing"):"Playing"===T||i.h.log("unknown rtsp state:"+T)}else if(t.ResponseCode===p.NOTSERVICE){if("Setup"===T&&"sendonly"===y[C].TalkTransType)return y[C].RtpInterlevedID=-1,y[C].RtcpInterlevedID=-1,C+=1,r=!1,S({errorCode:"504",description:"Talk Service Unavilable",place:"RtspClient.js"}),C<y.length?O("SETUP",y[C].trackID):(T="Play",O("PLAY",null));S({errorCode:"503",description:"Service Unavilable"})}else if(t.ResponseCode===p.NOTFOUND){if("Describe"===T||"Options"===T)return void S({errorCode:404,description:"rtsp not found"})}else if(t.ResponseCode===p.INVALID_RANGE)return"backup"!==P&&"playback"!==P||S({errorCode:"457",description:"Invalid range"}),void i.h.log("RTP disconnection detect!!!")}function B(e){!0===r&&function(e){null!==n&&n.readyState===WebSocket.OPEN?n.send(e):i.h.log("SendRtpData - Websocket does not exist")}(e)}function V(e){void 0!=e&&null!=e&&""!=e&&(null!==n&&n.readyState===WebSocket.OPEN?(!1===h&&-1!==e.search("DESCRIBE")&&(d=!0,h=!0),void 0!=e&&n.send($(e))):i.h.log("ws未连接"))}function $(e){for(var t=e.length,n=new Uint8Array(new ArrayBuffer(t)),i=0;i<t;i++)n[i]=e.charCodeAt(i);return n}function z(e){var t=new Uint8Array,i=new Uint8Array(e.data);for((t=new Uint8Array(i.length)).set(i,0),c=t.length;c>0;)if(36!==t[0]){var r=String.fromCharCode.apply(null,t),h=null;-1===r.indexOf("OffLine:File Over")&&-1===r.indexOf("OffLine: File Over")&&-1===r.indexOf("OffLine:Internal Error")||(n.fileOver=!0,s&&(s=!1,f.StopRecord()),N()),-1===r.indexOf("OffLine:File Over")&&-1===r.indexOf("OffLine: File Over")||k&&k(),-1!==r.indexOf("OffLine:Internal Error")&&S({errorCode:500,description:"Internal Error"}),-1!==r.indexOf("OffLine:KmsUnavailable")&&S({errorCode:203,description:"KmsUnavailable"}),!0===d?(h=r.lastIndexOf("\r\n"),d=!1):h=r.search("\r\n\r\n");var p=r.search("RTSP");if(-1===p)return void(t=new Uint8Array);if(-1===h)return void(c=t.length);o=t.subarray(p,h+a),t=t.subarray(h+a),V(F(String.fromCharCode.apply(null,o))),c=t.length}else{if(U="PLAY",clearTimeout(M),M=setTimeout((function(){U="GET_PARAMETER"}),1e4),l=t.subarray(0,a),!((u=l[2]<<24|l[3]<<16|l[4]<<8|l[5])+a<=t.length))return void(c=t.length);var m=t.subarray(a,u+a);q(l,m),t=t.subarray(u+a),c=t.length}}function q(e,t){f.InputData(e,t)}function G(e){var t={Sessions:[]},n=(-1!==e.search("Content-Type: application/sdp")?e.split("\r\n\r\n")[1]:e).split("\r\n"),i=0,r=!1;for(i=0;i<n.length;i++){var s=n[i].split("=");if(s.length>0)switch(s[0]){case"a":var a=s[1].split(":");if(a.length>1){if("control"===a[0]){var o=n[i].search("control:");!0===r?-1!==o&&(t.Sessions[t.Sessions.length-1].ControlURL=n[i].substr(o+8)):-1!==o&&(t.BaseURL=n[i].substr(o+8))}else if("rtpmap"===a[0]){var l=a[1].split(" ");t.Sessions[t.Sessions.length-1].PayloadType=l[0];var c=l[1].split("/");t.Sessions[t.Sessions.length-1].CodecMime=c[0],c.length>1&&(t.Sessions[t.Sessions.length-1].ClockFreq=c[1])}else if("framesize"===a[0]){var u=a[1].split(" ");if(u.length>1){var d=u[1].split("-");t.Sessions[t.Sessions.length-1].Width=d[0],t.Sessions[t.Sessions.length-1].Height=d[1]}}else if("framerate"===a[0])t.Sessions[t.Sessions.length-1].Framerate=a[1];else if("fmtp"===a[0]){var h=n[i].split(" ");if(h.length<2)continue;for(var f=1;f<h.length;f++){var p=h[f].split(";"),m=0;for(m=0;m<p.length;m++){var g=p[m].search("mode=");if(-1!==g&&(t.Sessions[t.Sessions.length-1].mode=p[m].substr(g+5)),-1!==(g=p[m].search("config="))&&(t.Sessions[t.Sessions.length-1].config=p[m].substr(g+7),R.config=t.Sessions[t.Sessions.length-1].config,R.clockFreq=t.Sessions[t.Sessions.length-1].ClockFreq,R.bitrate=t.Sessions[t.Sessions.length-1].Bitrate),-1!==(g=p[m].search("sprop-vps="))&&(t.Sessions[t.Sessions.length-1].VPS=p[m].substr(g+10)),-1!==(g=p[m].search("sprop-sps="))&&(t.Sessions[t.Sessions.length-1].SPS=p[m].substr(g+10)),-1!==(g=p[m].search("sprop-pps="))&&(t.Sessions[t.Sessions.length-1].PPS=p[m].substr(g+10)),-1!==(g=p[m].search("sprop-parameter-sets="))){var v=p[m].substr(g+21).split(",");v.length>1&&(t.Sessions[t.Sessions.length-1].SPS=v[0],t.Sessions[t.Sessions.length-1].PPS=v[1])}}}}}else 1===a.length&&("recvonly"===a[0]?t.Sessions[t.Sessions.length-1].TalkTransType="recvonly":"sendonly"===a[0]&&(t.Sessions[t.Sessions.length-1].TalkTransType="sendonly"));break;case"m":var y=s[1].split(" "),w={};w.Type=y[0],w.Port=y[1],w.Payload=y[3],t.Sessions.push(w),r=!0;break;case"b":if(!0===r){var S=s[1].split(":");t.Sessions[t.Sessions.length-1].Bitrate=S[1]}}}return t}return L.prototype={connect:function(){n||(console.log("---------start create websocket-----------"),(n=new WebSocket(t)).binaryType="arraybuffer",n.fileOver=!1,n.addEventListener("message",z,!1),n.onopen=function(){var e=$("OPTIONS "+x+" RTSP/1.0\r\nCSeq: "+w+"\r\n\r\n");n.send(e)},n.onerror=function(e){S({errorCode:202,description:"Open WebSocket Error"})},n.onclose=function(e){n&&!n.fileOver&&S({errorCode:202,description:"Open WebSocket Error"})})},disconnect:function(){V(O("TEARDOWN",null)),clearInterval(A),A=null,null!==n&&(n.onerror=null),null!==n&&n.readyState===WebSocket.OPEN&&(n.close(),n=null,_=null),f&&f.Stop()},controlPlayer:function(e){var t="";switch(e.command,e.command){case"PLAY":if(T="Play",null!=e.range){t=O("PLAY",null,0,e.range);break}t=O("PLAY",null);break;case"PAUSE":if("PAUSE"===T)break;T="PAUSE",t=O("PAUSE",null);break;case"SCALE":t=O("SCALE",null,0,e.data),f&&f.SetPlaySpeed(e.data);break;case"TEARDOWN":t=O("TEARDOWN",null),f&&f.Stop();break;case"audioPlay":case"volumn":case"audioSamplingRate":f&&f.setVolume(e.data);break;default:i.h.log("未知指令: "+e.command)}""!=t&&V(t)},setLiveMode:function(e){},setPlayMode:function(e){},setRTSPURL:function(e){x=e},setCallback:function(e,t){"GetFrameRate"===e?I=t:f.setCallback(e,t),"FileOver"==e&&(k=t),"Error"==e&&(S=t)},setUserInfo:function(e,t){E.username=e,E.passWord=t},capture:function(e,t){f.capture(e,t)},setLessRate:function(e){},setFrameData:function(e,t,n,i,r,s,a){f.setFrameData(e,t,n,i,r,s,a)}},new L},se=function(e,t,n){var i=n.isPrivateProtocol,r=null,s=new B,a={wsURL:e,rtspURL:t,playsdk:s,RTSP_STATE:{OK:200,UNAUTHORIZED:401,NOTFOUND:404,INVALID_RANGE:457,NOTSERVICE:503,DISCONNECT:999}},o=Object.assign(a,n);function l(){}return r=i?new ie(o):new re(o),l.prototype={init:function(e,t,n,i){s.Init(e,t,n,i)>0&&s.GetPlayPort()},connect:function(){r.connect()},disconnect:function(){r.disconnect()},controlPlayer:function(e){return r.controlPlayer(e)},setLiveMode:function(e){},setPlayMode:function(e){},setRTSPURL:function(e){r.setRTSPURL(e)},setCallback:function(e,t){r.setCallback(e,t)},setUserInfo:function(e,t){r.setUserInfo(e,t)},capture:function(e,t){s.capture(e,t)},getCapture:function(e,t){s.capture(e,t,!0)},setLessRate:function(e){},startRecord:function(e){s.StartRecord(e)},stopRecord:function(){s.StopRecord()},cancelRecord:function(){s.CancelRecord()},openIVS:function(){s.OpenIVSDraw()},closeIVS:function(){s.CloseIVSDraw()},setFrameData:function(e,t,n,i,r,a,o,l){s.FrameDataCallBack(e,t,n,i,r,a,o,l)},setDecryptionResult:function(e,t,n){s.DecryptionResultCallBack(e,t,n)},setIVSData:function(e,t,n,i){s.IVSDataCallBack(e,t,n,i)},drawIVSData:function(e){s.DrawIVSDataCallBack(e)},setRecordData:function(e,t,n,i,r){s.RecordDataCallBack(e,t,n,i,r)},getPlayPort:function(){return s.GetPlayPort()},pause:function(){return s.Pause("1")},start:function(){return s.Pause("0")},stopTalk:function(){return s.talkStop()}},new l},ae=function(e){this.wsURL=e.wsURL,this.rtspURL=e.rtspURL,this.isPlayback=e.playback||!1,this.isTalkService=e.isTalkService||!1,this.isDownloadService=e.isDownloadService||!1,this.isPrivateProtocol=e.isPrivateProtocol||!1,this.playBackRange=e.range||!1,this.realm=e.realm||"",this.sourceId=e.sourceId||"",this.ws=null,this.decodeMode=e.decodeMode,this.lessRateCanvas=e.lessRateCanvas||!1,this.events={ResolutionChanged:function(){},PlayStart:function(){},DecodeStart:function(){},UpdateCanvas:function(){},GetFrameRate:function(){},FrameTypeChange:function(){},Error:function(){},MSEResolutionChanged:function(){},audioChange:function(){},WorkerReady:function(){},IvsDraw:function(){},FileOver:function(){},Waiting:function(){}},this.username="admin",this.password="admin123"};ae.prototype={init:function(e,t,n){for(var i in this.ws=new se(this.wsURL,this.rtspURL,{isPrivateProtocol:this.isPrivateProtocol,realm:this.realm,sourceId:this.sourceId,isPlayback:this.isPlayback}),this.ws.init(e,t,n,this.isPlayback),this.ws.setLiveMode(this.decodeMode),this.ws.setUserInfo(this.username,this.password),this.ws.setPlayMode(this.isPlayback),this.ws.setLessRate(this.lessRateCanvas),this.events)this.ws.setCallback(i,this.events[i]);this.events=null},connect:function(){this.ws.connect()},talk:function(e,t,n,i,r){if("on"===e){for(var s in this.ws=new se(this.wsURL,this.rtspURL,{isTalkService:this.isTalkService,isPrivateProtocol:this.isPrivateProtocol,realm:this.realm,sourceId:this.sourceId}),r&&this.ws.init(t,n,i,this.isPlayback),this.ws.setUserInfo(this.username,this.password),this.events)this.ws.setCallback(s,this.events[s]);this.ws.connect()}else this.ws.disconnect(),this.ws.stopTalk()},download:function(e,t,n,i){for(var r in this.ws=new se(this.wsURL,this.rtspURL,{isPrivateProtocol:this.isPrivateProtocol,realm:this.realm,sourceId:this.sourceId,isPlayback:this.isPlayback,isDownloadService:this.isDownloadService}),this.ws.init(e,t,n,this.isPlayback),this.ws.setLiveMode(this.decodeMode),this.ws.setUserInfo(this.username,this.password),this.ws.setPlayMode(this.isPlayback),this.ws.setLessRate(this.lessRateCanvas),this.events)this.ws.setCallback(r,this.events[r]);this.events=null,this.connect(),this.startRecord(i)},play:function(){this.controlPlayer("PLAY")},pause:function(){this.controlPlayer("PAUSE"),this.ws.pause()},continue:function(){this.controlPlayer("PLAY"),this.ws.start()},stop:function(){this.controlPlayer("TEARDOWN")},close:function(){this.ws.disconnect()},playByTime:function(e){this.controlPlayer("PLAY","video",e)},playFF:function(e){this.controlPlayer("SCALE",e)},playRewind:function(){},audioPlay:function(){this.controlPlayer("audioPlay","start")},audioStop:function(){this.controlPlayer("audioPlay","stop")},setAudioSamplingRate:function(e){this.controlPlayer("audioSamplingRate",e)},setAudioVolume:function(e){this.controlPlayer("volumn",e)},controlPlayer:function(e,t,n){var i;i="video"===t?{command:e,range:n||0}:{command:e,data:t},this.ws.controlPlayer(i)},setPlayMode:function(e){this.ws.setLiveMode(e)},setPlayPath:function(e){this.ws.setRTSPURL(e)},capture:function(e,t){this.ws.capture(e,t)},getCapture:function(e,t){this.ws.getCapture(e,t)},startRecord:function(e){this.ws.startRecord(e||Date.now()+".mp4")},stopRecord:function(){this.ws.stopRecord()},cancelRecord:function(){this.ws.cancelRecord()},openIVS:function(){this.ws.openIVS()},closeIVS:function(){this.ws.closeIVS()},setFrameData:function(e,t,n,i,r,s,a,o){this.ws.setFrameData(e,t,n,i,r,s,a,o)},setDecryptionResult:function(e,t,n){this.ws.setDecryptionResult(e,t,n)},setIVSData:function(e,t,n,i){this.ws.setIVSData(e,t,n,i)},drawIVSData:function(e){this.ws.drawIVSData(e)},setRecordData:function(e,t,n,i,r){this.ws.setRecordData(e,t,n,i,r)},getPlayPort:function(){return this.ws.getPlayPort()},on:function(e,t){this.events[e]=t}},t.default=ae}]).default),a=s,o=n.p+"img/loading.b6ec696b.png",l={props:{id:{type:String,default:Date.now().toString()},rtspURL:{type:String,required:!0},audioURL:{type:String},downloadURL:{type:String},channelId:{type:Number||String,default:0},bitStream:{type:Number,default:0},isLive:{type:Boolean,default:!0}},data(){return{player:null,playerPort:null,talkPlayer:null,talkPort:null,recordPlayer:null,loading:o,isLoading:!1,downloadPlayer:null,downloadPlayerPort:null,isPlay:!1,isRecording:null,isPrivateProtocol:!1,timer:null,volume:0}},watch:{rtspURL(e){this.isPrivateProtocol=!e.includes("rtsp://")},audioURL(e){this.isPrivateProtocol=!e.includes("rtsp://")},downloadURL(e){this.isPrivateProtocol=!e.includes("rtsp://")}},computed:{wsURL(){const{protocol:e}=location,[t]=this.rtspURL.replace("rtsp://","").split("/"),n=`${"http:"!==e||this.rtspURL.includes("8556")?"wss":"ws"}://${t}`;return this.isPrivateProtocol?`${n}/httpprivateoverwebsocket`:n},audioWsURL(){const{protocol:e}=location,[t]=this.audioURL.replace("rtsp://","").split("/"),n=`${"http:"!==e||this.audioURL.includes("8556")?"wss":"ws"}://${t}`;return this.isPrivateProtocol?`${n}/httpprivateoverwebsocket`:n},downloadWsURL(){const{protocol:e}=location,[t]=this.downloadURL.replace("rtsp://","").split("/"),n=`${"http:"!==e||this.downloadURL.includes("8556")?"wss":"ws"}://${t}`;return this.isPrivateProtocol?`${n}/httpprivateoverwebsocket`:n},rtspStream(){const e=this.rtspURL.includes("rtsp://")?this.rtspURL:`rtsp://${this.rtspURL}`;return this.isPrivateProtocol?this.isLive?`/live/realmonitor.xav?channel=${this.channelId}&subtype=${this.bitStream}`:`/vod/playback.xav?channel=${this.channelId}&subtype=${this.bitStream}`:this.isLive?e:e.replace(/&beginTime=\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}&endTime=\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}/,"")},downloadStream(){const e=this.downloadURL.includes("rtsp://")?this.downloadURL:`rtsp://${this.downloadURL}`;return this.isPrivateProtocol?this.isLive?`/live/realmonitor.xav?channel=${this.channelId}&subtype=${this.bitStream}`:`/vod/playback.xav?channel=${this.channelId}&subtype=${this.bitStream}`:this.isLive?e:e.replace(/&beginTime=\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}&endTime=\d{4}-\d{2}-\d{2} \d{2}:\d{2}:\d{2}/,"")},audioStream(){const e=this.audioURL.includes("rtsp://")?this.audioURL:`rtsp://${this.audioURL}`;return this.isPrivateProtocol?`/live/talk.xav?channel=${this.channelId}&subtype=${this.bitStream}`:e},sourceId(){return this.rtspURL.replace("rtsp://","").split("/")[1]},audioSourceId(){return this.audioURL.replace("rtsp://","").split("/")[1]},downloadSourceId(){return this.downloadURL.replace("rtsp://","").split("/")[1]}},methods:{play(){if(!this.rtspURL)return;this.player&&this.player.close();let e=0;const t={wsURL:this.wsURL,rtspURL:this.rtspStream,sourceId:this.sourceId,lessRateCanvas:!0,playback:!1===this.isLive,isPrivateProtocol:this.isPrivateProtocol,realm:""};this.player=new a(t),this.timer=setTimeout((()=>{this.isLoading=!1,this.$emit("playError",{errorCode:500})}),1e4),this.isLoading=!0,this.player.on("ResolutionChanged",(e=>{console.log("-------------ResolutionChanged--------------:",e)})),this.player.on("PlayStart",(()=>{this.isPlay=!0,this.isLoading&&(this.isLoading=!1)})),this.player.on("DecodeStart",(e=>{clearTimeout(this.timer),this.isPlay=!0,this.isLoading&&(this.isLoading=!1),"video"===e.decodeMode?(this.$refs[`can-${this.id}`].style.display="none",this.$refs[`video-${this.id}`].style.display=""):(this.$refs[`can-${this.id}`].style.display="",this.$refs[`video-${this.id}`].style.display="none")})),this.player.on("UpdateCanvas",(t=>{0===e&&(e=t.timeStamp);const n=(t.timeStamp-e)/1e3,i={playTime:n,time:t.timeStamp};this.$emit("playProgressUpdate",i)})),this.player.on("GetFrameRate",(e=>{console.log("-------------GetFrameRate--------------:",e)})),this.player.on("FrameTypeChange",(e=>{console.log("-------------FrameTypeChange--------------:",e)})),this.player.on("Error",(e=>{this.isPlay=!1,this.$emit("playError",e)})),this.player.on("IvsDraw",(e=>{console.log("-------------IvsDraw--------------:",e)})),this.player.on("WorkerReady",(()=>{this.player.connect()})),this.player.init(this.$refs[`can-${this.id}`],this.$refs[`video-${this.id}`],this.$refs[`ivsCan-${this.id}`]),this.player.connect(),this.playerPort=this.player.getPlayPort()},openIVS(){this.player&&this.player.openIVS()},closeIVS(){this.player&&this.player.closeIVS()},talk(){const e={wsURL:this.audioWsURL,rtspURL:this.audioStream,sourceId:this.audioSourceId,isTalkService:!0,isPrivateProtocol:this.isPrivateProtocol,realm:""};this.talkPlayer?(this.talkPlayer.talk("off"),this.talkPlayer=null):(this.talkPlayer=new a(e),this.talkPlayer.talk("on",this.$refs[`talk-${this.id}`],this.$refs[`talk-video-${this.id}`],this.$refs[`talkIvs-${this.id}`],!this.isPlay),this.isPlay||(this.talkPort=this.talkPlayer.getPlayPort()),this.talkPlayer.on("Error",(e=>{this.$emit("talkError",e)})))},download(e){const t={wsURL:this.downloadWsURL,rtspURL:this.downloadStream,sourceId:this.downloadSourceId,lessRateCanvas:!0,playback:!0,isPrivateProtocol:this.isPrivateProtocol,realm:"",isDownloadService:!0};this.downloadPlayer?this.downloadPlayer.stopRecord():(this.downloadPlayer=new a(t),this.downloadPlayer.on("Error",(e=>{this.$emit("downloadError",e)})),this.downloadPlayer.on("recordChanged",(e=>{if("pendding"==e.type&&e.time){const t={size:e.size,time:e.time};this.$emit("downloadProgressUpdate",t)}else"closed"==e.type&&(this.$emit("downloadComplete"),this.downloadPlayer=null)})),this.downloadPlayer.download(this.$refs[`download-${this.id}`],this.$refs[`download-video-${this.id}`],this.$refs[`downloadIvs-${this.id}`],e),this.downloadPlayer.connect(),this.downloadPlayerPort=this.downloadPlayer.getPlayPort(),this.downloadPlayer.startRecord(e||Date.now()+".mp4"))},record(e){this.player&&(this.isRecording?(this.isRecording=!1,this.player.stopRecord()):(this.isRecording=!0,this.player.startRecord(e||Date.now()+".mp4")))},screenshot(){this.player&&this.player.capture(Date.now(),this.$refs[`can-${this.id}`])},close(){this.talkPlayer&&(this.talkPlayer.talk("off"),this.talkPlayer=null),clearTimeout(this.timer),this.player&&this.player.close(),this.isPlay=!1,this.isLoading=!1,this.player=null,this.$emit("update:rtspURL","")},setAudioVolume(e){if(window.webAudioPlayer)window.webAudioPlayer.resume();else{let e=setInterval((()=>{window.webAudioPlayer&&(window.webAudioPlayer.resume(),clearInterval(e))}))}this.volume=e,this.player&&this.player.setAudioVolume(e),this.talkPlayer&&this.talkPlayer.setAudioVolume(e)},pause(){this.player&&this.player.pause()},start(){this.player&&this.player.continue()},downloadPause(){this.downloadPlayer&&this.downloadPlayer.pause()},downloadStart(){this.downloadPlayer&&this.downloadPlayer.continue()},downloadClose(){this.downloadPlayer&&this.downloadPlayer.close(),this.downloadPlayer.cancelRecord(),this.downloadPlayer=null},playFF(e){this.player&&this.player.playFF(e)},cPlusVisibleDecCallBack(e,t,n,i,r,s){e==this.playerPort&&this.player&&this.player.setFrameData(e,t,n,i,r,s,this.volume),e==this.downloadPlayerPort&&this.downloadPlayer&&this.downloadPlayer.setFrameData(e,t,n,i,r,s,0),e==this.talkPort&&this.talkPlayer&&this.talkPlayer.setFrameData(e,t,n,i,r,s,this.volume,!0)},cDigitalSignCallBack(e,t,n){e==this.playerPort&&this.player&&this.player.setDecryptionResult(e,t,n),e==this.downloadPlayerPort&&this.downloadPlayer&&this.downloadPlayer.setDecryptionResult(e,t,n)},cExtraDrawDataCallBack(e,t,n,i){e==this.playerPort&&this.player&&this.player.setIVSData(e,t,n,i),e==this.downloadPlayerPort&&this.downloadPlayer&&this.downloadPlayer.setIVSData(e,t,n,i)},cExtraDrawDrawCallBack(e){e==this.playerPort&&this.player&&this.player.drawIVSData(e),e==this.downloadPlayerPort&&this.downloadPlayer&&this.downloadPlayer.drawIVSData(e)},cRecordDataCallBack(e,t,n,i,r){e==this.playerPort&&this.player&&this.player.setRecordData(e,t,n,i,r),e==this.downloadPlayerPort&&this.downloadPlayer&&this.downloadPlayer.setRecordData(e,t,n,i,r)}}},c=l,u=n(3736),d=(0,u.Z)(c,i,r,!1,null,null,null),h=d.exports},1080:function(t,n,i){"use strict";i.r(n),i.d(n,{default:function(){return S}});var r=function(){var e=this,t=e._self._c;return t("el-container",{staticClass:"shop-video player-container",style:{width:"100vw",height:"100vh"}},[t("el-aside",{staticClass:"mgb30",attrs:{width:e.asideWidth}},[t("ul",{staticClass:"left-ul",style:{width:e.asideWidth}},[t("li",{staticClass:"left-li float-l active"},[t("span",[e._v("通道")]),t("span",{staticClass:"current-icon"})])]),t("div",{staticClass:"video-tree"},[t("div",{staticClass:"input-box-client"},[t("el-input",{attrs:{placeholder:"请输入关键字过滤",size:"mini"},model:{value:e.searchKey,callback:function(t){e.searchKey=t},expression:"searchKey"}})],1),t("p",{staticClass:"tree-root",on:{click:e.toggleExpand}},[t("i",{directives:[{name:"show",rawName:"v-show",value:e.isExpand,expression:"isExpand"}],staticClass:"el-icon-caret-bottom"}),t("i",{directives:[{name:"show",rawName:"v-show",value:!e.isExpand,expression:"!isExpand"}],staticClass:"el-icon-caret-right"}),t("span",[e._v("通道列表")])]),t("ul",{directives:[{name:"show",rawName:"v-show",value:e.isExpand,expression:"isExpand"}],staticClass:"channel-tree lighter-scroll-bar"},[e._l(e.showChannelList,(function(n){return t("li",{key:n.deviceId+n.channelId,class:{"active-channel":e.windowMap.get(e.activeWindowNo)&&e.windowMap.get(e.activeWindowNo).channelName===n.channelName},attrs:{title:n.channelName},on:{dblclick:function(t){return e.dblclickChannel(n)}}},[e.playingNodes.includes(n.deviceId+n.channelId)?t("i",{staticClass:"playing-icon"}):t("i",{staticClass:"online-icon"}),e._v(" "+e._s(n.channelName)+" ")])})),e.deviceLoaded&&!e.showChannelList.length?t("el-alert",{attrs:{closable:!1,title:"没有找到节点",type:"warning","show-icon":""}}):e._e()],2)])]),t("el-container",[t("el-main",{ref:"cBox",staticClass:"main-container video-box relative",attrs:{id:"cBox"}},e._l(4,(function(n){return t("div",{key:"window"+n,staticClass:"player-box",class:{"active-player":n===e.activeWindowNo},style:{width:100/(e.stepLength+1)+"%",height:100/(e.stepLength+1)+"%"},on:{click:function(t){return e.changeWindow(n)},dblclick:function(t){return e.dblclickWindow(n,t)}}},[t("video-player",{ref:`player${n}`,refInFor:!0,attrs:{id:`player${n}`,rtspURL:e.rtspURL[n],audioURL:e.audioURL[n],downloadURL:e.downloadURL[n],isLive:e.isLive[n]},on:{downloadComplete:function(t){return e.downloadComplete(n)},downloadError:function(t){return e.downloadError(t,n)},playError:e.playError}})],1)})),0),t("el-row",{staticClass:"w-precent-100 h40 el-footer"},[e.windowMap.get(e.activeWindowNo)&&e.windowMap.get(e.activeWindowNo).showTool?t("el-col",{staticClass:"h40 flex",attrs:{span:12}},[t("div",{directives:[{name:"show",rawName:"v-show",value:!e.isLive[e.activeWindowNo],expression:"!isLive[activeWindowNo]"}],class:e.isPause||!e.isPlay?"play-icon":"pause-icon",attrs:{title:e.isPause||!e.isPlay?"播放":"暂停"},on:{click:e.togglePlay}}),t("div",{staticClass:"screenshot-icon",attrs:{title:"截图"},on:{click:e.screenshot}}),t("div",{staticClass:"recording-icon",class:{active:e.recording},attrs:{title:"录像"},on:{click:e.record}}),t("div",{directives:[{name:"show",rawName:"v-show",value:e.isLive[e.activeWindowNo],expression:"isLive[activeWindowNo]"}],staticClass:"talk-icon",class:{active:e.talking},attrs:{title:"对讲"},on:{click:e.talk}}),t("div",{staticClass:"sound-icon",class:{active:e.isMuting},attrs:{title:e.isMuting?"静音":"声音"},on:{click:e.toggleMute}}),t("span",{directives:[{name:"show",rawName:"v-show",value:e.isLive[e.activeWindowNo],expression:"isLive[activeWindowNo]"}],staticClass:"tool-span w34",attrs:{title:"0"===e.streamType?"切换标清":"切换高清"},on:{click:e.switchStreamType}},[e._v(" "+e._s("0"===e.streamType?"高清":"标清"))]),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.isLive[e.activeWindowNo],expression:"!isLive[activeWindowNo]"},{name:"loading",rawName:"v-loading",value:e.isDownloading,expression:"isDownloading"}],staticClass:"download-icon",attrs:{title:"录像下载"},on:{click:e.download}}),t("div",{staticClass:"close-icon",attrs:{title:"关闭"},on:{click:e.closeVideo}}),t("el-dropdown",{directives:[{name:"show",rawName:"v-show",value:!e.isLive[e.activeWindowNo],expression:"!isLive[activeWindowNo]"}],staticClass:"video-tool-dropdown",attrs:{placement:"bottom-end"},on:{command:e.fast}},[t("span",{staticClass:"el-dropdown-link",attrs:{title:"播放倍数"}},[e._v(" "+e._s(e.speed)+"X"),t("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),t("el-dropdown-menu",{staticClass:"video-monitor-dropdown",attrs:{slot:"dropdown",size:"mini"},slot:"dropdown"},[t("el-dropdown-item",{attrs:{command:"0.25"}},[e._v("0.25X")]),t("el-dropdown-item",{attrs:{command:"0.5"}},[e._v("0.5X")]),t("el-dropdown-item",{attrs:{command:"1"}},[e._v("1X")]),t("el-dropdown-item",{attrs:{command:"2"}},[e._v("2X")]),t("el-dropdown-item",{attrs:{command:"4"}},[e._v("4X")]),t("el-dropdown-item",{attrs:{command:"6"}},[e._v("6X")]),t("el-dropdown-item",{attrs:{command:"8"}},[e._v("8X")])],1)],1)],1):t("el-col",{staticClass:"h40",attrs:{span:12}}),t("el-col",{staticClass:"text-right h40",attrs:{span:12}},[t("span",{staticClass:"tool-span w34 switch-record",attrs:{title:"cloudRecord"===e.recordType?"切换设备录像":"切换云录像"},on:{click:e.switchRecordType}},[e._v(" "+e._s("cloudRecord"===e.recordType?"云":"设备"))]),t("span",{staticClass:"p4-normal-icon video-icon",attrs:{title:"1分屏"},on:{click:function(t){return e.stepLengthInput(0)}}}),t("span",{staticClass:"p16-normal-icon video-icon",attrs:{title:"4分屏"},on:{click:function(t){return e.stepLengthInput(1)}}}),t("span",{staticClass:"video-icon closeall-normal-icon",attrs:{title:"关闭所有"},on:{click:e.closeAllVideo}})])],1),t("div",{staticClass:"timeline-div"},[t("i",{staticClass:"el-icon-arrow-left",on:{click:e.prev}}),t("span",{staticClass:"inline-block w30"},[e._v(e._s(e.dateArr[1])+"月")]),t("div",{staticClass:"inline-block date-panel"},e._l(e.dayNum,(function(n){return t("p",{key:n,staticClass:"w-precent-3 inline-block"},[t("span",{staticClass:"time-point",class:n===e.dateArr[2]?"time-point-active":"",on:{click:function(t){return e.timePointClick(n)}}},[e._v(e._s(e._f("dealZero")(n)))])])})),0),t("i",{staticClass:"el-icon-arrow-right",on:{click:e.next}}),t("div",{staticClass:"inline-block select-date w140"},[t("el-date-picker",{staticClass:"select-date",attrs:{type:"datetime",placeholder:"选择日期","value-format":"yyyy-MM-dd HH:mm:ss","default-time":"12:00:00"},on:{change:function(t){return e.updateDateArr(t,!0)}},model:{value:e.selectDate,callback:function(t){e.selectDate=t},expression:"selectDate"}})],1)]),t("el-footer",{staticClass:"relative timeline-footer",attrs:{height:"104px"}},[t("div",{staticClass:"timeline-no"},e._l(e.screenNum[e.screenNum.length-1],(function(n){return t("p",{key:"p"+n,staticClass:"timeline-no-p",class:e.activeWindowNo===n?"font-red":""},[t("span",{staticClass:"timeline-no-span"},[e._v(e._s(n))]),t("span",{staticClass:"timeline-title",attrs:{title:e.windowMap.get(n)?e.windowMap.get(n).channelName:""}},[e._v(" "+e._s(e.windowMap.get(n)?e.windowMap.get(n).channelName:"")+" ")])])})),0),e._l(e.screenNum[e.screenNum.length-1],(function(n){return t("timer",{key:"timer"+n,ref:"timerRef"+n,refInFor:!0,attrs:{"record-infos":e.recordInfoObj[n]},on:{"timer-change":function(t){return e.timerChange(t,n,!0)}}})}))],2)],1)],1)},s=[],a=i(8281),o=function(){var e=this,t=e._self._c;return t("div",{ref:"timeline-"+e.guid,staticClass:"timeline",attrs:{id:"timeline-"+e.guid,ondragstart:"return false;",onselectstart:"return false;"}},[t("p",{staticClass:"timeline-line"}),t("div",{key:"timeline-main-"+e.guid,ref:"timeline-main",staticClass:"timeline-main",attrs:{id:"timeline-main-"+e.guid}},[e._l(e.timeArr,(function(n){return t("span",{key:n+e.guid,class:"timeline-text-"+e.guid,style:{paddingRight:e.paddingRight+"px"}},[e._v(e._s(n))])})),t("div",{staticClass:"record-bg-div"},e._l(e.recordRange,(function(n,i){return t("span",{key:i+e.guid,staticClass:"record-bg-span",style:{left:n.left+"px",width:n.width+"px"}})})),0)],2)])},l=[],c={data(){return{timeArr:[],intervalNum:6,intervalArr:[60,300,600,900,1800,3600,7200],paddingRight:50,timer:null,selectTime:null,guid:"",parentWidth:0,resizeFn:null,recordRange:[],lastBgSetDate:"",timerChange:null}},props:{recordInfos:{type:Array,default(){return[]}}},watch:{selectTime:{handler(e){e&&this.timerChange()}},recordInfos:{deep:!0,handler(e){e&&e.length>0?this.setBackground(e):this.recordRange=[]}}},computed:{minRight(){return Math.ceil(.03*this.parentWidth)},maxRight(){return Math.ceil(.09*this.parentWidth)}},methods:{secToTime(e){var t;if(e=Math.floor(e),e>-1){var n=Math.floor(e/3600),i=Math.floor(e/60)%60,r=e%60;t=n<10?"0"+n+":":n+":",i<10&&(t+="0"),t+=i+":",r<10&&(t+="0"),t+=r}return"24:00:00"===t?"23:59:59":t},timeToSec(e){let t=new Date(e),n=t.getHours(),i=t.getMinutes(),r=t.getSeconds();return 3600*n+60*i+r},positionTime(e){let t=this.timeToSec(e),n=t/(86400+this.intervalArr[this.intervalNum])*this.$refs["timeline-main"].offsetWidth,i=this.parentWidth/2-Math.ceil(n),r=$("#timeline-main-"+this.guid)[0];r.style.left=i+"px"},setBackground(e){this.recordRange=[],e&&e.length>0&&e.forEach((e=>{let t=this.getLocationByTimeRange(e.beginTime,e.endTime);this.recordRange.push(t)}))},updateBackground(){if(this.recordRange&&this.recordRange.length>0){let e=JSON.parse(JSON.stringify(this.recordRange));this.recordRange=[];for(let t=0;t<e.length;t++){let n=this.getLocationByTimeRange(e[t].beginTime,e[t].endTime);this.recordRange.push(n)}}},getLocationByTimeRange(e,t){let n={beginTime:e,endTime:t},i=this.timeToSec(e),r=i/(86400+this.intervalArr[this.intervalNum])*this.$refs["timeline-main"].offsetWidth;n.left=r.toFixed(2);let s=this.timeToSec(t),a=(s-i)/(86400+this.intervalArr[this.intervalNum])*this.$refs["timeline-main"].offsetWidth+.1;return n.width=a.toFixed(2),n},refresh(){let e=0;this.timeArr=[];let t=86400;while(e<t)this.timeArr.push(this.secToTime(e)),e+=this.intervalArr[this.intervalNum];this.timeArr.push("23:59:59");let n=this.$refs["timeline-main"].offsetLeft;this.$nextTick((()=>{let e=document.querySelectorAll(".timeline-text-"+this.guid),t=e[0].offsetWidth,i=Math.floor((this.parentWidth/2-n)/t),r=this.parentWidth/2-n-t*i,s=this.intervalArr[this.intervalNum]*(i+r/t);this.selectTime=this.secToTime(s),this.updateBackground()}))},turnUp(){this.intervalNum<=0||(this.paddingRight>=this.maxRight?(this.paddingRight=this.minRight,this.intervalNum-=1):this.paddingRight+=3,this.refresh())},turnDown(){this.intervalNum>=this.intervalArr.length-1||(this.paddingRight<=this.minRight?(this.paddingRight=this.maxRight,this.intervalNum+=1):this.paddingRight-=3,this.refresh())},throttle(e,t){let n=null;return function(){n||(n=setTimeout((()=>{e.apply(this,arguments),n=null}),t))}},debounce(e,t,n){return n=n||null,function(){let i=arguments;clearTimeout(n),n=setTimeout((()=>{e.call(this,i)}),t)}},addZero:e=>{let t=e>9?e:"0"+e;return t}},mounted(){this.parentWidth=this.$refs["timeline-"+this.guid].offsetWidth,this.paddingRight=this.maxRight;var e=$("#timeline-main-"+this.guid);this.$nextTick((()=>{let e=new Date,t=`${e.getFullYear()}-${this.addZero(e.getMonth()+1)}-${this.addZero(e.getDate())} 12:00:00`;this.positionTime(new Date(t).getTime())})),this.refresh();const t=this.throttle(this.turnUp,10),n=this.throttle(this.turnDown,10),i=this;var r=function(e){return e=e||window.event,e.stopPropagation(),e.preventDefault(),e.wheelDelta?(e.wheelDelta>0&&t(),e.wheelDelta<0&&n()):e.detail&&(e.detail>0&&t(),e.detail<0&&n()),!1};document.addEventListener&&this.$refs["timeline-main"].addEventListener("DOMMouseScroll",r,!1),document.querySelector("#timeline-main-"+this.guid).onmousewheel=r;var s,a=$("body"),o=0;e.mousedown((function(){o=1;var e=event.clientX,t=this.style.left;t=t.substr(0,t.length-2),s=parseInt(e-t)})),e.mousemove((function(){if(1===o){let e=document.querySelectorAll(".timeline-text-"+i.guid),t=e[0].offsetWidth,n=event.clientX-s;if(n>i.parentWidth/2)return;if(n<0&&-n+i.parentWidth/2>t*(e.length-1))return;this.style.left=n+"px";let r=Math.floor((i.parentWidth/2-n)/t),a=i.parentWidth/2-n-t*r,o=i.intervalArr[i.intervalNum]*(r+a/t);i.selectTime=i.secToTime(o)}})),e.mouseup((function(){o=0})),a.mouseup((function(){o=0})),this.timerChange=this.debounce((()=>{this.$emit("timer-change",this.selectTime)}),1e3),window.addEventListener("resize",i.resizeFn=i.debounce((()=>{i.parentWidth=i.$refs["timeline-"+i.guid].offsetWidth}),50))},created(){this.guid=Math.ceil(1e8*(1+Math.random()))},deactivated(){window.removeEventListener("resize",this.resizeFn)}},u=c,d=i(3736),h=(0,d.Z)(u,o,l,!1,null,null,null),f=h.exports,p=i(4454),m=i(1493),g=i(1304),v={name:"VideoDemoMul",data(){return{windowMap:new Map,stepLength:1,screenNum:[1,4],definitionMode:1,channelMap:new Map,activeWindowNo:1,asideWidth:"205px",selectDate:"",dateArr:[],recordInfoObj:{},timerChangeFn:null,loading:!1,needPlayBack:!0,multiple:1,recordDate:"",brand:"general",playingNodes:[],lcToken:"",searchKey:"",noNode:!1,channelList:[],isExpand:!0,deviceLoaded:!1,rtspURL:{1:"",2:"",3:"",4:""},audioURL:{1:"",2:"",3:"",4:""},downloadURL:{1:"",2:"",3:"",4:""},isLive:{1:!0,2:!0,3:!0,4:!0},recording:!1,talking:!1,isMuting:!0,isPause:!1,isPlay:!1,isDownloading:!1,recordType:"localRecord",speed:1,encrypt:"0",streamType:"0"}},components:{VideoPlayer:a.Z,Timer:f},computed:{dayNum(){return this.dateArr.length>0?new Date(this.dateArr[0],this.dateArr[1],0).getDate():0},showChannelList(){return this.channelList.filter((e=>e.channelName.includes(this.searchKey)))}},filters:{dealZero(e){return e<=9?"0"+e:e}},methods:{toggleExpand(){this.isExpand=!this.isExpand},changeWindow(e){if(e===this.activeWindowNo)return;this.$refs[`player${this.activeWindowNo}`][0]&&this.$refs[`player${this.activeWindowNo}`][0].setAudioVolume(0),this.talking&&(this.talking=!1,this.windowMap.get(this.activeWindowNo).talking=!1,this.$refs[`player${this.activeWindowNo}`][0]&&this.$refs[`player${this.activeWindowNo}`][0].talk()),this.activeWindowNo=e;let t=this.windowMap.get(this.activeWindowNo);t&&t.showTool&&(this.isMuting=t.isMuting,this.recording=t.recording,this.talking=t.talking,this.isPause=t.isPause,this.isPlay=t.isPlay,this.streamType=t.streamType,this.isDownloading=t.isDownloading,this.speed=t.speed?t.speed:1,this.recordType=t.recordType,!t.isMuting&&this.$refs[`player${this.activeWindowNo}`][0]&&this.$refs[`player${this.activeWindowNo}`][0].setAudioVolume(1))},dblclickWindow(e,t){0!==this.stepLength&&(this.changeWindow(e),$(t.target).parents(".player-box").toggleClass("full-player-box").siblings().toggleClass("none"))},dblclickChannel(e){let t=this.windowMap.get(this.activeWindowNo);t&&(this.playingNodes=this.playingNodes.filter((e=>e!==t.deviceId+t.channelId))),this.windowMap.set(this.activeWindowNo,{deviceId:e.deviceId,channelId:e.channelId,channelName:e.channelName,onlineStatus:e.onlineStatus,channelAbility:e.channelAbility,deviceAbility:e.deviceAbility,deviceModel:e.deviceModel,deviceType:e.deviceType,protoType:e.protoType,recordProtoType:e.recordProtoType,talkProtoType:e.talkProtoType,streamType:"0"}),this.closeVideo();const n=(new Date).Format("yyyy-MM-dd");this.updateDateArr(`${n} 12:00:00`),this.playReal()},checkRecord(e,t,n){let i=this.windowMap.get(e.windowNo);n=n||t.split(" ")[0]+" 23:59:59";let r={pageNum:1,pageSize:30,deviceId:e.deviceId,channelId:e.channelId,windowNo:e.windowNo,beginTime:new Date(t).getTime(),endTime:new Date(n).getTime()};const s=this;return new Promise(((e,t)=>{(0,g.Z)({method:"post",url:`${p.Z.base_url}/gateway/device/api/${"cloudRecord"===i.recordType?"getCloudVideoRecords":"getVideoLocalRecords"}`,data:r,needRequestData:!0,headers:{"Access-Control-Allow-Origin":"*","Content-Type":"application/json",Authorization:"Bearer "+this.token},onSuccess(t){let n=t.data.pageData,i=s.windowMap.get(t.requestData.windowNo);n.length&&"extra1"===n[0].streamType?i.recordStreamType="1":i.recordStreamType="0",s.$set(s.recordInfoObj,t.requestData.windowNo,t.data.pageData),e()},onError(e){console.error(e),t(e)}})}))},stepLengthInput(e){this.stepLength=e,0===this.stepLength?(1!=this.activeWindowNo&&this.changeWindow(1),this.$nextTick((()=>{$(".player-box").eq(0).siblings().addClass("none")}))):$(".player-box").removeClass("none")},setWindowTime(e,t){this.windowMap.get(e)&&(this.windowMap.get(e)["time"]=t)},getWindowTime(e){return this.windowMap.get(e)?this.windowMap.get(e)["time"]:null},prev(){1===this.dateArr[1]?(this.$set(this.dateArr,"1",12),this.$set(this.dateArr,"0",this.dateArr[0]-1)):this.$set(this.dateArr,"1",this.dateArr[1]-1),this.timePointClick(this.dayNum)},next(){12===this.dateArr[1]?(this.$set(this.dateArr,"1",1),this.$set(this.dateArr,"0",this.dateArr[0]+1)):this.$set(this.dateArr,"1",this.dateArr[1]+1),this.timePointClick(this.dayNum)},async timePointClick(e){this.$set(this.dateArr,"2",e),this.updateSelectDate();let t=`${this.dateArr[0]}-${this.addZero(this.dateArr[1])}-${this.addZero(this.dateArr[2])} 12:00:00`;this.$refs["timerRef"+this.activeWindowNo][0].positionTime(new Date(t).getTime());let n=this.windowMap.get(this.activeWindowNo);if(n){let e=`${this.dateArr[0]}-${this.addZero(this.dateArr[1])}-${this.addZero(this.dateArr[2])} 00:00:00`;await this.checkRecord({deviceId:n.deviceId,channelId:n.channelId,windowNo:this.activeWindowNo},e)}this.timerChange("12:00:00",this.activeWindowNo,!0)},updateSelectDate(){this.selectDate=`${this.dateArr[0]}-${this.addZero(this.dateArr[1])}-${this.addZero(this.dateArr[2])} 12:00:00`,this.setWindowTime(this.activeWindowNo,this.selectDate)},async updateDateArr(e,t){let n=e.split(" ")[0],i=e.split(" ")[1],r=n.split("-");for(let l=0;l<r.length;l++)this.$set(this.dateArr,l,parseInt(r[l]));let s=this.activeWindowNo;this.$refs["timerRef"+s][0].positionTime(new Date(e).getTime());let a=this.getWindowTime(s);this.setWindowTime(s,e);const o=this.windowMap.get(s);if(o){if(!a||null!=a&&a.split(" ")[0]!=n){let e=`${n} 00:00:00`;await this.checkRecord({deviceId:o.deviceId,channelId:o.channelId,windowNo:this.activeWindowNo},e)}this.timerChange(i,s,t)}},async timerChange(e,t,n){const i=this.windowMap.get(t);i&&n&&(i.isPlayback=!0,i.recordType=i.recordType||"localRecord",i.beginTime=`${this.dateArr[0]}-${this.addZero(this.dateArr[1])}-${this.addZero(this.dateArr[2])} ${e}`,i.endTime=`${this.dateArr[0]}-${this.addZero(this.dateArr[1])}-${this.addZero(this.dateArr[2])} 23:59:59`,await this.init(t),i.isPlay=!0,this.activeWindowNo===t&&(this.isPlay=!0),this.play(t))},switchStreamType(){let e=this.windowMap.get(this.activeWindowNo);null!=e&&(this.closeVideo(),this.streamType="0"===this.streamType?"1":"0",e.streamType=this.streamType,this.playReal())},async switchRecordType(){let e=this.windowMap.get(this.activeWindowNo);if(null!=e){e.recordType="cloudRecord"===e.recordType?"localRecord":"cloudRecord",this.recordType=e.recordType;let t=`${this.dateArr[0]}-${this.addZero(this.dateArr[1])}-${this.addZero(this.dateArr[2])} 00:00:00`;await this.checkRecord({deviceId:e.deviceId,channelId:e.channelId,windowNo:this.activeWindowNo},t),this.timerChange("00:00:00",this.activeWindowNo,!0)}},screenshot(){let e=this.windowMap.get(this.activeWindowNo);e&&(e.isPlay&&!e.isPause?(console.log("-----screenshot-----"),this.$refs[`player${this.activeWindowNo}`][0]&&this.$refs[`player${this.activeWindowNo}`][0].screenshot()):this.$message.warning("截图前请先播放视频"))},playError(e){console.error(e)},recordError(){console.error(e)},closeVideo(e){e=e||this.activeWindowNo,console.log("-----closeVideo-----");let t=this.windowMap.get(e);if(t){t.isPlay=!1,t.isPause=!1,t.talking=!1,t.isMuting=!0,t.isDownloading=!1,t.recording=!1,t.streamType="0";let e=t.deviceId+t.channelId;this.playingNodes=this.playingNodes.filter((t=>t!==e)),t.showTool=!1}e===this.activeWindowNo&&(this.isPlay=!1,this.isPause=!1,this.isDownloading=!1,this.talking=!1,this.isMuting=!0,this.isDownloading=!1,this.recording=!1),this.$refs[`player${e}`][0]&&this.$refs[`player${e}`][0].close()},closeAllVideo(){console.log("-----closeAllVideo-----");for(let e=1;e<=this.screenNum[this.screenNum.length-1];e++){let t=this.windowMap.get(e);t&&(t.isPlay=!1,t.isPause=!1,t.talking=!1,t.isMuting=!0,t.isDownloading=!1,t.recording=!1,t.streamType="0",t.showTool=!1,this.playingNodes=[]),this.$refs[`player${e}`][0]&&this.$refs[`player${e}`][0].close()}},async record(){let e=this.windowMap.get(this.activeWindowNo);e&&(e.isPlay&&!e.isPause?(e.recording||await this.init(this.activeWindowNo),e.recording=!e.recording,this.recording=e.recording,this.$refs[`player${this.activeWindowNo}`][0]&&this.$refs[`player${this.activeWindowNo}`][0].record()):this.$message.warning("录像前请先直播"))},talk(){let e=this.windowMap.get(this.activeWindowNo);if(e)if(e.talking)e.talking=!e.talking,this.talking=e.talking,this.$refs[`player${this.activeWindowNo}`][0]&&this.$refs[`player${this.activeWindowNo}`][0].talk();else{if(!e.isPlay||e.isPause)return void this.$message.warning("对讲前请先直播");const t={deviceId:e.deviceId,channelId:e.channelId,businessType:"talk",streamType:this.streamType,encryptMode:this.encrypt,protoType:e.talkProtoType,deviceType:e.deviceType,windowNo:this.activeWindowNo},n=this;(0,g.Z)({method:"post",url:`${p.Z.base_url}/gateway/videobussiness/api/createDeviceStreamUrl`,data:t,needRequestData:!0,headers:{"Access-Control-Allow-Origin":"*","Content-Type":"application/json",Authorization:"Bearer "+this.token},onSuccess(e){const t=e.data&&e.data.url,i=e.requestData.windowNo;t?(n.audioURL[i]=t,n.$nextTick((()=>{n.windowMap.get(i).talking=!0,n.talking=!0,n.$refs[`player${i}`][0]&&n.$refs[`player${i}`][0].talk()}))):n.$message.warning(e.errMsg)}})}},toggleMute(){let e=this.windowMap.get(this.activeWindowNo);if(!e)return;if(e.talking)return void this.$message.warning("对讲时不能操作声音");e.isMuting=!e.isMuting,this.isMuting=e.isMuting;const t=e.isMuting?0:1;this.$refs[`player${this.activeWindowNo}`][0]&&this.$refs[`player${this.activeWindowNo}`][0].setAudioVolume(t)},play(e){this.$refs[`player${e}`][0]&&this.$refs[`player${e}`][0].play()},pause(){this.$refs[`player${this.activeWindowNo}`][0]&&this.$refs[`player${this.activeWindowNo}`][0].pause()},start(){this.$refs[`player${this.activeWindowNo}`][0]&&this.$refs[`player${this.activeWindowNo}`][0].start()},async playReal(){await this.init(this.activeWindowNo);let e=this.windowMap.get(this.activeWindowNo);this.playingNodes.push(e.deviceId+e.channelId),e.isPlay=!0,this.isPlay=!0,this.play(this.activeWindowNo)},async togglePlay(){this.isPause?this.start():this.pause();let e=this.windowMap.get(this.activeWindowNo);e.isPause=!e.isPause,this.isPause=e.isPause},fast(e){let t=this.windowMap.get(this.activeWindowNo);t.isPlay&&!t.isPause?(this.speed=parseFloat(e,10),t.speed=this.speed,this.$refs[`player${this.activeWindowNo}`][0]&&this.$refs[`player${this.activeWindowNo}`][0].playFF(this.speed)):this.$message.warning("倍速前请先播放录像")},async download(){if(this.isDownloading)return void console.log("录像正在下载中......");await this.downloadInit(this.activeWindowNo),this.isDownloading=!0;let e=this.windowMap.get(this.activeWindowNo);e.isDownloading=!0,this.$refs[`player${this.activeWindowNo}`][0]&&this.$refs[`player${this.activeWindowNo}`][0].download()},downloadError(e,t){console.log(`窗口${t}下载出错，errorCode：${e&&e.errorCode},description：${e&&e.description}`),this.$refs[`player${t}`][0]&&this.$refs[`player${t}`][0].download();let n=this.windowMap.get(t);n&&(n.isDownloading=!1),t==this.activeWindowNo&&(this.isDownloading=!1)},downloadComplete(e){console.log(`窗口${e}下载完成`);let t=this.windowMap.get(e);t&&(t.isDownloading=!1),e==this.activeWindowNo&&(this.isDownloading=!1)},toAllStringByTime(e){const t={};let n=new Date(e);return t.y=this.addZero(n.getFullYear()),t.m=this.addZero(n.getMonth()+1),t.d=this.addZero(n.getDate()),t.h=this.addZero(n.getHours()),t.min=this.addZero(n.getMinutes()),t.s=this.addZero(n.getSeconds()),`${t.y}-${t.m}-${t.d} ${t.h}:${t.min}:${t.s}`},addZero:e=>{let t=e>9?e:"0"+e;return t},init(e){let t=this.windowMap.get(e),n={deviceId:t.deviceId,channelId:t.channelId,encryptMode:this.encrypt,windowNo:e};t.isPlayback?(n.businessType=t.recordType,n.protoType=t.recordProtoType,n.beginTime=t.beginTime,n.endTime=t.endTime,n.streamType=t.recordStreamType||"0"):(n.protoType=t.protoType,n.businessType="real",n.streamType=t.streamType),this.isLive[e]=!t.isPlayback;const i=this;return new Promise(((e,t)=>{(0,g.Z)({method:"post",url:`${p.Z.base_url}/gateway/videobussiness/api/createDeviceStreamUrl`,data:n,needRequestData:!0,headers:{"Access-Control-Allow-Origin":"*","Content-Type":"application/json",Authorization:"Bearer "+this.token},onSuccess(n){const r=n.data&&n.data.url;let s=i.windowMap.get(n.requestData.windowNo);s&&s.isDownloading&&i.$refs[`player${n.requestData.windowNo}`][0]&&i.$refs[`player${n.requestData.windowNo}`][0].download(),r?(i.rtspURL[n.requestData.windowNo]=r,s.isPause=!1,s.talking=!1,s.isMuting=!0,s.isDownloading=!1,s.recording=!1,s.showTool=!0,n.requestData.windowNo==this.activeWindowNo&&(i.isDownloading=!1),e()):(i.rtspURL[n.requestData.windowNo]="",i.closeVideo(n.requestData.windowNo),i.$message.warning(n.errMsg),t(n.errMsg))},onError(e){if(console.error(e),t(e),e.requestData){let t=i.windowMap.get(e.requestData.windowNo);i.playingNodes=i.playingNodes.filter((e=>e!==t.deviceId+t.channelId))}}})}))},downloadInit(e){let t=this.windowMap.get(e),n={deviceId:t.deviceId,channelId:t.channelId,streamType:t.streamType,encryptMode:this.encrypt,windowNo:e};n.businessType=t.recordType,n.protoType=t.recordProtoType,n.beginTime=t.beginTime,n.endTime=t.endTime;const i=this;return new Promise(((e,t)=>{(0,g.Z)({method:"post",url:`${p.Z.base_url}/gateway/videobussiness/api/createDeviceStreamUrl`,data:n,needRequestData:!0,headers:{"Access-Control-Allow-Origin":"*","Content-Type":"application/json",Authorization:"Bearer "+this.token},onSuccess(n){const r=n.data&&n.data.url;r?(i.downloadURL[n.requestData.windowNo]=r,e()):(i.$message.warning(n.errMsg),t(n.errMsg))},onError(e){console.error(e),t(e)}})}))},getToken(){const e=`${p.Z.base_url}/gateway/auth/oauth/token?grant_type=client_credentials&scope=server&client_id=${p.Z.client_id}&client_secret=${p.Z.client_secret}`,t=this;(0,g.Z)({method:"post",url:e,headers:{"Access-Control-Allow-Origin":"*","Content-Type":"application/x-www-form-urlencoded"},onSuccess(e){t.token=e.access_token,t.initDeviceList()}})},initDeviceList(e){const t=this;(0,g.Z)({method:"post",url:`${p.Z.base_url}/gateway/device/api/page`,data:{pageNum:1,pageSize:200,searchKey:e},headers:{"Access-Control-Allow-Origin":"*","Content-Type":"application/json",Authorization:"Bearer "+this.token},onSuccess(e){let n=e.data.pageData;t.channelList=[],n.length&&n.forEach((e=>{let n=!1;if(e.ability){let t=e.ability.split(",");n=t.includes("TSV1")||t.includes("TSV2")}e.channelList&&e.channelList.forEach((i=>{i.onlineStatus&&t.channelList.push({channelId:i.channelId,channelName:i.channelName,onlineStatus:i.onlineStatus,channelAbility:i.channelAbility,protoType:e.ability&&e.ability.includes("RTSV")?"rtsv":"rtsp",recordProtoType:e.ability&&e.ability.includes("PBSV")?"rtsv":"rtsp",talkProtoType:n?"rtsv":"rtsp",deviceId:e.deviceId,deviceAbility:e.ability,deviceModel:e.deviceModel,deviceType:e.deviceModel&&e.deviceModel.includes("NVR")?"channel":"device"})}))})),this.deviceLoaded=!0}})}},mounted(){this.getToken();let e=new Date;this.dateArr=[e.getFullYear(),e.getMonth()+1,e.getDate()],this.selectDate=`${this.dateArr[0]}-${this.addZero(this.dateArr[1])}-${this.addZero(this.dateArr[2])} 12:00:00`;let t=[];for(let n=1;n<=this.screenNum[this.screenNum.length-1];n++)this.$refs[`player${n}`]&&t.push(this.$refs[`player${n}`][0]);m.Z.init(t)}},y=v,w=(0,d.Z)(y,r,s,!1,null,null,null),S=w.exports},5787:function(e,t,n){var i=n(7976),r=TypeError;e.exports=function(e,t){if(i(t,e))return e;throw r("Incorrect invocation")}},3678:function(e){e.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},2801:function(e,t,n){"use strict";var i=n(2109),r=n(7854),s=n(5005),a=n(9114),o=n(3070).f,l=n(2597),c=n(5787),u=n(9587),d=n(6277),h=n(3678),f=n(1060),p=n(9781),m=n(1913),g="DOMException",v=s("Error"),y=s(g),w=function(){c(this,S);var e=arguments.length,t=d(e<1?void 0:arguments[0]),n=d(e<2?void 0:arguments[1],"Error"),i=new y(t,n),r=v(t);return r.name=g,o(i,"stack",a(1,f(r.stack,1))),u(i,this,w),i},S=w.prototype=y.prototype,b="stack"in v(g),T="stack"in new y(1,2),C=y&&p&&Object.getOwnPropertyDescriptor(r,g),_=!!C&&!(C.writable&&C.configurable),P=b&&!_&&!T;i({global:!0,constructor:!0,forced:m||P},{DOMException:P?w:y});var A=s(g),R=A.prototype;if(R.constructor!==A)for(var x in m||o(R,"constructor",a(1,A)),h)if(l(h,x)){var I=h[x],E=I.s;l(A,E)||o(A,E,a(6,I.c))}},1304:function(e,t){"use strict";const n=axios.create({timeout:1e4});t["Z"]=e=>{n({method:e.method,url:e.url,data:e.data||{},headers:e.headers||{}}).then((t=>{e.needRequestData&&t.data&&(t.data.requestData=JSON.parse(t.config.data)),200===t.status?e.onSuccess&&e.onSuccess(t.data):e.onError&&e.onError(t.data)})).catch((t=>{e.onError&&e.onError(t)}))}},4454:function(e,t){"use strict";const n="https://www.cloud-dahua.com",i="reee9eb1877485451e9b44e8b0795d945e",r="abb87231cbe9e2c2423d8a2b35d1c2e4";t["Z"]={base_url:n,client_id:i,client_secret:r}},1493:function(e,t,n){"use strict";n.d(t,{Z:function(){return h}});n(8675),n(7380),n(1118);const i={Opera:"Opera",Chrome:"Chrome",Firefox:"Firefox",Edge:"Edge",IE:"IE",Safari:"Safari"};function r(){const{userAgent:e}=navigator;return e.includes("Edge")?i.Edge:e.includes("Firefox")?i.Firefox:e.includes("Chrome")?i.Chrome:e.includes("Safari")?i.Safari:e.includes("compatible")&&e.includes("MSIE")&&e.includes("Opera")?i.IE:e.includes("Opera")?i.Opera:""}function s(e){const{userAgent:t}=navigator;return t.split(e)[1].split(".")[0].slice(1)}function a(){const e=r(),t=s(e);let n=!1,a=0;switch(e){case i.Chrome:n=t>=91,a=701;break;case i.Firefox:n=t>=97,a=702;break;case i.Edge:n=t>=91,a=703;break;default:n=0}return{bSupportMultiThread:n,browserType:e,errorCode:a}}var o=!1;(function(){function e(){}e.createFromElementId=function(t){var n=document.getElementById(t),i="",r=n.firstChild;while(r)3===r.nodeType&&(i+=r.textContent),r=r.nextSibling;var s=new e;return s.type=n.type,s.source=i,s},e.createFromSource=function(t,n){var i=new e;return i.type=t,i.source=n,i}})(),function(){function e(e,t){if("x-shader/x-fragment"===t.type)this.shader=e.createShader(e.FRAGMENT_SHADER);else{if("x-shader/x-vertex"!==t.type)return void error("Unknown shader type: "+t.type);this.shader=e.createShader(e.VERTEX_SHADER)}e.shaderSource(this.shader,t.source),e.compileShader(this.shader),e.getShaderParameter(this.shader,e.COMPILE_STATUS)||error("An error occurred compiling the shaders: "+e.getShaderInfoLog(this.shader))}}(),function(){function e(e){this.gl=e,this.program=this.gl.createProgram()}e.prototype={attach:function(e){this.gl.attachShader(this.program,e.shader)},link:function(){this.gl.linkProgram(this.program)},use:function(){this.gl.useProgram(this.program)},getAttributeLocation:function(e){return this.gl.getAttribLocation(this.program,e)},setMatrixUniform:function(e,t){var n=this.gl.getUniformLocation(this.program,e);this.gl.uniformMatrix4fv(n,!1,t)}}}(),function(){var e=null;function t(e,t,n){this.gl=e,this.size=t,this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),this.format=n||e.LUMINANCE,e.texImage2D(e.TEXTURE_2D,0,this.format,t.w,t.h,0,this.format,e.UNSIGNED_BYTE,null),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)}t.prototype={fill:function(e,t){var n=this.gl;n.bindTexture(n.TEXTURE_2D,this.texture),t?n.texSubImage2D(n.TEXTURE_2D,0,0,0,this.size.w,this.size.h,this.format,n.UNSIGNED_BYTE,e):n.texImage2D(n.TEXTURE_2D,0,this.format,this.size.w,this.size.h,0,this.format,n.UNSIGNED_BYTE,e)},bind:function(t,n,i){var r=this.gl;e||(e=[r.TEXTURE0,r.TEXTURE1,r.TEXTURE2]),r.activeTexture(e[t]),r.bindTexture(r.TEXTURE_2D,this.texture),r.uniform1i(r.getUniformLocation(n.program,i),t)}}}();const l=e=>{const t=document.getElementsByTagName("script");for(let n=0;n<t.length;n++)if(t[n].src.includes(e))return!0;return!1},c=e=>{if(l(e))return;const t=document.createElement("script");t.src=e,document.head.appendChild(t)},u=e=>{let t="WasmLib/MultiThread/libplay.js";"undefined"!=typeof SharedArrayBuffer&&e||(t="WasmLib/SingleThread/libplay.js"),c(t)},d=e=>{if(!e)return;let t=()=>{},n=()=>{},i=()=>{},r=()=>{},s=()=>{};e.length&&(t=(t,n,i,r,s,a)=>{e.forEach((e=>{e&&e.cPlusVisibleDecCallBack(t,n,i,r,s,a)}))},n=(t,n,i)=>{e.forEach((e=>{e&&e.cDigitalSignCallBack(t,n,i)}))},i=(t,n,i,r)=>{e.forEach((e=>{e&&e.cExtraDrawDataCallBack(t,n,i,r)}))},r=t=>{e.forEach((e=>{e&&e.cExtraDrawDrawCallBack(t)}))},s=(t,n,i,r,s)=>{e.forEach((e=>{e&&e.cRecordDataCallBack(t,n,i,r,s)}))}),window.cPlusVisibleDecCallBack=t,window.cDigitalSignCallBack=n,window.cExtraDrawDataCallBack=i,window.cExtraDrawDrawCallBack=r,window.cRecordDataCallBack=s;const{bSupportMultiThread:o}=a();u(o)};var h={init:d}}}]);